<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>linux-3.磁盘和文件系统 | 王小红的笔记</title><meta name=keywords content="linux"><meta name=description content='磁盘的物理组成：

原型碟片：记录数据。
机械手臂：包括手臂和磁头(擦写碟片上的数据)。
主轴马达：可以转动碟片。
扇区：最小的物理存储单元，有512B和4k两种格式。
柱面：扇区组成的一圈。早起分区以柱面为单位，现在使用扇区。
磁盘分区表：一种是限制比较多的MBR(Master boot record)，一种是比较新的GPT，MBR中第一个扇区最重要，里面放的主引导记录(MBR，446B)+分区表(64B)，目前最新的是GPT分区表。

磁盘文件名：

物理磁盘的文件名一般都叫/dev/sd[a-p][1-128]
虚拟磁盘的文件名一般是/dev/vd[a-d][1-128]
如果是磁盘阵列的话一般是/dev/md[0-128]
LVM一般是/dev/VGNAME/LVNAME这种

分区之后一般都需要格式化一下，因为每个系统使用的文件系统不一样，比如win98以前用FAT，win2000之后用NTFS，Linux正统文件系统是ext2，一些发行版的Linux使用其他文件系统，比如CentosOS7使用xfs文件系统。
文件系统
文件系统特性
linux的文件系统可以分成6个区块的数据：

超级区块的数据：记录文件系统的整体信息，比如inode和数据区块的总量、使用量、剩余量、文件系统的格式和相关信息。
inode：记录文件信息，比如文件的属性(时间、属组)、权限、文件数据所在区。一个文件占用一个inode。每个inode是128B或者256B。
数据区块：实际记录文件内容，文件太大的时候会占用多个区块，并且一个区块只能写一个文件，如果有剩余空间就浪费了。
文件系统描述：描述每个区块群组的开始、结束区块，以及inode、超级区块等介于那个区块之间。
区块对照表：记录空的区块。
inode对照表：记录使用和未使用的inode号。

上面除了超级区块的5个组成一个区块群组(block group)，一个文件系统只有一个超级区块的数据，如果有多个也是这个的备份。
Linux在读取文件的时候先根据inode把数据所在的区块都读出来，而FAT格式的文件系统，比如U盘是没有inode的，他只是在数据区块中记录下一个数据区块的编号，所以没法一次读取，只能一个一个读，这样就会有个问题，磁盘转一圈可能没读完，需要转好几圈，所以这种系统可以经常清理磁盘碎片，让同一个数据区块挨的进点，方便读取。
可以使用dumpe2fs [-bh] 设备文件名查看超级区块信息，但是xfs是不支持这个命令的：


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87


# 打印块设备属性，可以看到我的是ext4
blkid
# /dev/vda1: UUID="1114fe9e-2309-4580-b183-d778e6d97397" TYPE="ext4" 

# -b 列出保留为坏道的部分
# -h 只显示超级区块信息，不展示其他区段内容
dumpe2fs /dev/vda1

dumpe2fs 1.42.9 (28-Dec-2013)
# 文件系统名称
Filesystem volume name:   <none>
# 上一次挂载的目录位置
Last mounted on:          /
Filesystem UUID:          1114fe9e-2309-4580-b183-d778e6d97397
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
# 文件系统特性
Filesystem featrues:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize
Filesystem flags:         signed_directory_hash 
# 默认挂载参数
Default mount options:    user_xattr acl
# 文件系统状态，如果是dirty就说明有被修改过的文件但是还在内存，没有刷到粗盘
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
# inode总数
Inode count:              2621440
# 区块总数
Block count:              10484164
# 保留区块总数
Reserved block count:     471777
# 可用区块数量
Free blocks:              5941100
# 可用inode数量
Free inodes:              2484489
First block:              0
# 单个区块的大小
Block size:               4096
Fragment size:            4096
Reserved GDT blocks:      1021
Blocks per group:         32768
Fragments per group:      32768
Inodes per group:         8192
Inode blocks per group:   512
Flex block group size:    16
Filesystem created:       Thu Jul 11 10:52:00 2019
Last mount time:          Thu Mar 10 16:03:03 2022
Last write time:          Fri Mar 11 00:03:02 2022
Mount count:              6
Maximum mount count:      -1
Last checked:             Thu Jul 11 10:52:00 2019
Check interval:           0 (<none>)
Lifetime writes:          3907 MB
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
# inode容量
Inode size:               256
Required extra isize:     28
Desired extra isize:      28
Journal inode:            8
First orphan inode:       1050033
Default directory hash:   half_md4
Directory Hash Seed:      0163c9aa-b271-4625-b08d-5a774c70359e
# 日志相关信息
Journal backup:           inode blocks
Journal featrues:         journal_incompat_revoke
日志区块总大小:             128M
Journal length:           32768
Journal sequence:         0x0380a708
Journal start:            14867

# 第一区块群组信息
Group 0: (Blocks 0-32767) [ITABLE_ZEROED]
  Checksum 0x0314, unused inodes 8175
  # 主要超级区块位置
  主 superblock at 0, Group descriptors at 1-3
  保留的GDT块位于 4-1024
  Block bitmap at 1025 (+1025), Inode bitmap at 1041 (+1041)
  Inode表位于 1057-1568 (+1057)
  14316 free blocks, 8177 free inodes, 2 directories, 8175个未使用的inodes
  # 那些区块可用
  可用块数: 11727-12287, 12301, 12318, 12336, 12352, 12374, 12390, 12409, 12426, 12440-12719, 13296-13708, 14304-17854, 18201-25833, 27287-28583, 30376-30604, 32424-32767
  可用inode数: 12, 14, 18-8192
  # 其他区块群组信息
Group 1: (Blocks 32768-65535) [INODE_UNINIT, ITABLE_ZEROED]
……


xfs系统相比ext2、ext3、ext4来说多了两个区，他的数据区(data section)可以理解成ext系列的所有区块，但是不包括ext3和ext4的日志，xfs的文件系统活动区(log section)就是用日志用来记录文件的变化，xfs的实时运行区(realtime section)是用来实时分配inode和区块的，这也是他和ext系列系统的最大区别。可以使用xfs_info 挂载点/设备文件名命令查看xfs文件系统信息。'><meta name=author content><link rel=canonical href=https://wangxiaohong123.github.io/posts/linux/3.%E7%A3%81%E7%9B%98%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/><link crossorigin=anonymous href=/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as=style><link rel=icon href=https://wangxiaohong123.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wangxiaohong123.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangxiaohong123.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wangxiaohong123.github.io/apple-touch-icon.png><link rel=mask-icon href=https://wangxiaohong123.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangxiaohong123.github.io/posts/linux/3.%E7%A3%81%E7%9B%98%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://wangxiaohong123.github.io/posts/linux/3.%E7%A3%81%E7%9B%98%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"><meta property="og:site_name" content="王小红的笔记"><meta property="og:title" content="linux-3.磁盘和文件系统"><meta property="og:description" content='磁盘的物理组成：
原型碟片：记录数据。 机械手臂：包括手臂和磁头(擦写碟片上的数据)。 主轴马达：可以转动碟片。 扇区：最小的物理存储单元，有512B和4k两种格式。 柱面：扇区组成的一圈。早起分区以柱面为单位，现在使用扇区。 磁盘分区表：一种是限制比较多的MBR(Master boot record)，一种是比较新的GPT，MBR中第一个扇区最重要，里面放的主引导记录(MBR，446B)+分区表(64B)，目前最新的是GPT分区表。 磁盘文件名：
物理磁盘的文件名一般都叫/dev/sd[a-p][1-128] 虚拟磁盘的文件名一般是/dev/vd[a-d][1-128] 如果是磁盘阵列的话一般是/dev/md[0-128] LVM一般是/dev/VGNAME/LVNAME这种 分区之后一般都需要格式化一下，因为每个系统使用的文件系统不一样，比如win98以前用FAT，win2000之后用NTFS，Linux正统文件系统是ext2，一些发行版的Linux使用其他文件系统，比如CentosOS7使用xfs文件系统。
文件系统 文件系统特性 linux的文件系统可以分成6个区块的数据：
超级区块的数据：记录文件系统的整体信息，比如inode和数据区块的总量、使用量、剩余量、文件系统的格式和相关信息。 inode：记录文件信息，比如文件的属性(时间、属组)、权限、文件数据所在区。一个文件占用一个inode。每个inode是128B或者256B。 数据区块：实际记录文件内容，文件太大的时候会占用多个区块，并且一个区块只能写一个文件，如果有剩余空间就浪费了。 文件系统描述：描述每个区块群组的开始、结束区块，以及inode、超级区块等介于那个区块之间。 区块对照表：记录空的区块。 inode对照表：记录使用和未使用的inode号。 上面除了超级区块的5个组成一个区块群组(block group)，一个文件系统只有一个超级区块的数据，如果有多个也是这个的备份。
Linux在读取文件的时候先根据inode把数据所在的区块都读出来，而FAT格式的文件系统，比如U盘是没有inode的，他只是在数据区块中记录下一个数据区块的编号，所以没法一次读取，只能一个一个读，这样就会有个问题，磁盘转一圈可能没读完，需要转好几圈，所以这种系统可以经常清理磁盘碎片，让同一个数据区块挨的进点，方便读取。
可以使用dumpe2fs [-bh] 设备文件名查看超级区块信息，但是xfs是不支持这个命令的：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 # 打印块设备属性，可以看到我的是ext4 blkid # /dev/vda1: UUID="1114fe9e-2309-4580-b183-d778e6d97397" TYPE="ext4" # -b 列出保留为坏道的部分 # -h 只显示超级区块信息，不展示其他区段内容 dumpe2fs /dev/vda1 dumpe2fs 1.42.9 (28-Dec-2013) # 文件系统名称 Filesystem volume name: <none> # 上一次挂载的目录位置 Last mounted on: / Filesystem UUID: 1114fe9e-2309-4580-b183-d778e6d97397 Filesystem magic number: 0xEF53 Filesystem revision #: 1 (dynamic) # 文件系统特性 Filesystem featrues: has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize Filesystem flags: signed_directory_hash # 默认挂载参数 Default mount options: user_xattr acl # 文件系统状态，如果是dirty就说明有被修改过的文件但是还在内存，没有刷到粗盘 Filesystem state: clean Errors behavior: Continue Filesystem OS type: Linux # inode总数 Inode count: 2621440 # 区块总数 Block count: 10484164 # 保留区块总数 Reserved block count: 471777 # 可用区块数量 Free blocks: 5941100 # 可用inode数量 Free inodes: 2484489 First block: 0 # 单个区块的大小 Block size: 4096 Fragment size: 4096 Reserved GDT blocks: 1021 Blocks per group: 32768 Fragments per group: 32768 Inodes per group: 8192 Inode blocks per group: 512 Flex block group size: 16 Filesystem created: Thu Jul 11 10:52:00 2019 Last mount time: Thu Mar 10 16:03:03 2022 Last write time: Fri Mar 11 00:03:02 2022 Mount count: 6 Maximum mount count: -1 Last checked: Thu Jul 11 10:52:00 2019 Check interval: 0 (<none>) Lifetime writes: 3907 MB Reserved blocks uid: 0 (user root) Reserved blocks gid: 0 (group root) First inode: 11 # inode容量 Inode size: 256 Required extra isize: 28 Desired extra isize: 28 Journal inode: 8 First orphan inode: 1050033 Default directory hash: half_md4 Directory Hash Seed: 0163c9aa-b271-4625-b08d-5a774c70359e # 日志相关信息 Journal backup: inode blocks Journal featrues: journal_incompat_revoke 日志区块总大小: 128M Journal length: 32768 Journal sequence: 0x0380a708 Journal start: 14867 # 第一区块群组信息 Group 0: (Blocks 0-32767) [ITABLE_ZEROED] Checksum 0x0314, unused inodes 8175 # 主要超级区块位置 主 superblock at 0, Group descriptors at 1-3 保留的GDT块位于 4-1024 Block bitmap at 1025 (+1025), Inode bitmap at 1041 (+1041) Inode表位于 1057-1568 (+1057) 14316 free blocks, 8177 free inodes, 2 directories, 8175个未使用的inodes # 那些区块可用 可用块数: 11727-12287, 12301, 12318, 12336, 12352, 12374, 12390, 12409, 12426, 12440-12719, 13296-13708, 14304-17854, 18201-25833, 27287-28583, 30376-30604, 32424-32767 可用inode数: 12, 14, 18-8192 # 其他区块群组信息 Group 1: (Blocks 32768-65535) [INODE_UNINIT, ITABLE_ZEROED] …… xfs系统相比ext2、ext3、ext4来说多了两个区，他的数据区(data section)可以理解成ext系列的所有区块，但是不包括ext3和ext4的日志，xfs的文件系统活动区(log section)就是用日志用来记录文件的变化，xfs的实时运行区(realtime section)是用来实时分配inode和区块的，这也是他和ext系列系统的最大区别。可以使用xfs_info 挂载点/设备文件名命令查看xfs文件系统信息。'><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="linux-3.磁盘和文件系统"><meta name=twitter:description content='磁盘的物理组成：

原型碟片：记录数据。
机械手臂：包括手臂和磁头(擦写碟片上的数据)。
主轴马达：可以转动碟片。
扇区：最小的物理存储单元，有512B和4k两种格式。
柱面：扇区组成的一圈。早起分区以柱面为单位，现在使用扇区。
磁盘分区表：一种是限制比较多的MBR(Master boot record)，一种是比较新的GPT，MBR中第一个扇区最重要，里面放的主引导记录(MBR，446B)+分区表(64B)，目前最新的是GPT分区表。

磁盘文件名：

物理磁盘的文件名一般都叫/dev/sd[a-p][1-128]
虚拟磁盘的文件名一般是/dev/vd[a-d][1-128]
如果是磁盘阵列的话一般是/dev/md[0-128]
LVM一般是/dev/VGNAME/LVNAME这种

分区之后一般都需要格式化一下，因为每个系统使用的文件系统不一样，比如win98以前用FAT，win2000之后用NTFS，Linux正统文件系统是ext2，一些发行版的Linux使用其他文件系统，比如CentosOS7使用xfs文件系统。
文件系统
文件系统特性
linux的文件系统可以分成6个区块的数据：

超级区块的数据：记录文件系统的整体信息，比如inode和数据区块的总量、使用量、剩余量、文件系统的格式和相关信息。
inode：记录文件信息，比如文件的属性(时间、属组)、权限、文件数据所在区。一个文件占用一个inode。每个inode是128B或者256B。
数据区块：实际记录文件内容，文件太大的时候会占用多个区块，并且一个区块只能写一个文件，如果有剩余空间就浪费了。
文件系统描述：描述每个区块群组的开始、结束区块，以及inode、超级区块等介于那个区块之间。
区块对照表：记录空的区块。
inode对照表：记录使用和未使用的inode号。

上面除了超级区块的5个组成一个区块群组(block group)，一个文件系统只有一个超级区块的数据，如果有多个也是这个的备份。
Linux在读取文件的时候先根据inode把数据所在的区块都读出来，而FAT格式的文件系统，比如U盘是没有inode的，他只是在数据区块中记录下一个数据区块的编号，所以没法一次读取，只能一个一个读，这样就会有个问题，磁盘转一圈可能没读完，需要转好几圈，所以这种系统可以经常清理磁盘碎片，让同一个数据区块挨的进点，方便读取。
可以使用dumpe2fs [-bh] 设备文件名查看超级区块信息，但是xfs是不支持这个命令的：


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87


# 打印块设备属性，可以看到我的是ext4
blkid
# /dev/vda1: UUID="1114fe9e-2309-4580-b183-d778e6d97397" TYPE="ext4" 

# -b 列出保留为坏道的部分
# -h 只显示超级区块信息，不展示其他区段内容
dumpe2fs /dev/vda1

dumpe2fs 1.42.9 (28-Dec-2013)
# 文件系统名称
Filesystem volume name:   <none>
# 上一次挂载的目录位置
Last mounted on:          /
Filesystem UUID:          1114fe9e-2309-4580-b183-d778e6d97397
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
# 文件系统特性
Filesystem featrues:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize
Filesystem flags:         signed_directory_hash 
# 默认挂载参数
Default mount options:    user_xattr acl
# 文件系统状态，如果是dirty就说明有被修改过的文件但是还在内存，没有刷到粗盘
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
# inode总数
Inode count:              2621440
# 区块总数
Block count:              10484164
# 保留区块总数
Reserved block count:     471777
# 可用区块数量
Free blocks:              5941100
# 可用inode数量
Free inodes:              2484489
First block:              0
# 单个区块的大小
Block size:               4096
Fragment size:            4096
Reserved GDT blocks:      1021
Blocks per group:         32768
Fragments per group:      32768
Inodes per group:         8192
Inode blocks per group:   512
Flex block group size:    16
Filesystem created:       Thu Jul 11 10:52:00 2019
Last mount time:          Thu Mar 10 16:03:03 2022
Last write time:          Fri Mar 11 00:03:02 2022
Mount count:              6
Maximum mount count:      -1
Last checked:             Thu Jul 11 10:52:00 2019
Check interval:           0 (<none>)
Lifetime writes:          3907 MB
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
# inode容量
Inode size:               256
Required extra isize:     28
Desired extra isize:      28
Journal inode:            8
First orphan inode:       1050033
Default directory hash:   half_md4
Directory Hash Seed:      0163c9aa-b271-4625-b08d-5a774c70359e
# 日志相关信息
Journal backup:           inode blocks
Journal featrues:         journal_incompat_revoke
日志区块总大小:             128M
Journal length:           32768
Journal sequence:         0x0380a708
Journal start:            14867

# 第一区块群组信息
Group 0: (Blocks 0-32767) [ITABLE_ZEROED]
  Checksum 0x0314, unused inodes 8175
  # 主要超级区块位置
  主 superblock at 0, Group descriptors at 1-3
  保留的GDT块位于 4-1024
  Block bitmap at 1025 (+1025), Inode bitmap at 1041 (+1041)
  Inode表位于 1057-1568 (+1057)
  14316 free blocks, 8177 free inodes, 2 directories, 8175个未使用的inodes
  # 那些区块可用
  可用块数: 11727-12287, 12301, 12318, 12336, 12352, 12374, 12390, 12409, 12426, 12440-12719, 13296-13708, 14304-17854, 18201-25833, 27287-28583, 30376-30604, 32424-32767
  可用inode数: 12, 14, 18-8192
  # 其他区块群组信息
Group 1: (Blocks 32768-65535) [INODE_UNINIT, ITABLE_ZEROED]
……


xfs系统相比ext2、ext3、ext4来说多了两个区，他的数据区(data section)可以理解成ext系列的所有区块，但是不包括ext3和ext4的日志，xfs的文件系统活动区(log section)就是用日志用来记录文件的变化，xfs的实时运行区(realtime section)是用来实时分配inode和区块的，这也是他和ext系列系统的最大区别。可以使用xfs_info 挂载点/设备文件名命令查看xfs文件系统信息。'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangxiaohong123.github.io/posts/"},{"@type":"ListItem","position":2,"name":"linux-3.磁盘和文件系统","item":"https://wangxiaohong123.github.io/posts/linux/3.%E7%A3%81%E7%9B%98%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"linux-3.磁盘和文件系统","name":"linux-3.磁盘和文件系统","description":"磁盘的物理组成：\n原型碟片：记录数据。 机械手臂：包括手臂和磁头(擦写碟片上的数据)。 主轴马达：可以转动碟片。 扇区：最小的物理存储单元，有512B和4k两种格式。 柱面：扇区组成的一圈。早起分区以柱面为单位，现在使用扇区。 磁盘分区表：一种是限制比较多的MBR(Master boot record)，一种是比较新的GPT，MBR中第一个扇区最重要，里面放的主引导记录(MBR，446B)+分区表(64B)，目前最新的是GPT分区表。 磁盘文件名：\n物理磁盘的文件名一般都叫/dev/sd[a-p][1-128] 虚拟磁盘的文件名一般是/dev/vd[a-d][1-128] 如果是磁盘阵列的话一般是/dev/md[0-128] LVM一般是/dev/VGNAME/LVNAME这种 分区之后一般都需要格式化一下，因为每个系统使用的文件系统不一样，比如win98以前用FAT，win2000之后用NTFS，Linux正统文件系统是ext2，一些发行版的Linux使用其他文件系统，比如CentosOS7使用xfs文件系统。\n文件系统 文件系统特性 linux的文件系统可以分成6个区块的数据：\n超级区块的数据：记录文件系统的整体信息，比如inode和数据区块的总量、使用量、剩余量、文件系统的格式和相关信息。 inode：记录文件信息，比如文件的属性(时间、属组)、权限、文件数据所在区。一个文件占用一个inode。每个inode是128B或者256B。 数据区块：实际记录文件内容，文件太大的时候会占用多个区块，并且一个区块只能写一个文件，如果有剩余空间就浪费了。 文件系统描述：描述每个区块群组的开始、结束区块，以及inode、超级区块等介于那个区块之间。 区块对照表：记录空的区块。 inode对照表：记录使用和未使用的inode号。 上面除了超级区块的5个组成一个区块群组(block group)，一个文件系统只有一个超级区块的数据，如果有多个也是这个的备份。\nLinux在读取文件的时候先根据inode把数据所在的区块都读出来，而FAT格式的文件系统，比如U盘是没有inode的，他只是在数据区块中记录下一个数据区块的编号，所以没法一次读取，只能一个一个读，这样就会有个问题，磁盘转一圈可能没读完，需要转好几圈，所以这种系统可以经常清理磁盘碎片，让同一个数据区块挨的进点，方便读取。\n可以使用dumpe2fs [-bh] 设备文件名查看超级区块信息，但是xfs是不支持这个命令的：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 # 打印块设备属性，可以看到我的是ext4 blkid # /dev/vda1: UUID=\u0026#34;1114fe9e-2309-4580-b183-d778e6d97397\u0026#34; TYPE=\u0026#34;ext4\u0026#34; # -b 列出保留为坏道的部分 # -h 只显示超级区块信息，不展示其他区段内容 dumpe2fs /dev/vda1 dumpe2fs 1.42.9 (28-Dec-2013) # 文件系统名称 Filesystem volume name: \u0026lt;none\u0026gt; # 上一次挂载的目录位置 Last mounted on: / Filesystem UUID: 1114fe9e-2309-4580-b183-d778e6d97397 Filesystem magic number: 0xEF53 Filesystem revision #: 1 (dynamic) # 文件系统特性 Filesystem featrues: has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize Filesystem flags: signed_directory_hash # 默认挂载参数 Default mount options: user_xattr acl # 文件系统状态，如果是dirty就说明有被修改过的文件但是还在内存，没有刷到粗盘 Filesystem state: clean Errors behavior: Continue Filesystem OS type: Linux # inode总数 Inode count: 2621440 # 区块总数 Block count: 10484164 # 保留区块总数 Reserved block count: 471777 # 可用区块数量 Free blocks: 5941100 # 可用inode数量 Free inodes: 2484489 First block: 0 # 单个区块的大小 Block size: 4096 Fragment size: 4096 Reserved GDT blocks: 1021 Blocks per group: 32768 Fragments per group: 32768 Inodes per group: 8192 Inode blocks per group: 512 Flex block group size: 16 Filesystem created: Thu Jul 11 10:52:00 2019 Last mount time: Thu Mar 10 16:03:03 2022 Last write time: Fri Mar 11 00:03:02 2022 Mount count: 6 Maximum mount count: -1 Last checked: Thu Jul 11 10:52:00 2019 Check interval: 0 (\u0026lt;none\u0026gt;) Lifetime writes: 3907 MB Reserved blocks uid: 0 (user root) Reserved blocks gid: 0 (group root) First inode: 11 # inode容量 Inode size: 256 Required extra isize: 28 Desired extra isize: 28 Journal inode: 8 First orphan inode: 1050033 Default directory hash: half_md4 Directory Hash Seed: 0163c9aa-b271-4625-b08d-5a774c70359e # 日志相关信息 Journal backup: inode blocks Journal featrues: journal_incompat_revoke 日志区块总大小: 128M Journal length: 32768 Journal sequence: 0x0380a708 Journal start: 14867 # 第一区块群组信息 Group 0: (Blocks 0-32767) [ITABLE_ZEROED] Checksum 0x0314, unused inodes 8175 # 主要超级区块位置 主 superblock at 0, Group descriptors at 1-3 保留的GDT块位于 4-1024 Block bitmap at 1025 (+1025), Inode bitmap at 1041 (+1041) Inode表位于 1057-1568 (+1057) 14316 free blocks, 8177 free inodes, 2 directories, 8175个未使用的inodes # 那些区块可用 可用块数: 11727-12287, 12301, 12318, 12336, 12352, 12374, 12390, 12409, 12426, 12440-12719, 13296-13708, 14304-17854, 18201-25833, 27287-28583, 30376-30604, 32424-32767 可用inode数: 12, 14, 18-8192 # 其他区块群组信息 Group 1: (Blocks 32768-65535) [INODE_UNINIT, ITABLE_ZEROED] …… xfs系统相比ext2、ext3、ext4来说多了两个区，他的数据区(data section)可以理解成ext系列的所有区块，但是不包括ext3和ext4的日志，xfs的文件系统活动区(log section)就是用日志用来记录文件的变化，xfs的实时运行区(realtime section)是用来实时分配inode和区块的，这也是他和ext系列系统的最大区别。可以使用xfs_info 挂载点/设备文件名命令查看xfs文件系统信息。\n","keywords":["linux"],"articleBody":"磁盘的物理组成：\n原型碟片：记录数据。 机械手臂：包括手臂和磁头(擦写碟片上的数据)。 主轴马达：可以转动碟片。 扇区：最小的物理存储单元，有512B和4k两种格式。 柱面：扇区组成的一圈。早起分区以柱面为单位，现在使用扇区。 磁盘分区表：一种是限制比较多的MBR(Master boot record)，一种是比较新的GPT，MBR中第一个扇区最重要，里面放的主引导记录(MBR，446B)+分区表(64B)，目前最新的是GPT分区表。 磁盘文件名：\n物理磁盘的文件名一般都叫/dev/sd[a-p][1-128] 虚拟磁盘的文件名一般是/dev/vd[a-d][1-128] 如果是磁盘阵列的话一般是/dev/md[0-128] LVM一般是/dev/VGNAME/LVNAME这种 分区之后一般都需要格式化一下，因为每个系统使用的文件系统不一样，比如win98以前用FAT，win2000之后用NTFS，Linux正统文件系统是ext2，一些发行版的Linux使用其他文件系统，比如CentosOS7使用xfs文件系统。\n文件系统 文件系统特性 linux的文件系统可以分成6个区块的数据：\n超级区块的数据：记录文件系统的整体信息，比如inode和数据区块的总量、使用量、剩余量、文件系统的格式和相关信息。 inode：记录文件信息，比如文件的属性(时间、属组)、权限、文件数据所在区。一个文件占用一个inode。每个inode是128B或者256B。 数据区块：实际记录文件内容，文件太大的时候会占用多个区块，并且一个区块只能写一个文件，如果有剩余空间就浪费了。 文件系统描述：描述每个区块群组的开始、结束区块，以及inode、超级区块等介于那个区块之间。 区块对照表：记录空的区块。 inode对照表：记录使用和未使用的inode号。 上面除了超级区块的5个组成一个区块群组(block group)，一个文件系统只有一个超级区块的数据，如果有多个也是这个的备份。\nLinux在读取文件的时候先根据inode把数据所在的区块都读出来，而FAT格式的文件系统，比如U盘是没有inode的，他只是在数据区块中记录下一个数据区块的编号，所以没法一次读取，只能一个一个读，这样就会有个问题，磁盘转一圈可能没读完，需要转好几圈，所以这种系统可以经常清理磁盘碎片，让同一个数据区块挨的进点，方便读取。\n可以使用dumpe2fs [-bh] 设备文件名查看超级区块信息，但是xfs是不支持这个命令的：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 # 打印块设备属性，可以看到我的是ext4 blkid # /dev/vda1: UUID=\"1114fe9e-2309-4580-b183-d778e6d97397\" TYPE=\"ext4\" # -b 列出保留为坏道的部分 # -h 只显示超级区块信息，不展示其他区段内容 dumpe2fs /dev/vda1 dumpe2fs 1.42.9 (28-Dec-2013) # 文件系统名称 Filesystem volume name: # 上一次挂载的目录位置 Last mounted on: / Filesystem UUID: 1114fe9e-2309-4580-b183-d778e6d97397 Filesystem magic number: 0xEF53 Filesystem revision #: 1 (dynamic) # 文件系统特性 Filesystem featrues: has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize Filesystem flags: signed_directory_hash # 默认挂载参数 Default mount options: user_xattr acl # 文件系统状态，如果是dirty就说明有被修改过的文件但是还在内存，没有刷到粗盘 Filesystem state: clean Errors behavior: Continue Filesystem OS type: Linux # inode总数 Inode count: 2621440 # 区块总数 Block count: 10484164 # 保留区块总数 Reserved block count: 471777 # 可用区块数量 Free blocks: 5941100 # 可用inode数量 Free inodes: 2484489 First block: 0 # 单个区块的大小 Block size: 4096 Fragment size: 4096 Reserved GDT blocks: 1021 Blocks per group: 32768 Fragments per group: 32768 Inodes per group: 8192 Inode blocks per group: 512 Flex block group size: 16 Filesystem created: Thu Jul 11 10:52:00 2019 Last mount time: Thu Mar 10 16:03:03 2022 Last write time: Fri Mar 11 00:03:02 2022 Mount count: 6 Maximum mount count: -1 Last checked: Thu Jul 11 10:52:00 2019 Check interval: 0 () Lifetime writes: 3907 MB Reserved blocks uid: 0 (user root) Reserved blocks gid: 0 (group root) First inode: 11 # inode容量 Inode size: 256 Required extra isize: 28 Desired extra isize: 28 Journal inode: 8 First orphan inode: 1050033 Default directory hash: half_md4 Directory Hash Seed: 0163c9aa-b271-4625-b08d-5a774c70359e # 日志相关信息 Journal backup: inode blocks Journal featrues: journal_incompat_revoke 日志区块总大小: 128M Journal length: 32768 Journal sequence: 0x0380a708 Journal start: 14867 # 第一区块群组信息 Group 0: (Blocks 0-32767) [ITABLE_ZEROED] Checksum 0x0314, unused inodes 8175 # 主要超级区块位置 主 superblock at 0, Group descriptors at 1-3 保留的GDT块位于 4-1024 Block bitmap at 1025 (+1025), Inode bitmap at 1041 (+1041) Inode表位于 1057-1568 (+1057) 14316 free blocks, 8177 free inodes, 2 directories, 8175个未使用的inodes # 那些区块可用 可用块数: 11727-12287, 12301, 12318, 12336, 12352, 12374, 12390, 12409, 12426, 12440-12719, 13296-13708, 14304-17854, 18201-25833, 27287-28583, 30376-30604, 32424-32767 可用inode数: 12, 14, 18-8192 # 其他区块群组信息 Group 1: (Blocks 32768-65535) [INODE_UNINIT, ITABLE_ZEROED] …… xfs系统相比ext2、ext3、ext4来说多了两个区，他的数据区(data section)可以理解成ext系列的所有区块，但是不包括ext3和ext4的日志，xfs的文件系统活动区(log section)就是用日志用来记录文件的变化，xfs的实时运行区(realtime section)是用来实时分配inode和区块的，这也是他和ext系列系统的最大区别。可以使用xfs_info 挂载点/设备文件名命令查看xfs文件系统信息。\n磁盘 1.磁盘的操作 磁盘整体使用 df [-ahikHTm] 目录或者文件名，参数说明：\n-a：列出所有的文件系统，包括系统特有的/proc等文件系统； -k：以kBytes的容量显示各文件系统； -m：以mBytes的容量显示各文件系统； -h：以可读的gbytes、mbytes、kbytes等格式自行显示； -H：以M=1000k替换M=1024k的进位方式； -T：列出分区的文件系统名称； -i：不用磁盘容量，以inode的数量来显示； 没有任何参数就是把系统内的所有文件系统全列出来：\n1 2 3 4 5 6 7 8 9 df 文件系统(文件系统所在硬盘分区) 1K-块(说明下面的数字是kb) 已用 可用 已用% 挂载目录 devtmpfs 16112916 0 16112916 0% /dev tmpfs 16123372 0 16123372 0% /dev/shm tmpfs 16123372 1168 16122204 1% /run tmpfs 16123372 0 16123372 0% /sys/fs/cgroup /dev/vda1 41147472 28956356 10287624 74% / tmpfs 3224676 0 3224676 0% /run/user/0 如果加上-T就可以看到文件系统的名称，常见的就是ext系列和xfs，但是大部分都是特殊系统，这些特殊系统一般都是在内存里的。所以他们的已用和已用百分比都是0，他们的容量也都很大，我觉得没啥意义。由于df显示的文件系统的整体信息，所以他是读取的超级区块的内容，运行非常快。\n查看文件系统的磁盘容量 du [-ahskm] 文件或目录名称，参数说明：\n-a：列出所有的文件和目录容量，默认仅统计以目录为单位的文件总大小； -h：以可读的格式显示； -s：仅列出总量，不显示每个目录； -k：以kb的格式显示； -m：以mb的格式显示； 什么参数都不加就是列出所有目录的容量，包括子目录，我一般经常用du -sh *，有时候执行du命令时会出现【No such file or directory】的错误，那是因为这些文件或者目录是在内存中的，磁盘上当然找不到，比如/proc下面的所有东西都是基于内存的。\n连接 连接分为硬链接和软连接，符号连接就类似windows的快捷方式，他是创建一个新的文件或者目录，然后inode中记录了链接文件的地址，硬链接类似别名，在链接文件对应的inode中在添加一个文件名，一份数据，两个指向，他不会占用新的inode，同时他也更安全，删掉一个文件也不影响访问，但是硬链接只支持同一个文件系统下的文件，目录由于维护起来非常麻烦，所以不支持。\n1 2 3 # s是符号链接，没有s就是硬链接 # f表示如果目标文件已经存在就直接删除在创建文件建立连接 ln [-sf] 源文件 目标文件 需要注意的是，新创建目录比如/tmp/test的时候会自动生成两个目录/tmp/test/.和/tmp/test/..，/tmp/test/.指向/tmp/test，而/tmp/test/..指向/tmp/，所以刚创建的目录的链接是2，/tmp/test和/tmp/test/.，创建目录的父目录的链接数会加1。\n2.增加磁盘 增加磁盘的步骤：划分磁盘，建立可用磁盘分区–\u003e对硬盘格式化成系统可用的文件系统–\u003e检验文件系统–\u003e创建挂载点，挂载磁盘。\n还有一些细节比如硬盘需要多大、要不要日志、怎么划分inode和数据区等等需要根据场景考虑。\n1）观察分区状态 使用**lsblk [-dfimpt] [device]**列出所有磁盘列表：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # -d：不列出磁盘的分区数据 # -f：列出磁盘的文件系统 # -i：使用ASCII码字符输出 # -m：输出设备在/dev下面的权限 # -p：列出完整文件名 # -t：列出磁盘的详细信息，比如阵列机制、预读写什么的 lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT /dev/vda 253:0 0 40G 0 disk └─/dev/vda1 253:1 0 40G 0 part / # NAME：文件名 # MAJ:MIN：主要和次要设备代码 # RM：是否能卸载 # SIZE：容量 # RO：是否为只读设备 # TYPE：disk(磁盘)、partition(分区)、rom(只读存储器) # MOUNTPOINT：挂载点 如果要看UUID，我还是习惯使用blkid列出设备的UUID，他返回的列表还带着文件系统。\n使用parted device print查看分区信息：\n1 2 3 4 5 6 7 8 9 10 parted /dev/vda print Model: Virtio Block Device (virtblk) # 这应该是厂商 Disk /dev/vda1: 42.9GB\t# 总容量 Sector size (logical/physical): 512B/512B\t# 物理扇出大小 Partition Table: loop\t# 分区表格式(MBR/GPT)，loop表示没有分区，整块磁盘是一个分区 Disk Flags: # 分区数据 Number Start End Size File system 标志 1 0.00B 42.9GB 42.9GB ext4 2）磁盘分区 磁盘分区主要有MBR和GPT两种格式，parted命令都支持，MBR也可以使用fdisk命令，GPT也可以使用gdisk命令。\n直接gdisk/fdisk 设备名就可以进行按提示分区了，如果不知道有什么命令就输入问号或者m。更新完之后分区不会马上更新，需要重启或者执行partprobe命令。\n剩下的省略，在私房菜7.3。\n3）文件系统挂载和卸载 首先一个文件系统不能挂载到多个目录，同一个目录下也不能挂载多个文件系统，并且被当做挂载点的目录应该是空的，因为目录挂载了一个文件系统之后，目录里原来的内容会被隐藏，直到卸载挂载的文件系统。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 不加参数的mount只是列出目前的挂载信息 mount # 挂载文件系统 mount LABEL/UUI/设备名='' 挂载点 -a：根据配置文件/etc/fstab把所有没挂载的磁盘都挂载上来 -l：mount -l表示列出当前的挂载信息，在加一列label -t：指定预挂载类型，linux支持的有xfs、ext3、ext4、reiserfs、vfat、iso9660、nfs、cifs、smbfs，后面3个是网络文件系统，CentOS不需要加这个参数，他会自动根据超级区块加自己的驱动测试挂载，找到合适的文件系统 -n：默认情况下系统会把挂载的情况写到/etc/mtab中，-n表示不写入 -o：这个可以配置挂载的额外参数： async，sync：指定挂载的系统是同步写入还是异步写入 atime，noatime：是否修改文件的读取时间，节约性能可以设置成noatime ro，rw：挂载的文件系统是只读还是读写 auto，noauto：这个文件系统是否允许执行mount -a时被自动挂载 dev，nodev：文件系统中是否允许建立设备文件 suid，nosuid：是否允许文件系统中包含suid/sgid格式的文件 exec，noexec：是否允许文件系统中有可执行的二进制文件 user，nouser：是否允许文件系统让任何人执行mount命令，nouser就是只有root可以 remount：重新挂载，更新参数或者系统出错时候使用 默认的参数：rw，suid，dev，exec，auto，nouser，async 卸载：\n1 2 3 4 5 umount [-fn] 设备名或者挂载点 -f：强制卸载 -l：比-f还强的强制卸载 -n：不更新/etc/mtab的情况下卸载 ","wordCount":"743","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://wangxiaohong123.github.io/posts/linux/3.%E7%A3%81%E7%9B%98%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"},"publisher":{"@type":"Organization","name":"王小红的笔记","logo":{"@type":"ImageObject","url":"https://wangxiaohong123.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangxiaohong123.github.io/ accesskey=h title="王小红的笔记 (Alt + H)">王小红的笔记</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wangxiaohong123.github.io/posts/ title=笔记><span>笔记</span></a></li><li><a href=https://wangxiaohong123.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://wangxiaohong123.github.io/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">linux-3.磁盘和文件系统</h1><div class=post-meta>4 min</div></header><div class=post-content><p>磁盘的物理组成：</p><ul><li>原型碟片：记录数据。</li><li>机械手臂：包括手臂和磁头(擦写碟片上的数据)。</li><li>主轴马达：可以转动碟片。</li><li>扇区：最小的物理存储单元，有512B和4k两种格式。</li><li>柱面：扇区组成的一圈。早起分区以柱面为单位，现在使用扇区。</li><li>磁盘分区表：一种是限制比较多的MBR(Master boot record)，一种是比较新的GPT，MBR中第一个扇区最重要，里面放的主引导记录(MBR，446B)+分区表(64B)，目前最新的是GPT分区表。</li></ul><p>磁盘文件名：</p><ul><li>物理磁盘的文件名一般都叫/dev/sd[a-p][1-128]</li><li>虚拟磁盘的文件名一般是/dev/vd[a-d][1-128]</li><li>如果是磁盘阵列的话一般是/dev/md[0-128]</li><li>LVM一般是/dev/VGNAME/LVNAME这种</li></ul><p>分区之后一般都需要格式化一下，因为每个系统使用的文件系统不一样，比如win98以前用FAT，win2000之后用NTFS，Linux正统文件系统是ext2，一些发行版的Linux使用其他文件系统，比如CentosOS7使用xfs文件系统。</p><h3 id=文件系统>文件系统<a hidden class=anchor aria-hidden=true href=#文件系统>#</a></h3><h5 id=文件系统特性>文件系统特性<a hidden class=anchor aria-hidden=true href=#文件系统特性>#</a></h5><p>linux的文件系统可以分成6个区块的数据：</p><ul><li>超级区块的数据：记录文件系统的整体信息，比如inode和数据区块的总量、使用量、剩余量、文件系统的格式和相关信息。</li><li>inode：记录文件信息，比如文件的属性(时间、属组)、权限、文件数据所在区。一个文件占用一个inode。每个inode是128B或者256B。</li><li>数据区块：实际记录文件内容，文件太大的时候会占用多个区块，并且一个区块只能写一个文件，如果有剩余空间就浪费了。</li><li>文件系统描述：描述每个区块群组的开始、结束区块，以及inode、超级区块等介于那个区块之间。</li><li>区块对照表：记录空的区块。</li><li>inode对照表：记录使用和未使用的inode号。</li></ul><p>上面除了超级区块的5个组成一个区块群组(block group)，一个文件系统只有一个超级区块的数据，如果有多个也是这个的备份。</p><p>Linux在读取文件的时候先根据inode把数据所在的区块都读出来，而FAT格式的文件系统，比如U盘是没有inode的，他只是在数据区块中记录下一个数据区块的编号，所以没法一次读取，只能一个一个读，这样就会有个问题，磁盘转一圈可能没读完，需要转好几圈，所以这种系统可以经常清理磁盘碎片，让同一个数据区块挨的进点，方便读取。</p><p>可以使用<strong>dumpe2fs [-bh] 设备文件名</strong>查看超级区块信息，但是xfs是不支持这个命令的：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># 打印块设备属性，可以看到我的是ext4</span>
</span></span><span style=display:flex><span>blkid
</span></span><span style=display:flex><span><span style=color:#6272a4># /dev/vda1: UUID=&#34;1114fe9e-2309-4580-b183-d778e6d97397&#34; TYPE=&#34;ext4&#34; </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># -b 列出保留为坏道的部分</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># -h 只显示超级区块信息，不展示其他区段内容</span>
</span></span><span style=display:flex><span>dumpe2fs /dev/vda1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dumpe2fs 1.42.9 <span style=color:#ff79c6>(</span>28-Dec-2013<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 文件系统名称</span>
</span></span><span style=display:flex><span>Filesystem volume name:   &lt;none&gt;
</span></span><span style=display:flex><span><span style=color:#6272a4># 上一次挂载的目录位置</span>
</span></span><span style=display:flex><span>Last mounted on:          /
</span></span><span style=display:flex><span>Filesystem UUID:          1114fe9e-2309-4580-b183-d778e6d97397
</span></span><span style=display:flex><span>Filesystem magic number:  0xEF53
</span></span><span style=display:flex><span>Filesystem revision <span style=color:#6272a4>#:    1 (dynamic)</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 文件系统特性</span>
</span></span><span style=display:flex><span>Filesystem featrues:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize
</span></span><span style=display:flex><span>Filesystem flags:         signed_directory_hash 
</span></span><span style=display:flex><span><span style=color:#6272a4># 默认挂载参数</span>
</span></span><span style=display:flex><span>Default mount options:    user_xattr acl
</span></span><span style=display:flex><span><span style=color:#6272a4># 文件系统状态，如果是dirty就说明有被修改过的文件但是还在内存，没有刷到粗盘</span>
</span></span><span style=display:flex><span>Filesystem state:         clean
</span></span><span style=display:flex><span>Errors behavior:          Continue
</span></span><span style=display:flex><span>Filesystem OS type:       Linux
</span></span><span style=display:flex><span><span style=color:#6272a4># inode总数</span>
</span></span><span style=display:flex><span>Inode count:              <span style=color:#bd93f9>2621440</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 区块总数</span>
</span></span><span style=display:flex><span>Block count:              <span style=color:#bd93f9>10484164</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 保留区块总数</span>
</span></span><span style=display:flex><span>Reserved block count:     <span style=color:#bd93f9>471777</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 可用区块数量</span>
</span></span><span style=display:flex><span>Free blocks:              <span style=color:#bd93f9>5941100</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 可用inode数量</span>
</span></span><span style=display:flex><span>Free inodes:              <span style=color:#bd93f9>2484489</span>
</span></span><span style=display:flex><span>First block:              <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 单个区块的大小</span>
</span></span><span style=display:flex><span>Block size:               <span style=color:#bd93f9>4096</span>
</span></span><span style=display:flex><span>Fragment size:            <span style=color:#bd93f9>4096</span>
</span></span><span style=display:flex><span>Reserved GDT blocks:      <span style=color:#bd93f9>1021</span>
</span></span><span style=display:flex><span>Blocks per group:         <span style=color:#bd93f9>32768</span>
</span></span><span style=display:flex><span>Fragments per group:      <span style=color:#bd93f9>32768</span>
</span></span><span style=display:flex><span>Inodes per group:         <span style=color:#bd93f9>8192</span>
</span></span><span style=display:flex><span>Inode blocks per group:   <span style=color:#bd93f9>512</span>
</span></span><span style=display:flex><span>Flex block group size:    <span style=color:#bd93f9>16</span>
</span></span><span style=display:flex><span>Filesystem created:       Thu Jul <span style=color:#bd93f9>11</span> 10:52:00 <span style=color:#bd93f9>2019</span>
</span></span><span style=display:flex><span>Last mount time:          Thu Mar <span style=color:#bd93f9>10</span> 16:03:03 <span style=color:#bd93f9>2022</span>
</span></span><span style=display:flex><span>Last write time:          Fri Mar <span style=color:#bd93f9>11</span> 00:03:02 <span style=color:#bd93f9>2022</span>
</span></span><span style=display:flex><span>Mount count:              <span style=color:#bd93f9>6</span>
</span></span><span style=display:flex><span>Maximum mount count:      -1
</span></span><span style=display:flex><span>Last checked:             Thu Jul <span style=color:#bd93f9>11</span> 10:52:00 <span style=color:#bd93f9>2019</span>
</span></span><span style=display:flex><span>Check interval:           <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>(</span>&lt;none&gt;<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>Lifetime writes:          <span style=color:#bd93f9>3907</span> MB
</span></span><span style=display:flex><span>Reserved blocks uid:      <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>(</span>user root<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>Reserved blocks gid:      <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>(</span>group root<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>First inode:              <span style=color:#bd93f9>11</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># inode容量</span>
</span></span><span style=display:flex><span>Inode size:               <span style=color:#bd93f9>256</span>
</span></span><span style=display:flex><span>Required extra isize:     <span style=color:#bd93f9>28</span>
</span></span><span style=display:flex><span>Desired extra isize:      <span style=color:#bd93f9>28</span>
</span></span><span style=display:flex><span>Journal inode:            <span style=color:#bd93f9>8</span>
</span></span><span style=display:flex><span>First orphan inode:       <span style=color:#bd93f9>1050033</span>
</span></span><span style=display:flex><span>Default directory hash:   half_md4
</span></span><span style=display:flex><span>Directory Hash Seed:      0163c9aa-b271-4625-b08d-5a774c70359e
</span></span><span style=display:flex><span><span style=color:#6272a4># 日志相关信息</span>
</span></span><span style=display:flex><span>Journal backup:           inode blocks
</span></span><span style=display:flex><span>Journal featrues:         journal_incompat_revoke
</span></span><span style=display:flex><span>日志区块总大小:             128M
</span></span><span style=display:flex><span>Journal length:           <span style=color:#bd93f9>32768</span>
</span></span><span style=display:flex><span>Journal sequence:         0x0380a708
</span></span><span style=display:flex><span>Journal start:            <span style=color:#bd93f9>14867</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 第一区块群组信息</span>
</span></span><span style=display:flex><span>Group 0: <span style=color:#ff79c6>(</span>Blocks 0-32767<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>[</span>ITABLE_ZEROED<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>  Checksum 0x0314, unused inodes <span style=color:#bd93f9>8175</span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4># 主要超级区块位置</span>
</span></span><span style=display:flex><span>  主 superblock at 0, Group descriptors at 1-3
</span></span><span style=display:flex><span>  保留的GDT块位于 4-1024
</span></span><span style=display:flex><span>  Block bitmap at <span style=color:#bd93f9>1025</span> <span style=color:#ff79c6>(</span>+1025<span style=color:#ff79c6>)</span>, Inode bitmap at <span style=color:#bd93f9>1041</span> <span style=color:#ff79c6>(</span>+1041<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>  Inode表位于 1057-1568 <span style=color:#ff79c6>(</span>+1057<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>14316</span> free blocks, <span style=color:#bd93f9>8177</span> free inodes, <span style=color:#bd93f9>2</span> directories, 8175个未使用的inodes
</span></span><span style=display:flex><span>  <span style=color:#6272a4># 那些区块可用</span>
</span></span><span style=display:flex><span>  可用块数: 11727-12287, 12301, 12318, 12336, 12352, 12374, 12390, 12409, 12426, 12440-12719, 13296-13708, 14304-17854, 18201-25833, 27287-28583, 30376-30604, 32424-32767
</span></span><span style=display:flex><span>  可用inode数: 12, 14, 18-8192
</span></span><span style=display:flex><span>  <span style=color:#6272a4># 其他区块群组信息</span>
</span></span><span style=display:flex><span>Group 1: <span style=color:#ff79c6>(</span>Blocks 32768-65535<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>[</span>INODE_UNINIT, ITABLE_ZEROED<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>……
</span></span></code></pre></td></tr></table></div></div><p>xfs系统相比ext2、ext3、ext4来说多了两个区，他的数据区(data section)可以理解成ext系列的所有区块，但是不包括ext3和ext4的日志，xfs的文件系统活动区(log section)就是用日志用来记录文件的变化，xfs的实时运行区(realtime section)是用来实时分配inode和区块的，这也是他和ext系列系统的最大区别。可以使用<strong>xfs_info 挂载点/设备文件名</strong>命令查看xfs文件系统信息。</p><h3 id=磁盘>磁盘<a hidden class=anchor aria-hidden=true href=#磁盘>#</a></h3><h5 id=1磁盘的操作>1.磁盘的操作<a hidden class=anchor aria-hidden=true href=#1磁盘的操作>#</a></h5><h6 id=磁盘整体使用>磁盘整体使用<a hidden class=anchor aria-hidden=true href=#磁盘整体使用>#</a></h6><p>df [-ahikHTm] 目录或者文件名，参数说明：</p><ul><li>-a：列出所有的文件系统，包括系统特有的/proc等文件系统；</li><li>-k：以kBytes的容量显示各文件系统；</li><li>-m：以mBytes的容量显示各文件系统；</li><li>-h：以可读的gbytes、mbytes、kbytes等格式自行显示；</li><li>-H：以M=1000k替换M=1024k的进位方式；</li><li>-T：列出分区的文件系统名称；</li><li>-i：不用磁盘容量，以inode的数量来显示；</li></ul><p>没有任何参数就是把系统内的所有文件系统全列出来：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>文件系统<span style=color:#ff79c6>(</span>文件系统所在硬盘分区<span style=color:#ff79c6>)</span>   1K-块<span style=color:#ff79c6>(</span>说明下面的数字是kb<span style=color:#ff79c6>)</span>     已用       可用     已用%    挂载目录
</span></span><span style=display:flex><span>devtmpfs                            <span style=color:#bd93f9>16112916</span>             <span style=color:#bd93f9>0</span>     <span style=color:#bd93f9>16112916</span>    0%      /dev
</span></span><span style=display:flex><span>tmpfs                               <span style=color:#bd93f9>16123372</span>             <span style=color:#bd93f9>0</span>     <span style=color:#bd93f9>16123372</span>    0%    /dev/shm
</span></span><span style=display:flex><span>tmpfs                               <span style=color:#bd93f9>16123372</span>           <span style=color:#bd93f9>1168</span>    <span style=color:#bd93f9>16122204</span>    1%      /run
</span></span><span style=display:flex><span>tmpfs                               <span style=color:#bd93f9>16123372</span>             <span style=color:#bd93f9>0</span>     <span style=color:#bd93f9>16123372</span>    0%   /sys/fs/cgroup
</span></span><span style=display:flex><span>/dev/vda1                           <span style=color:#bd93f9>41147472</span>         <span style=color:#bd93f9>28956356</span>  <span style=color:#bd93f9>10287624</span>    74%        /
</span></span><span style=display:flex><span>tmpfs                               <span style=color:#bd93f9>3224676</span>              <span style=color:#bd93f9>0</span>     <span style=color:#bd93f9>3224676</span>     0%    /run/user/0
</span></span></code></pre></td></tr></table></div></div><p>如果加上-T就可以看到文件系统的名称，常见的就是ext系列和xfs，但是大部分都是特殊系统，这些特殊系统一般都是在内存里的。所以他们的已用和已用百分比都是0，他们的容量也都很大，我觉得没啥意义。由于df显示的文件系统的整体信息，所以他是读取的超级区块的内容，运行非常快。</p><h6 id=查看文件系统的磁盘容量>查看文件系统的磁盘容量<a hidden class=anchor aria-hidden=true href=#查看文件系统的磁盘容量>#</a></h6><p>du [-ahskm] 文件或目录名称，参数说明：</p><ul><li>-a：列出所有的文件和目录容量，默认仅统计以目录为单位的文件总大小；</li><li>-h：以可读的格式显示；</li><li>-s：仅列出总量，不显示每个目录；</li><li>-k：以kb的格式显示；</li><li>-m：以mb的格式显示；</li></ul><p>什么参数都不加就是列出所有目录的容量，包括子目录，我一般经常用<strong>du -sh *</strong>，有时候执行du命令时会出现【No such file or directory】的错误，那是因为这些文件或者目录是在内存中的，磁盘上当然找不到，比如/proc下面的所有东西都是基于内存的。</p><h5 id=连接>连接<a hidden class=anchor aria-hidden=true href=#连接>#</a></h5><p>连接分为硬链接和软连接，符号连接就类似windows的快捷方式，他是创建一个新的文件或者目录，然后inode中记录了链接文件的地址，硬链接类似别名，在链接文件对应的inode中在添加一个文件名，一份数据，两个指向，他不会占用新的inode，同时他也更安全，删掉一个文件也不影响访问，但是硬链接只支持同一个文件系统下的文件，目录由于维护起来非常麻烦，所以不支持。</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># s是符号链接，没有s就是硬链接</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># f表示如果目标文件已经存在就直接删除在创建文件建立连接</span>
</span></span><span style=display:flex><span>ln <span style=color:#ff79c6>[</span>-sf<span style=color:#ff79c6>]</span> 源文件 目标文件
</span></span></code></pre></td></tr></table></div></div><p>需要注意的是，新创建目录比如/tmp/test的时候会自动生成两个目录/tmp/test/.和/tmp/test/..，/tmp/test/.指向/tmp/test，而/tmp/test/..指向/tmp/，所以刚创建的目录的链接是2，/tmp/test和/tmp/test/.，创建目录的父目录的链接数会加1。</p><h5 id=2增加磁盘>2.增加磁盘<a hidden class=anchor aria-hidden=true href=#2增加磁盘>#</a></h5><p>增加磁盘的步骤：划分磁盘，建立可用磁盘分区&ndash;>对硬盘格式化成系统可用的文件系统&ndash;>检验文件系统&ndash;>创建挂载点，挂载磁盘。</p><p>还有一些细节比如硬盘需要多大、要不要日志、怎么划分inode和数据区等等需要根据场景考虑。</p><h6 id=1观察分区状态>1）观察分区状态<a hidden class=anchor aria-hidden=true href=#1观察分区状态>#</a></h6><p>使用**lsblk [-dfimpt] [device]**列出所有磁盘列表：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># -d：不列出磁盘的分区数据</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># -f：列出磁盘的文件系统</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># -i：使用ASCII码字符输出</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># -m：输出设备在/dev下面的权限</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># -p：列出完整文件名</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># -t：列出磁盘的详细信息，比如阵列机制、预读写什么的</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lsblk
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME        MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
</span></span><span style=display:flex><span>/dev/vda    253:0    <span style=color:#bd93f9>0</span>  40G  <span style=color:#bd93f9>0</span> disk 
</span></span><span style=display:flex><span>└─/dev/vda1 253:1    <span style=color:#bd93f9>0</span>  40G  <span style=color:#bd93f9>0</span> part /
</span></span><span style=display:flex><span><span style=color:#6272a4># NAME：文件名</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># MAJ:MIN：主要和次要设备代码</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># RM：是否能卸载</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># SIZE：容量</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># RO：是否为只读设备</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># TYPE：disk(磁盘)、partition(分区)、rom(只读存储器)</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># MOUNTPOINT：挂载点</span>
</span></span></code></pre></td></tr></table></div></div><p>如果要看UUID，我还是习惯使用<strong>blkid</strong>列出设备的UUID，他返回的列表还带着文件系统。</p><p>使用<strong>parted device print</strong>查看分区信息：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>parted /dev/vda print
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Model: Virtio Block Device <span style=color:#ff79c6>(</span>virtblk<span style=color:#ff79c6>)</span> 				<span style=color:#6272a4># 这应该是厂商</span>
</span></span><span style=display:flex><span>Disk /dev/vda1: 42.9GB								<span style=color:#6272a4># 总容量</span>
</span></span><span style=display:flex><span>Sector size <span style=color:#ff79c6>(</span>logical/physical<span style=color:#ff79c6>)</span>: 512B/512B			<span style=color:#6272a4># 物理扇出大小</span>
</span></span><span style=display:flex><span>Partition Table: loop								<span style=color:#6272a4># 分区表格式(MBR/GPT)，loop表示没有分区，整块磁盘是一个分区</span>
</span></span><span style=display:flex><span>Disk Flags: 
</span></span><span style=display:flex><span><span style=color:#6272a4># 分区数据</span>
</span></span><span style=display:flex><span>Number  Start  End     Size    File system  标志
</span></span><span style=display:flex><span> <span style=color:#bd93f9>1</span>      0.00B  42.9GB  42.9GB  ext4
</span></span></code></pre></td></tr></table></div></div><h6 id=2磁盘分区>2）磁盘分区<a hidden class=anchor aria-hidden=true href=#2磁盘分区>#</a></h6><p>磁盘分区主要有MBR和GPT两种格式，parted命令都支持，MBR也可以使用fdisk命令，GPT也可以使用gdisk命令。</p><p>直接gdisk/fdisk 设备名就可以进行按提示分区了，如果不知道有什么命令就输入问号或者m。更新完之后分区不会马上更新，需要重启或者执行partprobe命令。</p><p>剩下的省略，在私房菜7.3。</p><h6 id=3文件系统挂载和卸载>3）文件系统挂载和卸载<a hidden class=anchor aria-hidden=true href=#3文件系统挂载和卸载>#</a></h6><p>首先一个文件系统不能挂载到多个目录，同一个目录下也不能挂载多个文件系统，并且被当做挂载点的目录应该是空的，因为目录挂载了一个文件系统之后，目录里原来的内容会被隐藏，直到卸载挂载的文件系统。</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># 不加参数的mount只是列出目前的挂载信息</span>
</span></span><span style=display:flex><span>mount
</span></span><span style=display:flex><span><span style=color:#6272a4># 挂载文件系统</span>
</span></span><span style=display:flex><span>mount LABEL/UUI/设备名<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;&#39;</span> 挂载点
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-a：根据配置文件/etc/fstab把所有没挂载的磁盘都挂载上来
</span></span><span style=display:flex><span>-l：mount -l表示列出当前的挂载信息，在加一列label
</span></span><span style=display:flex><span>-t：指定预挂载类型，linux支持的有xfs、ext3、ext4、reiserfs、vfat、iso9660、nfs、cifs、smbfs，后面3个是网络文件系统，CentOS不需要加这个参数，他会自动根据超级区块加自己的驱动测试挂载，找到合适的文件系统
</span></span><span style=display:flex><span>-n：默认情况下系统会把挂载的情况写到/etc/mtab中，-n表示不写入
</span></span><span style=display:flex><span>-o：这个可以配置挂载的额外参数：
</span></span><span style=display:flex><span>	async，sync：指定挂载的系统是同步写入还是异步写入
</span></span><span style=display:flex><span>	atime，noatime：是否修改文件的读取时间，节约性能可以设置成noatime
</span></span><span style=display:flex><span>	ro，rw：挂载的文件系统是只读还是读写
</span></span><span style=display:flex><span>	auto，noauto：这个文件系统是否允许执行mount -a时被自动挂载
</span></span><span style=display:flex><span>	dev，nodev：文件系统中是否允许建立设备文件
</span></span><span style=display:flex><span>	suid，nosuid：是否允许文件系统中包含suid/sgid格式的文件
</span></span><span style=display:flex><span>	exec，noexec：是否允许文件系统中有可执行的二进制文件
</span></span><span style=display:flex><span>	user，nouser：是否允许文件系统让任何人执行mount命令，nouser就是只有root可以
</span></span><span style=display:flex><span>	remount：重新挂载，更新参数或者系统出错时候使用
</span></span><span style=display:flex><span>	默认的参数：rw，suid，dev，exec，auto，nouser，async
</span></span></code></pre></td></tr></table></div></div><p>卸载：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>umount <span style=color:#ff79c6>[</span>-fn<span style=color:#ff79c6>]</span> 设备名或者挂载点
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-f：强制卸载
</span></span><span style=display:flex><span>-l：比-f还强的强制卸载
</span></span><span style=display:flex><span>-n：不更新/etc/mtab的情况下卸载
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangxiaohong123.github.io/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=prev href=https://wangxiaohong123.github.io/posts/linux/2.%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/><span class=title>« Prev</span><br><span>linux-2.文件和目录管理</span>
</a><a class=next href=https://wangxiaohong123.github.io/posts/linux/4.vi/><span class=title>Next »</span><br><span>linux-4.vi</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share linux-3.磁盘和文件系统 on x" href="https://x.com/intent/tweet/?text=linux-3.%e7%a3%81%e7%9b%98%e5%92%8c%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2flinux%2f3.%25E7%25A3%2581%25E7%259B%2598%25E5%2592%258C%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%2f&amp;hashtags=linux"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share linux-3.磁盘和文件系统 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2flinux%2f3.%25E7%25A3%2581%25E7%259B%2598%25E5%2592%258C%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%2f&amp;title=linux-3.%e7%a3%81%e7%9b%98%e5%92%8c%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f&amp;summary=linux-3.%e7%a3%81%e7%9b%98%e5%92%8c%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f&amp;source=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2flinux%2f3.%25E7%25A3%2581%25E7%259B%2598%25E5%2592%258C%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share linux-3.磁盘和文件系统 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2flinux%2f3.%25E7%25A3%2581%25E7%259B%2598%25E5%2592%258C%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%2f&title=linux-3.%e7%a3%81%e7%9b%98%e5%92%8c%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share linux-3.磁盘和文件系统 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2flinux%2f3.%25E7%25A3%2581%25E7%259B%2598%25E5%2592%258C%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share linux-3.磁盘和文件系统 on whatsapp" href="https://api.whatsapp.com/send?text=linux-3.%e7%a3%81%e7%9b%98%e5%92%8c%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%20-%20https%3a%2f%2fwangxiaohong123.github.io%2fposts%2flinux%2f3.%25E7%25A3%2581%25E7%259B%2598%25E5%2592%258C%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share linux-3.磁盘和文件系统 on telegram" href="https://telegram.me/share/url?text=linux-3.%e7%a3%81%e7%9b%98%e5%92%8c%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2flinux%2f3.%25E7%25A3%2581%25E7%259B%2598%25E5%2592%258C%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share linux-3.磁盘和文件系统 on ycombinator" href="https://news.ycombinator.com/submitlink?t=linux-3.%e7%a3%81%e7%9b%98%e5%92%8c%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f&u=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2flinux%2f3.%25E7%25A3%2581%25E7%259B%2598%25E5%2592%258C%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wangxiaohong123.github.io/>王小红的笔记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>