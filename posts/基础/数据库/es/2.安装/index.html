<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>2.安装es | 王小红的笔记</title><meta name=keywords content="elasticsearch"><meta name=description content="1准备工作
首先准备3台虚拟机，三台机器上进行相同的操作
1.1修改系统参数
修改资源配置文件：vim /etc/security/limits.conf：


1
2
3
4
5
6
7


# *表示任何用户
# soft表示警告值，hard是真正限制的阈值
# nofile是文件描述符数量，nproc是开启进程数
* soft nofile 65535
* hard nofile 65535
* soft nproc 4096
* hard nproc 4096


修改这个配置要退出当前用户重新登录生效。
修改sysctl配置文件：vim /etc/sysctl.conf修改每个进程可以拥有的虚拟内存区域的数量


1


vm.max_map_count=262144


执行sysctl -p刷新配置
1.2创建es用户
执行命令useradd es添加名为es的用户，执行命令passwd es 然后根据提示输入要设置密码比如qiyuan1502，再次输入确认密码完成设置。
1.3创建目录


1
2
3


mkdir -p /app/elasticsearch
mkdir -p /app/elasticsearch/data
mkdir -p /app/elasticsearch/log


2安装es
到官网[https://www.elastic.co/cn/downloads/past-releases#elasticsearch ]下载es安装包，上传到服务器下的/app/elasticsearch文件夹中解压："><meta name=author content><link rel=canonical href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E5%BA%93/es/2.%E5%AE%89%E8%A3%85/><link crossorigin=anonymous href=/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as=style><link rel=icon href=https://wangxiaohong123.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wangxiaohong123.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangxiaohong123.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wangxiaohong123.github.io/apple-touch-icon.png><link rel=mask-icon href=https://wangxiaohong123.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E5%BA%93/es/2.%E5%AE%89%E8%A3%85/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E5%BA%93/es/2.%E5%AE%89%E8%A3%85/"><meta property="og:site_name" content="王小红的笔记"><meta property="og:title" content="2.安装es"><meta property="og:description" content="1准备工作 首先准备3台虚拟机，三台机器上进行相同的操作
1.1修改系统参数 修改资源配置文件：vim /etc/security/limits.conf：
1 2 3 4 5 6 7 # *表示任何用户 # soft表示警告值，hard是真正限制的阈值 # nofile是文件描述符数量，nproc是开启进程数 * soft nofile 65535 * hard nofile 65535 * soft nproc 4096 * hard nproc 4096 修改这个配置要退出当前用户重新登录生效。
修改sysctl配置文件：vim /etc/sysctl.conf修改每个进程可以拥有的虚拟内存区域的数量
1 vm.max_map_count=262144 执行sysctl -p刷新配置
1.2创建es用户 执行命令useradd es添加名为es的用户，执行命令passwd es 然后根据提示输入要设置密码比如qiyuan1502，再次输入确认密码完成设置。
1.3创建目录 1 2 3 mkdir -p /app/elasticsearch mkdir -p /app/elasticsearch/data mkdir -p /app/elasticsearch/log 2安装es 到官网[https://www.elastic.co/cn/downloads/past-releases#elasticsearch ]下载es安装包，上传到服务器下的/app/elasticsearch文件夹中解压："><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:tag" content="Elasticsearch"><meta name=twitter:card content="summary"><meta name=twitter:title content="2.安装es"><meta name=twitter:description content="1准备工作
首先准备3台虚拟机，三台机器上进行相同的操作
1.1修改系统参数
修改资源配置文件：vim /etc/security/limits.conf：


1
2
3
4
5
6
7


# *表示任何用户
# soft表示警告值，hard是真正限制的阈值
# nofile是文件描述符数量，nproc是开启进程数
* soft nofile 65535
* hard nofile 65535
* soft nproc 4096
* hard nproc 4096


修改这个配置要退出当前用户重新登录生效。
修改sysctl配置文件：vim /etc/sysctl.conf修改每个进程可以拥有的虚拟内存区域的数量


1


vm.max_map_count=262144


执行sysctl -p刷新配置
1.2创建es用户
执行命令useradd es添加名为es的用户，执行命令passwd es 然后根据提示输入要设置密码比如qiyuan1502，再次输入确认密码完成设置。
1.3创建目录


1
2
3


mkdir -p /app/elasticsearch
mkdir -p /app/elasticsearch/data
mkdir -p /app/elasticsearch/log


2安装es
到官网[https://www.elastic.co/cn/downloads/past-releases#elasticsearch ]下载es安装包，上传到服务器下的/app/elasticsearch文件夹中解压："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangxiaohong123.github.io/posts/"},{"@type":"ListItem","position":2,"name":"2.安装es","item":"https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E5%BA%93/es/2.%E5%AE%89%E8%A3%85/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2.安装es","name":"2.安装es","description":"1准备工作 首先准备3台虚拟机，三台机器上进行相同的操作\n1.1修改系统参数 修改资源配置文件：vim /etc/security/limits.conf：\n1 2 3 4 5 6 7 # *表示任何用户 # soft表示警告值，hard是真正限制的阈值 # nofile是文件描述符数量，nproc是开启进程数 * soft nofile 65535 * hard nofile 65535 * soft nproc 4096 * hard nproc 4096 修改这个配置要退出当前用户重新登录生效。\n修改sysctl配置文件：vim /etc/sysctl.conf修改每个进程可以拥有的虚拟内存区域的数量\n1 vm.max_map_count=262144 执行sysctl -p刷新配置\n1.2创建es用户 执行命令useradd es添加名为es的用户，执行命令passwd es 然后根据提示输入要设置密码比如qiyuan1502，再次输入确认密码完成设置。\n1.3创建目录 1 2 3 mkdir -p /app/elasticsearch mkdir -p /app/elasticsearch/data mkdir -p /app/elasticsearch/log 2安装es 到官网[https://www.elastic.co/cn/downloads/past-releases#elasticsearch ]下载es安装包，上传到服务器下的/app/elasticsearch文件夹中解压：\n","keywords":["elasticsearch"],"articleBody":"1准备工作 首先准备3台虚拟机，三台机器上进行相同的操作\n1.1修改系统参数 修改资源配置文件：vim /etc/security/limits.conf：\n1 2 3 4 5 6 7 # *表示任何用户 # soft表示警告值，hard是真正限制的阈值 # nofile是文件描述符数量，nproc是开启进程数 * soft nofile 65535 * hard nofile 65535 * soft nproc 4096 * hard nproc 4096 修改这个配置要退出当前用户重新登录生效。\n修改sysctl配置文件：vim /etc/sysctl.conf修改每个进程可以拥有的虚拟内存区域的数量\n1 vm.max_map_count=262144 执行sysctl -p刷新配置\n1.2创建es用户 执行命令useradd es添加名为es的用户，执行命令passwd es 然后根据提示输入要设置密码比如qiyuan1502，再次输入确认密码完成设置。\n1.3创建目录 1 2 3 mkdir -p /app/elasticsearch mkdir -p /app/elasticsearch/data mkdir -p /app/elasticsearch/log 2安装es 到官网[https://www.elastic.co/cn/downloads/past-releases#elasticsearch ]下载es安装包，上传到服务器下的/app/elasticsearch文件夹中解压：\n1 tar -zxvf elasticsearch-7.9.3-linux-x86_64.tar.gz 2.1修改配置文件 进入解压之后的es的配置文件夹中：cd /app/elasticaearch/elasticsearch-7.9.3/config，清空elasticsearch.yml并重新编辑：\n1 2 echo '' \u003e elasticsearch.yml vim elasticsearch.yml 配置如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # 集群名称 cluster.name: escluster # 节点名称 node.name: esnode1 # 节点⻆⾊ node.master: true node.data: true # 最⼤的节点数 node.max_local_storage_nodes: 3 # 绑定的ip地址 network.host: 0.0.0.0 # 对外的端⼝ http.port: 9300 # 节点之间通信的端⼝ transport.tcp.port: 9800 # 节点发现和集群选举 discovery.seed_hosts: [\"172.30.60.105\",\"172.30.60.106\",\"172.30.60.107\"] cluster.initial_master_nodes: [\"esnode1\",\"esnode2\",\"esnode3\"] # 数据目录和日志目录 path.data: /app/elasticsearch/data path.logs: /app/elasticsearch/log # 让kibana上可以看到堆栈监控数据 xpack.monitoring.enabled: true xpack.monitoring.collection.enabled: true # 索引缓冲区 # 占总堆的百分比 indices.memory.index_buffer_size: 30% # 最小值 indices.memory.min_index_buffer_size: 128m 修改jvm参数：vim jvm.options，开发环境先给512m\n1 2 -Xms512m -Xmx512m 2.2搞其他两台机器 使用scp把es东西复制过去\n1 2 cd / scp -r app root@172.30.60.106:/ 然后到其他两台机器上修改elasticsearch.yml里的node.name参数\n2.3修改3台机器的elasticsearch文件夹的属主和属组 1 chown -R es:es /app/elasticsearch 2.4启动es 切换用户并启动：\n1 2 3 su es /app/elasticsearch/elasticsearch-7.9.3/bin/elasticsearch -d tail -f /app/elasticsearch/log/escluster.log 访问http://8.142.71.78:9300/_cat/health?v查看集群状态，我这里只启动一个节点 3安装kibana 新启动一台虚拟机，这个对配置没要求。创建kibana用户：\n1 2 useradd kibana passwd kibana 在官网https://www.elastic.co/cn/downloads/past-releases#kibana下载7.9.3的kibana上传到服务器并解压\n1 tar -zxvf kibana-7.9.3-linux-x86_64.tar.gz 创建目录\n1 mkdir -p /app/kibana 进到kibana配置目录修改配置信息：\n1 2 echo '' \u003e kibana.yml vim kibana.yml 配置如下：\n1 2 3 4 5 6 7 8 # kibana的端⼝ server.port: 9000 # 绑定的地址 server.host: \"0.0.0.0\" # es的地址 elasticsearch.hosts: [\"http://172.30.60.105:9300\",\"http://172.30.60.106:9300\",\"http://172.30.60.107:9300\"] # 显示的语⾔ i18n.locale: \"zh-CN\" 修改kibana文件夹的属组和属主：\n1 chown -R kibana:kibana /app/kibana/ 启动kibana：\n1 nohup /app/kibana/kibana-7.9.3-linux-x86_64/bin/kibana \u0026 浏览器输入http://8.142.71.78:9400/进入kibana页面。\n4部署分词器 4.1修改IK分词器代码 下载7.9.3版本的IK分词器源码https://github.com/medcl/elasticsearch-analysis-ik/archive/refs/tags/v7.9.3.zip，导入到intellij中。 然后找到要在哪里加入我们的代码： 首先在pom文件中添加mysql依赖，虽然我下载的是7.9.3，但是pom里写的是7.4.0，这里也需要改一下：\n1 2 3 4 5 mysql mysql-connector-java 8.0.20 然后在Dictionary类的同级创建一个DictLoader类，代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 package org.wltea.analyzer.dic; import org.apache.logging.log4j.Logger; import org.elasticsearch.common.io.PathUtils; import org.wltea.analyzer.help.ESPluginLoggerFactory; import java.io.FileInputStream; import java.io.IOException; import java.nio.file.Path; import java.sql.*; import java.text.SimpleDateFormat; import java.util.Date; import java.util.HashSet; import java.util.Properties; import java.util.Set; import java.util.concurrent.atomic.AtomicBoolean; import java.util.concurrent.atomic.AtomicReference; /** * 加载MySQL中词库内容 * * @author wanghongyu */ public class DictLoader { private static final Logger LOGGER = ESPluginLoggerFactory.getLogger(DictLoader.class.getName()); private static final DictLoader INSTANCE = new DictLoader(); private final String url; private final String username; private final String password; private final AtomicBoolean extensionWordFirstLoad = new AtomicBoolean(false); private final AtomicReference\u003cString\u003e extensionWordLastLoadTimeRef = new AtomicReference\u003c\u003e(null); private final AtomicBoolean stopWordFirstLoad = new AtomicBoolean(false); private final AtomicReference\u003cString\u003e stopWordLasLoadTimeRef = new AtomicReference\u003c\u003e(null); private DictLoader() { Properties mysqlConfig = new Properties(); Path configPath = PathUtils.get(Dictionary.getSingleton().getDictRoot(), \"jdbc.properties\"); try { mysqlConfig.load(new FileInputStream(configPath.toFile())); this.url = mysqlConfig.getProperty(\"jdbc.url\"); this.username = mysqlConfig.getProperty(\"jdbc.username\"); this.password = mysqlConfig.getProperty(\"jdbc.password\"); } catch (IOException e) { throw new IllegalStateException(\"加载jdbc.properties配置⽂件发⽣ 异常\"); } try { Class.forName(\"com.mysql.cj.jdbc.Driver\"); } catch (ClassNotFoundException e) { throw new IllegalStateException(\"加载数据库驱动时发⽣异常\"); } } public static DictLoader getInstance() { return INSTANCE; } public void loadExtensionWords() { Connection connection = null; Statement statement = null; ResultSet resultSet = null; String sql; if (extensionWordFirstLoad.compareAndSet(false, true)) { // 首次加载全量的词 sql = \"SELECT word FROM extension_word\"; } else { // 后面按时间加载增量的词 sql = \"SELECT word FROM extension_word WHERE update_time \u003e='\" + extensionWordLastLoadTimeRef.get() + \"'\"; } SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\"); String nowString = sdf.format(new Date()); extensionWordLastLoadTimeRef.set(nowString); // 加载扩展词词库内容 try { connection = DriverManager.getConnection(url, username, password); statement = connection.createStatement(); resultSet = statement.executeQuery(sql); LOGGER.info(\"从mysql加载extensionWord, sql={}\", sql); Set\u003cString\u003e extensionWords = new HashSet\u003c\u003e(); while (resultSet.next()) { String word = resultSet.getString(\"word\"); if (word != null) { extensionWords.add(word); // TODO 这⾥为了⽅便看⽇志，把加载到的扩展词全都打印出来了 LOGGER.info(\"从mysql加载extensionWord, word={}\", word); } } // 放到字典⾥ Dictionary.getSingleton().addWords(extensionWords); } catch (Exception e) { LOGGER.error(\"从mysql加载extensionWord发⽣异常\", e); } finally { if (resultSet != null) { try { resultSet.close(); } catch (SQLException e) { LOGGER.error(e); } } if (null != statement) { try { statement.close(); } catch (SQLException e) { LOGGER.error(e); } } if (null != connection) { try { connection.close(); } catch (SQLException e) { LOGGER.error(e); } } } } public void loadMysqlStopWords() { Connection connection = null; Statement statement = null; ResultSet resultSet = null; String sql; if (stopWordFirstLoad.compareAndSet(false, true)) { sql = \"SELECT word FROM stop_word\"; } else { sql = \"SELECT word FROM stop_word WHERE update_time \u003e= '\" + stopWordLasLoadTimeRef.get() + \"'\"; } SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\"); String nowString = dateFormat.format(new Date()); stopWordLasLoadTimeRef.set(nowString); // 加载词库内容 try { connection = DriverManager.getConnection(url, username, password); statement = connection.createStatement(); resultSet = statement.executeQuery(sql); LOGGER.info(\"从mysql加载stopWord, sql={}\", sql); Set\u003cString\u003e stopWords = new HashSet\u003c\u003e(); while (resultSet.next()) { String word = resultSet.getString(\"word\"); if (word != null) { stopWords.add(word); LOGGER.info(\"从mysql加载stopWord，word={}\", word); } } // 放到字典⾥ Dictionary.getSingleton().addStopWords(stopWords); } catch (Exception e) { LOGGER.error(\"从mysql加载extensionWord发⽣异常\", e); } finally { if (resultSet != null) { try { resultSet.close(); } catch (SQLException e) { LOGGER.error(e); } } if (statement != null) { try { statement.close(); } catch (SQLException e) { LOGGER.error(e); } } if (connection != null) { try { connection.close(); } catch (SQLException e) { LOGGER.error(e); } } } } } 然后将Dictionary的getDictRoot()改成public，在增加一个addStopWords(Collection words)方法:\n1 2 3 4 5 6 7 8 9 10 11 12 /** * 添加停用词 */ public void addStopWords(Collection\u003cString\u003e words) { if (null != words) { for (String word : words) { if (null != word) { singleton._StopWords.fillSegment(word.trim().toCharArray()); } } } } 然后在Dictionary类中最开始我们打的todo注释下完善代码\n1 2 3 4 5 6 7 8 9 10 11 12 new Thread(() -\u003e { while (true) { try { DictLoader dictLoader = DictLoader.getInstance(); dictLoader.loadExtensionWords(); dictLoader.loadMysqlStopWords(); TimeUnit.SECONDS.sleep(60); } catch (Exception e) { e.printStackTrace(); } } }).start(); 4.2数据库相关 建表语句：\n1 2 CREATE TABLE `extension_word` ( `id` int(11) NOT NULL AUTO_INCREMENT, `word` varchar(64) NOT NULL, `create_time` datetime NOT NULL, `update_time` datetime NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; CREATE TABLE `stop_word` ( `id` int(11) NOT NULL AUTO_INCREMENT, `word` varchar(64) NOT NULL, `create_time` datetime NOT NULL, `update_time` datetime NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 config目录下新建配置文件jdbc.properties:\n1 2 3 jdbc.url=jdbc:mysql://172.30.60.105:3306/es_ik?useUnicode=true\u0026useSSL=false\u0026characterEncoding=utf8\u0026serverTimezone=Asia/Shanghai jdbc.username=root jdbc.password=qiyuan1502 4.3部署 执行mvn clean package命令打包，然后3台es机器分别执行以下操作：\n新建目录\n1 mkdir -p /app/elasticsearch/elasticsearch-7.9.3/plugins/ik 然后把elasticsearch-analysis-ik-7.9.3.zip传到ik目录下解压，然后把刚刚打包的源码jar上传到ik目录里进行覆盖，把mysql-connector-java-8.0.20.jar也传上去，把jdbc.properties传到ik/config下，最后重启es：\n1 2 3 4 5 ps -ef | grep elasticsearch kill 24479 echo '' \u003e /app/elasticsearch/log/escluster.log /app/elasticsearch/elasticsearch-7.9.3/bin/elasticsearch -d tail -f /app/elasticsearch/log/escluster.log 重启的时候可能会报错：\nCaused by: java.security.AccessControlException: access denied (“java.lang.RuntimePermission” “setContextClassLoader”)\n解决方法：\n1 2 3 4 vim /app/elasticsearch/elasticsearch-7.9.3/jdk/conf/security/java.policy # 添加如下配置 permission java.lang.RuntimePermission \"setContextClassLoader\"; 然后又遇到错\nCaused by: java.security.AccessControlException: access denied (“java.net.SocketPermission” “172.19.16.88:3306” “connect,resolve”\n在之前的配置中添加配置后再次重启：\n1 permission java.net.SocketPermission \"*\", \"connect,resolve\"; 上面的两个错都是java安全管理器和访问权限相关的，可以看《java核心技术 卷2》第9章。\n5部署拼音分词器 ","wordCount":"1166","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E5%BA%93/es/2.%E5%AE%89%E8%A3%85/"},"publisher":{"@type":"Organization","name":"王小红的笔记","logo":{"@type":"ImageObject","url":"https://wangxiaohong123.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangxiaohong123.github.io/ accesskey=h title="王小红的笔记 (Alt + H)">王小红的笔记</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wangxiaohong123.github.io/posts/ title=笔记><span>笔记</span></a></li><li><a href=https://wangxiaohong123.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://wangxiaohong123.github.io/categories/ title=分类><span>分类</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">2.安装es</h1><div class=post-meta>6 min</div></header><div class=post-content><h4 id=1准备工作>1准备工作<a hidden class=anchor aria-hidden=true href=#1准备工作>#</a></h4><p>首先准备3台虚拟机，三台机器上进行相同的操作</p><h5 id=11修改系统参数>1.1修改系统参数<a hidden class=anchor aria-hidden=true href=#11修改系统参数>#</a></h5><p>修改资源配置文件：<code>vim /etc/security/limits.conf</code>：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#6272a4># *表示任何用户</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># soft表示警告值，hard是真正限制的阈值</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># nofile是文件描述符数量，nproc是开启进程数</span>
</span></span><span style=display:flex><span>* soft nofile <span style=color:#bd93f9>65535</span>
</span></span><span style=display:flex><span>* hard nofile <span style=color:#bd93f9>65535</span>
</span></span><span style=display:flex><span>* soft nproc <span style=color:#bd93f9>4096</span>
</span></span><span style=display:flex><span>* hard nproc <span style=color:#bd93f9>4096</span>
</span></span></code></pre></td></tr></table></div></div><p>修改这个配置要退出当前用户重新登录生效。</p><p>修改sysctl配置文件：<code>vim /etc/sysctl.conf</code>修改每个进程可以拥有的虚拟内存区域的数量</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#50fa7b>vm.max_map_count</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>262144</span>
</span></span></code></pre></td></tr></table></div></div><p>执行<code>sysctl -p</code>刷新配置</p><h5 id=12创建es用户>1.2创建es用户<a hidden class=anchor aria-hidden=true href=#12创建es用户>#</a></h5><p>执行命令<code>useradd es</code>添加名为es的用户，执行命令<code>passwd es </code>然后根据提示输入要设置密码比如qiyuan1502，再次输入确认密码完成设置。</p><h5 id=13创建目录>1.3创建目录<a hidden class=anchor aria-hidden=true href=#13创建目录>#</a></h5><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p /app/elasticsearch
</span></span><span style=display:flex><span>mkdir -p /app/elasticsearch/data
</span></span><span style=display:flex><span>mkdir -p /app/elasticsearch/log
</span></span></code></pre></td></tr></table></div></div><h4 id=2安装es>2安装es<a hidden class=anchor aria-hidden=true href=#2安装es>#</a></h4><p>到官网[https://www.elastic.co/cn/downloads/past-releases#elasticsearch ]下载es安装包，上传到服务器下的/app/elasticsearch文件夹中解压：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tar -zxvf elasticsearch-7.9.3-linux-x86_64.tar.gz
</span></span></code></pre></td></tr></table></div></div><h5 id=21修改配置文件>2.1修改配置文件<a hidden class=anchor aria-hidden=true href=#21修改配置文件>#</a></h5><p>进入解压之后的es的配置文件夹中：<code>cd /app/elasticaearch/elasticsearch-7.9.3/config</code>，清空elasticsearch.yml并重新编辑：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#39;&#39;</span> &gt; elasticsearch.yml
</span></span><span style=display:flex><span>vim elasticsearch.yml
</span></span></code></pre></td></tr></table></div></div><p>配置如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#6272a4># 集群名称</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>cluster.name</span>: escluster
</span></span><span style=display:flex><span><span style=color:#6272a4># 节点名称</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>node.name</span>: esnode1
</span></span><span style=display:flex><span><span style=color:#6272a4># 节点⻆⾊</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>node.master</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>node.data</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 最⼤的节点数</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>node.max_local_storage_nodes</span>: <span style=color:#bd93f9>3</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 绑定的ip地址</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>network.host</span>: <span style=color:#bd93f9>0.0.0.0</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 对外的端⼝</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>http.port</span>: <span style=color:#bd93f9>9300</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 节点之间通信的端⼝</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>transport.tcp.port</span>: <span style=color:#bd93f9>9800</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 节点发现和集群选举</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>discovery.seed_hosts</span>: [<span style=color:#f1fa8c>&#34;172.30.60.105&#34;</span>,<span style=color:#f1fa8c>&#34;172.30.60.106&#34;</span>,<span style=color:#f1fa8c>&#34;172.30.60.107&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#ff79c6>cluster.initial_master_nodes</span>: [<span style=color:#f1fa8c>&#34;esnode1&#34;</span>,<span style=color:#f1fa8c>&#34;esnode2&#34;</span>,<span style=color:#f1fa8c>&#34;esnode3&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#6272a4># 数据目录和日志目录</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>path.data</span>: /app/elasticsearch/data
</span></span><span style=display:flex><span><span style=color:#ff79c6>path.logs</span>: /app/elasticsearch/log
</span></span><span style=display:flex><span><span style=color:#6272a4># 让kibana上可以看到堆栈监控数据</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>xpack.monitoring.enabled</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>xpack.monitoring.collection.enabled</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 索引缓冲区</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 占总堆的百分比</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>indices.memory.index_buffer_size</span>: <span style=color:#bd93f9>30</span>%
</span></span><span style=display:flex><span><span style=color:#6272a4># 最小值</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>indices.memory.min_index_buffer_size</span>: 128m
</span></span></code></pre></td></tr></table></div></div><p>修改jvm参数：<code>vim jvm.options</code>，开发环境先给512m</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>-Xms512m
</span></span><span style=display:flex><span>-Xmx512m
</span></span></code></pre></td></tr></table></div></div><h5 id=22搞其他两台机器>2.2搞其他两台机器<a hidden class=anchor aria-hidden=true href=#22搞其他两台机器>#</a></h5><p>使用scp把es东西复制过去</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>cd</span> /
</span></span><span style=display:flex><span>scp -r app root@172.30.60.106:/
</span></span></code></pre></td></tr></table></div></div><p>然后到其他两台机器上修改elasticsearch.yml里的node.name参数</p><h3 id=23修改3台机器的elasticsearch文件夹的属主和属组>2.3修改3台机器的elasticsearch文件夹的属主和属组<a hidden class=anchor aria-hidden=true href=#23修改3台机器的elasticsearch文件夹的属主和属组>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>chown -R es:es /app/elasticsearch
</span></span></code></pre></td></tr></table></div></div><h5 id=24启动es>2.4启动es<a hidden class=anchor aria-hidden=true href=#24启动es>#</a></h5><p>切换用户并启动：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>su es
</span></span><span style=display:flex><span>/app/elasticsearch/elasticsearch-7.9.3/bin/elasticsearch -d
</span></span><span style=display:flex><span>tail -f /app/elasticsearch/log/escluster.log
</span></span></code></pre></td></tr></table></div></div><p>访问http://8.142.71.78:9300/_cat/health?v查看集群状态，我这里只启动一个节点
<img loading=lazy src=https://tva1.sinaimg.cn/large/e6c9d24ely1h04u9wbd2mj21us07k75l.jpg></p><h4 id=3安装kibana>3安装kibana<a hidden class=anchor aria-hidden=true href=#3安装kibana>#</a></h4><p>新启动一台虚拟机，这个对配置没要求。创建kibana用户：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>useradd kibana
</span></span><span style=display:flex><span>passwd kibana
</span></span></code></pre></td></tr></table></div></div><p>在官网https://www.elastic.co/cn/downloads/past-releases#kibana下载7.9.3的kibana上传到服务器并解压</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tar -zxvf kibana-7.9.3-linux-x86_64.tar.gz
</span></span></code></pre></td></tr></table></div></div><p>创建目录</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p /app/kibana
</span></span></code></pre></td></tr></table></div></div><p>进到kibana配置目录修改配置信息：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#39;&#39;</span> &gt; kibana.yml
</span></span><span style=display:flex><span>vim kibana.yml
</span></span></code></pre></td></tr></table></div></div><p>配置如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#6272a4># kibana的端⼝</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>server.port</span>: <span style=color:#bd93f9>9000</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 绑定的地址</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>server.host</span>: <span style=color:#f1fa8c>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># es的地址</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>elasticsearch.hosts</span>: [<span style=color:#f1fa8c>&#34;http://172.30.60.105:9300&#34;</span>,<span style=color:#f1fa8c>&#34;http://172.30.60.106:9300&#34;</span>,<span style=color:#f1fa8c>&#34;http://172.30.60.107:9300&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#6272a4># 显示的语⾔</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>i18n.locale</span>: <span style=color:#f1fa8c>&#34;zh-CN&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>修改kibana文件夹的属组和属主：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>chown -R kibana:kibana /app/kibana/
</span></span></code></pre></td></tr></table></div></div><p>启动kibana：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> nohup /app/kibana/kibana-7.9.3-linux-x86_64/bin/kibana &amp;
</span></span></code></pre></td></tr></table></div></div><p>浏览器输入http://8.142.71.78:9400/进入kibana页面。</p><h4 id=4部署分词器>4部署分词器<a hidden class=anchor aria-hidden=true href=#4部署分词器>#</a></h4><h5 id=41修改ik分词器代码>4.1修改IK分词器代码<a hidden class=anchor aria-hidden=true href=#41修改ik分词器代码>#</a></h5><p>下载7.9.3版本的IK分词器源码https://github.com/medcl/elasticsearch-analysis-ik/archive/refs/tags/v7.9.3.zip，导入到intellij中。
然后找到要在哪里加入我们的代码：
<img loading=lazy src=https://tva1.sinaimg.cn/large/e6c9d24ely1h04xsm3iv4j21g90u0n5n.jpg></p><p>首先在pom文件中添加mysql依赖，虽然我下载的是7.9.3，但是pom里写的是7.4.0，这里也需要改一下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff79c6>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;groupId&gt;</span>mysql<span style=color:#ff79c6>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;artifactId&gt;</span>mysql-connector-java<span style=color:#ff79c6>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;version&gt;</span>8.0.20<span style=color:#ff79c6>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>然后在Dictionary类的同级创建一个DictLoader类，代码如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff79c6>package</span> org.wltea.analyzer.dic;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> org.apache.logging.log4j.Logger;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> org.elasticsearch.common.io.PathUtils;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> org.wltea.analyzer.help.ESPluginLoggerFactory;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.io.FileInputStream;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.io.IOException;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.nio.file.Path;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.sql.*;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.text.SimpleDateFormat;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.util.Date;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.util.HashSet;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.util.Properties;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.util.Set;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.util.concurrent.atomic.AtomicBoolean;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> java.util.concurrent.atomic.AtomicReference;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * 加载MySQL中词库内容
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @author wanghongyu
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>DictLoader</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd;font-style:italic>final</span> Logger LOGGER <span style=color:#ff79c6>=</span> ESPluginLoggerFactory.<span style=color:#50fa7b>getLogger</span>(DictLoader.<span style=color:#50fa7b>class</span>.<span style=color:#50fa7b>getName</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd;font-style:italic>final</span> DictLoader INSTANCE <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> DictLoader();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> String url;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> String username;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> String password;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> AtomicBoolean extensionWordFirstLoad <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> AtomicBoolean(<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> AtomicReference<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> extensionWordLastLoadTimeRef <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> AtomicReference<span style=color:#ff79c6>&lt;&gt;</span>(<span style=color:#ff79c6>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> AtomicBoolean stopWordFirstLoad <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> AtomicBoolean(<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> AtomicReference<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> stopWordLasLoadTimeRef <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> AtomicReference<span style=color:#ff79c6>&lt;&gt;</span>(<span style=color:#ff79c6>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#50fa7b>DictLoader</span>() {
</span></span><span style=display:flex><span>        Properties mysqlConfig <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Properties();
</span></span><span style=display:flex><span>        Path configPath <span style=color:#ff79c6>=</span> PathUtils.<span style=color:#50fa7b>get</span>(Dictionary.<span style=color:#50fa7b>getSingleton</span>().<span style=color:#50fa7b>getDictRoot</span>(), <span style=color:#f1fa8c>&#34;jdbc.properties&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>            mysqlConfig.<span style=color:#50fa7b>load</span>(<span style=color:#ff79c6>new</span> FileInputStream(configPath.<span style=color:#50fa7b>toFile</span>()));
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>url</span> <span style=color:#ff79c6>=</span> mysqlConfig.<span style=color:#50fa7b>getProperty</span>(<span style=color:#f1fa8c>&#34;jdbc.url&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>username</span> <span style=color:#ff79c6>=</span> mysqlConfig.<span style=color:#50fa7b>getProperty</span>(<span style=color:#f1fa8c>&#34;jdbc.username&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>password</span> <span style=color:#ff79c6>=</span> mysqlConfig.<span style=color:#50fa7b>getProperty</span>(<span style=color:#f1fa8c>&#34;jdbc.password&#34;</span>);
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>catch</span> (IOException e) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>throw</span> <span style=color:#ff79c6>new</span> IllegalStateException(<span style=color:#f1fa8c>&#34;加载jdbc.properties配置⽂件发⽣ 异常&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>            Class.<span style=color:#50fa7b>forName</span>(<span style=color:#f1fa8c>&#34;com.mysql.cj.jdbc.Driver&#34;</span>);
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>catch</span> (ClassNotFoundException e) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>throw</span> <span style=color:#ff79c6>new</span> IllegalStateException(<span style=color:#f1fa8c>&#34;加载数据库驱动时发⽣异常&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> DictLoader <span style=color:#50fa7b>getInstance</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> INSTANCE;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>loadExtensionWords</span>() {
</span></span><span style=display:flex><span>        Connection connection <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>;
</span></span><span style=display:flex><span>        Statement statement <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>;
</span></span><span style=display:flex><span>        ResultSet resultSet <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>;
</span></span><span style=display:flex><span>        String sql;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (extensionWordFirstLoad.<span style=color:#50fa7b>compareAndSet</span>(<span style=color:#ff79c6>false</span>, <span style=color:#ff79c6>true</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#6272a4>// 首次加载全量的词</span>
</span></span><span style=display:flex><span>            sql <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;SELECT word FROM extension_word&#34;</span>;
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#6272a4>// 后面按时间加载增量的词</span>
</span></span><span style=display:flex><span>            sql <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;SELECT word FROM extension_word WHERE update_time &gt;=&#39;&#34;</span> <span style=color:#ff79c6>+</span> extensionWordLastLoadTimeRef.<span style=color:#50fa7b>get</span>() <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;&#39;&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        SimpleDateFormat sdf <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> SimpleDateFormat(<span style=color:#f1fa8c>&#34;yyyy-MM-dd HH:mm:ss&#34;</span>);
</span></span><span style=display:flex><span>        String nowString <span style=color:#ff79c6>=</span> sdf.<span style=color:#50fa7b>format</span>(<span style=color:#ff79c6>new</span> Date());
</span></span><span style=display:flex><span>        extensionWordLastLoadTimeRef.<span style=color:#50fa7b>set</span>(nowString);
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// 加载扩展词词库内容</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>            connection <span style=color:#ff79c6>=</span> DriverManager.<span style=color:#50fa7b>getConnection</span>(url, username, password);
</span></span><span style=display:flex><span>            statement <span style=color:#ff79c6>=</span> connection.<span style=color:#50fa7b>createStatement</span>();
</span></span><span style=display:flex><span>            resultSet <span style=color:#ff79c6>=</span> statement.<span style=color:#50fa7b>executeQuery</span>(sql);
</span></span><span style=display:flex><span>            LOGGER.<span style=color:#50fa7b>info</span>(<span style=color:#f1fa8c>&#34;从mysql加载extensionWord, sql={}&#34;</span>, sql);
</span></span><span style=display:flex><span>            Set<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> extensionWords <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> HashSet<span style=color:#ff79c6>&lt;&gt;</span>();
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>while</span> (resultSet.<span style=color:#50fa7b>next</span>()) {
</span></span><span style=display:flex><span>                String word <span style=color:#ff79c6>=</span> resultSet.<span style=color:#50fa7b>getString</span>(<span style=color:#f1fa8c>&#34;word&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>if</span> (word <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>null</span>) {
</span></span><span style=display:flex><span>                    extensionWords.<span style=color:#50fa7b>add</span>(word);
</span></span><span style=display:flex><span>                    <span style=color:#6272a4>// TODO 这⾥为了⽅便看⽇志，把加载到的扩展词全都打印出来了</span>
</span></span><span style=display:flex><span>                    LOGGER.<span style=color:#50fa7b>info</span>(<span style=color:#f1fa8c>&#34;从mysql加载extensionWord, word={}&#34;</span>, word);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#6272a4>// 放到字典⾥</span>
</span></span><span style=display:flex><span>            Dictionary.<span style=color:#50fa7b>getSingleton</span>().<span style=color:#50fa7b>addWords</span>(extensionWords);
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            LOGGER.<span style=color:#50fa7b>error</span>(<span style=color:#f1fa8c>&#34;从mysql加载extensionWord发⽣异常&#34;</span>, e);
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>finally</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (resultSet <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>null</span>) {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>                    resultSet.<span style=color:#50fa7b>close</span>();
</span></span><span style=display:flex><span>                } <span style=color:#ff79c6>catch</span> (SQLException e) {
</span></span><span style=display:flex><span>                    LOGGER.<span style=color:#50fa7b>error</span>(e);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>null</span> <span style=color:#ff79c6>!=</span> statement) {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>                    statement.<span style=color:#50fa7b>close</span>();
</span></span><span style=display:flex><span>                } <span style=color:#ff79c6>catch</span> (SQLException e) {
</span></span><span style=display:flex><span>                    LOGGER.<span style=color:#50fa7b>error</span>(e);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>null</span> <span style=color:#ff79c6>!=</span> connection) {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>                    connection.<span style=color:#50fa7b>close</span>();
</span></span><span style=display:flex><span>                } <span style=color:#ff79c6>catch</span> (SQLException e) {
</span></span><span style=display:flex><span>                    LOGGER.<span style=color:#50fa7b>error</span>(e);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>loadMysqlStopWords</span>() {
</span></span><span style=display:flex><span>        Connection connection <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>;
</span></span><span style=display:flex><span>        Statement statement <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>;
</span></span><span style=display:flex><span>        ResultSet resultSet <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>;
</span></span><span style=display:flex><span>        String sql;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (stopWordFirstLoad.<span style=color:#50fa7b>compareAndSet</span>(<span style=color:#ff79c6>false</span>, <span style=color:#ff79c6>true</span>)) {
</span></span><span style=display:flex><span>            sql <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;SELECT word FROM stop_word&#34;</span>;
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>            sql <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;SELECT word FROM stop_word WHERE update_time &gt;= &#39;&#34;</span> <span style=color:#ff79c6>+</span> stopWordLasLoadTimeRef.<span style=color:#50fa7b>get</span>() <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;&#39;&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        SimpleDateFormat dateFormat <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> SimpleDateFormat(<span style=color:#f1fa8c>&#34;yyyy-MM-dd HH:mm:ss&#34;</span>);
</span></span><span style=display:flex><span>        String nowString <span style=color:#ff79c6>=</span> dateFormat.<span style=color:#50fa7b>format</span>(<span style=color:#ff79c6>new</span> Date());
</span></span><span style=display:flex><span>        stopWordLasLoadTimeRef.<span style=color:#50fa7b>set</span>(nowString);
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// 加载词库内容</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>            connection <span style=color:#ff79c6>=</span> DriverManager.<span style=color:#50fa7b>getConnection</span>(url, username, password);
</span></span><span style=display:flex><span>            statement <span style=color:#ff79c6>=</span> connection.<span style=color:#50fa7b>createStatement</span>();
</span></span><span style=display:flex><span>            resultSet <span style=color:#ff79c6>=</span> statement.<span style=color:#50fa7b>executeQuery</span>(sql);
</span></span><span style=display:flex><span>            LOGGER.<span style=color:#50fa7b>info</span>(<span style=color:#f1fa8c>&#34;从mysql加载stopWord, sql={}&#34;</span>, sql);
</span></span><span style=display:flex><span>            Set<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> stopWords <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> HashSet<span style=color:#ff79c6>&lt;&gt;</span>();
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>while</span> (resultSet.<span style=color:#50fa7b>next</span>()) {
</span></span><span style=display:flex><span>                String word <span style=color:#ff79c6>=</span> resultSet.<span style=color:#50fa7b>getString</span>(<span style=color:#f1fa8c>&#34;word&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>if</span> (word <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>null</span>) {
</span></span><span style=display:flex><span>                    stopWords.<span style=color:#50fa7b>add</span>(word);
</span></span><span style=display:flex><span>                    LOGGER.<span style=color:#50fa7b>info</span>(<span style=color:#f1fa8c>&#34;从mysql加载stopWord，word={}&#34;</span>, word);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#6272a4>// 放到字典⾥</span>
</span></span><span style=display:flex><span>            Dictionary.<span style=color:#50fa7b>getSingleton</span>().<span style=color:#50fa7b>addStopWords</span>(stopWords);
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            LOGGER.<span style=color:#50fa7b>error</span>(<span style=color:#f1fa8c>&#34;从mysql加载extensionWord发⽣异常&#34;</span>, e);
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>finally</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (resultSet <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>null</span>) {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>                    resultSet.<span style=color:#50fa7b>close</span>();
</span></span><span style=display:flex><span>                } <span style=color:#ff79c6>catch</span> (SQLException e) {
</span></span><span style=display:flex><span>                    LOGGER.<span style=color:#50fa7b>error</span>(e);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (statement <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>null</span>) {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>                    statement.<span style=color:#50fa7b>close</span>();
</span></span><span style=display:flex><span>                } <span style=color:#ff79c6>catch</span> (SQLException e) {
</span></span><span style=display:flex><span>                    LOGGER.<span style=color:#50fa7b>error</span>(e);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (connection <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>null</span>) {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>                    connection.<span style=color:#50fa7b>close</span>();
</span></span><span style=display:flex><span>                } <span style=color:#ff79c6>catch</span> (SQLException e) {
</span></span><span style=display:flex><span>                    LOGGER.<span style=color:#50fa7b>error</span>(e);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>然后将Dictionary的getDictRoot()改成public，在增加一个addStopWords(Collection&lt;String> words)方法:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * 添加停用词
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>addStopWords</span>(Collection<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> words) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>null</span> <span style=color:#ff79c6>!=</span> words) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> (String word : words) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>null</span> <span style=color:#ff79c6>!=</span> word) {
</span></span><span style=display:flex><span>                singleton.<span style=color:#50fa7b>_StopWords</span>.<span style=color:#50fa7b>fillSegment</span>(word.<span style=color:#50fa7b>trim</span>().<span style=color:#50fa7b>toCharArray</span>());
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>然后在Dictionary类中最开始我们打的todo注释下完善代码</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff79c6>new</span> Thread(() <span style=color:#ff79c6>-&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span> (<span style=color:#ff79c6>true</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>            DictLoader dictLoader <span style=color:#ff79c6>=</span> DictLoader.<span style=color:#50fa7b>getInstance</span>();
</span></span><span style=display:flex><span>            dictLoader.<span style=color:#50fa7b>loadExtensionWords</span>();
</span></span><span style=display:flex><span>            dictLoader.<span style=color:#50fa7b>loadMysqlStopWords</span>();
</span></span><span style=display:flex><span>            TimeUnit.<span style=color:#50fa7b>SECONDS</span>.<span style=color:#50fa7b>sleep</span>(60);
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            e.<span style=color:#50fa7b>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}).<span style=color:#50fa7b>start</span>();
</span></span></code></pre></td></tr></table></div></div><h5 id=42数据库相关>4.2数据库相关<a hidden class=anchor aria-hidden=true href=#42数据库相关>#</a></h5><p>建表语句：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>TABLE</span> <span style=color:#ff79c6>`</span>extension_word<span style=color:#ff79c6>`</span> ( <span style=color:#ff79c6>`</span>id<span style=color:#ff79c6>`</span> <span style=color:#8be9fd>int</span>(<span style=color:#bd93f9>11</span>) <span style=color:#ff79c6>NOT</span> NULL <span style=color:#ff79c6>AUTO_INCREMENT</span>, <span style=color:#ff79c6>`</span>word<span style=color:#ff79c6>`</span> <span style=color:#8be9fd>varchar</span>(<span style=color:#bd93f9>64</span>) <span style=color:#ff79c6>NOT</span> NULL, <span style=color:#ff79c6>`</span>create_time<span style=color:#ff79c6>`</span> <span style=color:#8be9fd>datetime</span> <span style=color:#ff79c6>NOT</span> NULL, <span style=color:#ff79c6>`</span>update_time<span style=color:#ff79c6>`</span> <span style=color:#8be9fd>datetime</span> <span style=color:#ff79c6>NOT</span> NULL, <span style=color:#ff79c6>PRIMARY</span> <span style=color:#ff79c6>KEY</span> (<span style=color:#ff79c6>`</span>id<span style=color:#ff79c6>`</span>) ) <span style=color:#ff79c6>ENGINE</span><span style=color:#ff79c6>=</span>InnoDB <span style=color:#ff79c6>DEFAULT</span> <span style=color:#ff79c6>CHARSET</span><span style=color:#ff79c6>=</span>utf8mb4;
</span></span><span style=display:flex><span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>TABLE</span> <span style=color:#ff79c6>`</span>stop_word<span style=color:#ff79c6>`</span> ( <span style=color:#ff79c6>`</span>id<span style=color:#ff79c6>`</span> <span style=color:#8be9fd>int</span>(<span style=color:#bd93f9>11</span>) <span style=color:#ff79c6>NOT</span> NULL <span style=color:#ff79c6>AUTO_INCREMENT</span>, <span style=color:#ff79c6>`</span>word<span style=color:#ff79c6>`</span> <span style=color:#8be9fd>varchar</span>(<span style=color:#bd93f9>64</span>) <span style=color:#ff79c6>NOT</span> NULL, <span style=color:#ff79c6>`</span>create_time<span style=color:#ff79c6>`</span> <span style=color:#8be9fd>datetime</span> <span style=color:#ff79c6>NOT</span> NULL, <span style=color:#ff79c6>`</span>update_time<span style=color:#ff79c6>`</span> <span style=color:#8be9fd>datetime</span> <span style=color:#ff79c6>NOT</span> NULL, <span style=color:#ff79c6>PRIMARY</span> <span style=color:#ff79c6>KEY</span> (<span style=color:#ff79c6>`</span>id<span style=color:#ff79c6>`</span>) ) <span style=color:#ff79c6>ENGINE</span><span style=color:#ff79c6>=</span>InnoDB <span style=color:#ff79c6>DEFAULT</span> <span style=color:#ff79c6>CHARSET</span><span style=color:#ff79c6>=</span>utf8mb4
</span></span></code></pre></td></tr></table></div></div><p>config目录下新建配置文件jdbc.properties:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#50fa7b>jdbc.url</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>jdbc:mysql://172.30.60.105:3306/es_ik?useUnicode=true&amp;useSSL=false&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>jdbc.username</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>root</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>jdbc.password</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>qiyuan1502</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=43部署>4.3部署<a hidden class=anchor aria-hidden=true href=#43部署>#</a></h5><p>执行<code>mvn clean package</code>命令打包，然后3台es机器分别执行以下操作：</p><p>新建目录</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p /app/elasticsearch/elasticsearch-7.9.3/plugins/ik
</span></span></code></pre></td></tr></table></div></div><p>然后把elasticsearch-analysis-ik-7.9.3.zip传到ik目录下解压，然后把刚刚打包的源码jar上传到ik目录里进行覆盖，把mysql-connector-java-8.0.20.jar也传上去，把jdbc.properties传到ik/config下，最后重启es：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ps -ef | grep elasticsearch
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>kill</span> <span style=color:#bd93f9>24479</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#39;&#39;</span> &gt; /app/elasticsearch/log/escluster.log
</span></span><span style=display:flex><span>/app/elasticsearch/elasticsearch-7.9.3/bin/elasticsearch -d
</span></span><span style=display:flex><span>tail -f /app/elasticsearch/log/escluster.log
</span></span></code></pre></td></tr></table></div></div><p>重启的时候可能会报错：</p><p><strong>Caused by: java.security.AccessControlException: access denied (&ldquo;java.lang.RuntimePermission&rdquo; &ldquo;setContextClassLoader&rdquo;)</strong></p><p>解决方法：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vim /app/elasticsearch/elasticsearch-7.9.3/jdk/conf/security/java.policy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 添加如下配置</span>
</span></span><span style=display:flex><span>permission java.lang.RuntimePermission <span style=color:#f1fa8c>&#34;setContextClassLoader&#34;</span>;
</span></span></code></pre></td></tr></table></div></div><p>然后又遇到错</p><p><strong>Caused by: java.security.AccessControlException: access denied (&ldquo;java.net.SocketPermission&rdquo; &ldquo;172.19.16.88:3306&rdquo; &ldquo;connect,resolve&rdquo;</strong></p><p>在之前的配置中添加配置后再次重启：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>permission java.net.SocketPermission <span style=color:#f1fa8c>&#34;*&#34;</span>, <span style=color:#f1fa8c>&#34;connect,resolve&#34;</span>;
</span></span></code></pre></td></tr></table></div></div><p>上面的两个错都是java安全管理器和访问权限相关的，可以看《java核心技术 卷2》第9章。</p><h4 id=5部署拼音分词器>5部署拼音分词器<a hidden class=anchor aria-hidden=true href=#5部署拼音分词器>#</a></h4></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangxiaohong123.github.io/tags/elasticsearch/>Elasticsearch</a></li></ul><nav class=paginav><a class=prev href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/%E7%AE%97%E6%B3%95/2.%E5%9F%BA%E7%A1%80%E6%8E%92%E5%BA%8F/><span class=title>« Prev</span><br><span>2.基础排序</span>
</a><a class=next href=https://wangxiaohong123.github.io/posts/ai/2.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/><span class=title>Next »</span><br><span>2.机器学习基础</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 2.安装es on x" href="https://x.com/intent/tweet/?text=2.%e5%ae%89%e8%a3%85es&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%2fes%2f2.%25E5%25AE%2589%25E8%25A3%2585%2f&amp;hashtags=elasticsearch"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2.安装es on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%2fes%2f2.%25E5%25AE%2589%25E8%25A3%2585%2f&amp;title=2.%e5%ae%89%e8%a3%85es&amp;summary=2.%e5%ae%89%e8%a3%85es&amp;source=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%2fes%2f2.%25E5%25AE%2589%25E8%25A3%2585%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2.安装es on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%2fes%2f2.%25E5%25AE%2589%25E8%25A3%2585%2f&title=2.%e5%ae%89%e8%a3%85es"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2.安装es on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%2fes%2f2.%25E5%25AE%2589%25E8%25A3%2585%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2.安装es on whatsapp" href="https://api.whatsapp.com/send?text=2.%e5%ae%89%e8%a3%85es%20-%20https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%2fes%2f2.%25E5%25AE%2589%25E8%25A3%2585%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2.安装es on telegram" href="https://telegram.me/share/url?text=2.%e5%ae%89%e8%a3%85es&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%2fes%2f2.%25E5%25AE%2589%25E8%25A3%2585%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2.安装es on ycombinator" href="https://news.ycombinator.com/submitlink?t=2.%e5%ae%89%e8%a3%85es&u=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%2fes%2f2.%25E5%25AE%2589%25E8%25A3%2585%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wangxiaohong123.github.io/>王小红的笔记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>