<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>jvm-6.类文件结构 | 王小红的笔记</title><meta name=keywords content="JVM"><meta name=description content="编译的结果是字节码而不是机器码实现了“一次编写，到处运行”，而且语言无关性也越来越被重视，设计java的时候就是这么考虑的，所以把Java的规范拆分成《Java语言规范》和《Java虚拟机规范》，2018年graalVM公开之后基本上实现了语言无关性，目前运行在java虚拟机上的语言有Kotlin、Groovy、JRuby、JPython、Scala等等。
实现平台、语言无关的关键就是虚拟机和编译之后的字节码(就是class文件)，比如javac把java程序编译成class文件、jrubyc把jruby程序编译成class文件。
class文件结构
class文件中只有两种数据格式，无符号数和表：

无符号数是基本数据类型，u1、u2、u4、u8分别代表1个字节、2个字节、4个字节和8个字节，无符号数用来描述数字、引用或者字符串；
表：表就是多个无符号数或者其他表组成的复合数据类型，一般表都以_info结尾，整个class其实就是一张表。

class中的数据项严格按顺序紧凑的排列，没有任何分隔符，如果一个变量需要占用1个字节以上的空间时，按照高位在前的方式分割成多个字节，比如u2类型正常的顺序是11100111 00000001，在class文件中就应该是00000001 11100111。不管是表还是符号，在描述同一个类型但是数量不确定的时候都在前面定义一个变量标记这个同类型的若干个变量的数量，class表中各个数据项：

  
      
          名称
          类型
          数量
      
  
  
      
          magic(魔数)
          u4
          1
      
      
          minor_version(次版本)
          u2
          1
      
      
          major_version(主版本)
          u2
          1
      
      
          constant_pool_count
          u2
          1
      
      
          constant_pool(常量池)
          cp_info
          constant_pool_count - 1
      
      
          access_flags(访问标志)
          u2
          1
      
      
          this_class(类索引)
          u2
          1
      
      
          super_class(父类索引)
          u2
          1
      
      
          interfaces_count
          u2
          1
      
      
          interfaces(接口索引集合)
          u2
          interfaces_count
      
      
          fields_count
          u2
          1
      
      
          fields(字段表集合)
          field_info
          fields_count
      
      
          methods_count
          u2
          1
      
      
          methods(方法表集合)
          method_info
          methods_count
      
      
          attributes_count
          u2
          1
      
      
          attributes(属性表集合)
          attribute_info
          attributes_count
      
  

1.魔数
每个class的头4个字节是魔数，他的作用是确定这个文件能不能被虚拟机接受，class的文件魔数的16进制是0xCAFEBABE(咖啡宝贝)，大部分文件都有魔数，比如图片。
2.版本
魔数后4个字节是版本，第5、6个字节是次版本，次版本号是65535时表示技术预览版功能特性，这样虚拟机在加载类文件的时候能够区分出来。
主版本从45开始，之后每个大版本号递增，比如JDK13的主版本号就是57。《Java虚拟机规范》要求虚拟机必须拒绝执行超过其主版本号的class文件，就是说JDK7不能执行JDK8编译之后的class。
3.常量池
主版本号后面紧跟着常量池，由于常量池中元素个数不确定所以在入口放了一个u2的数据表示常量池容量，class中只有这个集合类型的索引是从1开始的，比如constant_pool_count是22，那么常量池的数量就是21，设计的时候考虑到常量池的0有特殊意义。
常量池中的常量分成两类，一类是字面量，类似于Java里的常量，比如字符串、final修饰的变量等，另一类是符号引用，符号引用包括下面几类："><meta name=author content><link rel=canonical href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/6.%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/><link crossorigin=anonymous href=/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as=style><link rel=icon href=https://wangxiaohong123.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wangxiaohong123.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangxiaohong123.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wangxiaohong123.github.io/apple-touch-icon.png><link rel=mask-icon href=https://wangxiaohong123.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/6.%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=/katex/katex.min.css><script defer src=/katex/katex.min.js></script><script defer src=/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><meta property="og:url" content="https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/6.%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/"><meta property="og:site_name" content="王小红的笔记"><meta property="og:title" content="jvm-6.类文件结构"><meta property="og:description" content="编译的结果是字节码而不是机器码实现了“一次编写，到处运行”，而且语言无关性也越来越被重视，设计java的时候就是这么考虑的，所以把Java的规范拆分成《Java语言规范》和《Java虚拟机规范》，2018年graalVM公开之后基本上实现了语言无关性，目前运行在java虚拟机上的语言有Kotlin、Groovy、JRuby、JPython、Scala等等。
实现平台、语言无关的关键就是虚拟机和编译之后的字节码(就是class文件)，比如javac把java程序编译成class文件、jrubyc把jruby程序编译成class文件。
class文件结构 class文件中只有两种数据格式，无符号数和表：
无符号数是基本数据类型，u1、u2、u4、u8分别代表1个字节、2个字节、4个字节和8个字节，无符号数用来描述数字、引用或者字符串； 表：表就是多个无符号数或者其他表组成的复合数据类型，一般表都以_info结尾，整个class其实就是一张表。 class中的数据项严格按顺序紧凑的排列，没有任何分隔符，如果一个变量需要占用1个字节以上的空间时，按照高位在前的方式分割成多个字节，比如u2类型正常的顺序是11100111 00000001，在class文件中就应该是00000001 11100111。不管是表还是符号，在描述同一个类型但是数量不确定的时候都在前面定义一个变量标记这个同类型的若干个变量的数量，class表中各个数据项：
名称 类型 数量 magic(魔数) u4 1 minor_version(次版本) u2 1 major_version(主版本) u2 1 constant_pool_count u2 1 constant_pool(常量池) cp_info constant_pool_count - 1 access_flags(访问标志) u2 1 this_class(类索引) u2 1 super_class(父类索引) u2 1 interfaces_count u2 1 interfaces(接口索引集合) u2 interfaces_count fields_count u2 1 fields(字段表集合) field_info fields_count methods_count u2 1 methods(方法表集合) method_info methods_count attributes_count u2 1 attributes(属性表集合) attribute_info attributes_count 1.魔数 每个class的头4个字节是魔数，他的作用是确定这个文件能不能被虚拟机接受，class的文件魔数的16进制是0xCAFEBABE(咖啡宝贝)，大部分文件都有魔数，比如图片。
2.版本 魔数后4个字节是版本，第5、6个字节是次版本，次版本号是65535时表示技术预览版功能特性，这样虚拟机在加载类文件的时候能够区分出来。
主版本从45开始，之后每个大版本号递增，比如JDK13的主版本号就是57。《Java虚拟机规范》要求虚拟机必须拒绝执行超过其主版本号的class文件，就是说JDK7不能执行JDK8编译之后的class。
3.常量池 主版本号后面紧跟着常量池，由于常量池中元素个数不确定所以在入口放了一个u2的数据表示常量池容量，class中只有这个集合类型的索引是从1开始的，比如constant_pool_count是22，那么常量池的数量就是21，设计的时候考虑到常量池的0有特殊意义。
常量池中的常量分成两类，一类是字面量，类似于Java里的常量，比如字符串、final修饰的变量等，另一类是符号引用，符号引用包括下面几类："><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:tag" content="JVM"><meta name=twitter:card content="summary"><meta name=twitter:title content="jvm-6.类文件结构"><meta name=twitter:description content="编译的结果是字节码而不是机器码实现了“一次编写，到处运行”，而且语言无关性也越来越被重视，设计java的时候就是这么考虑的，所以把Java的规范拆分成《Java语言规范》和《Java虚拟机规范》，2018年graalVM公开之后基本上实现了语言无关性，目前运行在java虚拟机上的语言有Kotlin、Groovy、JRuby、JPython、Scala等等。
实现平台、语言无关的关键就是虚拟机和编译之后的字节码(就是class文件)，比如javac把java程序编译成class文件、jrubyc把jruby程序编译成class文件。
class文件结构
class文件中只有两种数据格式，无符号数和表：

无符号数是基本数据类型，u1、u2、u4、u8分别代表1个字节、2个字节、4个字节和8个字节，无符号数用来描述数字、引用或者字符串；
表：表就是多个无符号数或者其他表组成的复合数据类型，一般表都以_info结尾，整个class其实就是一张表。

class中的数据项严格按顺序紧凑的排列，没有任何分隔符，如果一个变量需要占用1个字节以上的空间时，按照高位在前的方式分割成多个字节，比如u2类型正常的顺序是11100111 00000001，在class文件中就应该是00000001 11100111。不管是表还是符号，在描述同一个类型但是数量不确定的时候都在前面定义一个变量标记这个同类型的若干个变量的数量，class表中各个数据项：

  
      
          名称
          类型
          数量
      
  
  
      
          magic(魔数)
          u4
          1
      
      
          minor_version(次版本)
          u2
          1
      
      
          major_version(主版本)
          u2
          1
      
      
          constant_pool_count
          u2
          1
      
      
          constant_pool(常量池)
          cp_info
          constant_pool_count - 1
      
      
          access_flags(访问标志)
          u2
          1
      
      
          this_class(类索引)
          u2
          1
      
      
          super_class(父类索引)
          u2
          1
      
      
          interfaces_count
          u2
          1
      
      
          interfaces(接口索引集合)
          u2
          interfaces_count
      
      
          fields_count
          u2
          1
      
      
          fields(字段表集合)
          field_info
          fields_count
      
      
          methods_count
          u2
          1
      
      
          methods(方法表集合)
          method_info
          methods_count
      
      
          attributes_count
          u2
          1
      
      
          attributes(属性表集合)
          attribute_info
          attributes_count
      
  

1.魔数
每个class的头4个字节是魔数，他的作用是确定这个文件能不能被虚拟机接受，class的文件魔数的16进制是0xCAFEBABE(咖啡宝贝)，大部分文件都有魔数，比如图片。
2.版本
魔数后4个字节是版本，第5、6个字节是次版本，次版本号是65535时表示技术预览版功能特性，这样虚拟机在加载类文件的时候能够区分出来。
主版本从45开始，之后每个大版本号递增，比如JDK13的主版本号就是57。《Java虚拟机规范》要求虚拟机必须拒绝执行超过其主版本号的class文件，就是说JDK7不能执行JDK8编译之后的class。
3.常量池
主版本号后面紧跟着常量池，由于常量池中元素个数不确定所以在入口放了一个u2的数据表示常量池容量，class中只有这个集合类型的索引是从1开始的，比如constant_pool_count是22，那么常量池的数量就是21，设计的时候考虑到常量池的0有特殊意义。
常量池中的常量分成两类，一类是字面量，类似于Java里的常量，比如字符串、final修饰的变量等，另一类是符号引用，符号引用包括下面几类："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangxiaohong123.github.io/posts/"},{"@type":"ListItem","position":2,"name":"jvm-6.类文件结构","item":"https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/6.%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"jvm-6.类文件结构","name":"jvm-6.类文件结构","description":"编译的结果是字节码而不是机器码实现了“一次编写，到处运行”，而且语言无关性也越来越被重视，设计java的时候就是这么考虑的，所以把Java的规范拆分成《Java语言规范》和《Java虚拟机规范》，2018年graalVM公开之后基本上实现了语言无关性，目前运行在java虚拟机上的语言有Kotlin、Groovy、JRuby、JPython、Scala等等。\n实现平台、语言无关的关键就是虚拟机和编译之后的字节码(就是class文件)，比如javac把java程序编译成class文件、jrubyc把jruby程序编译成class文件。\nclass文件结构 class文件中只有两种数据格式，无符号数和表：\n无符号数是基本数据类型，u1、u2、u4、u8分别代表1个字节、2个字节、4个字节和8个字节，无符号数用来描述数字、引用或者字符串； 表：表就是多个无符号数或者其他表组成的复合数据类型，一般表都以_info结尾，整个class其实就是一张表。 class中的数据项严格按顺序紧凑的排列，没有任何分隔符，如果一个变量需要占用1个字节以上的空间时，按照高位在前的方式分割成多个字节，比如u2类型正常的顺序是11100111 00000001，在class文件中就应该是00000001 11100111。不管是表还是符号，在描述同一个类型但是数量不确定的时候都在前面定义一个变量标记这个同类型的若干个变量的数量，class表中各个数据项：\n名称 类型 数量 magic(魔数) u4 1 minor_version(次版本) u2 1 major_version(主版本) u2 1 constant_pool_count u2 1 constant_pool(常量池) cp_info constant_pool_count - 1 access_flags(访问标志) u2 1 this_class(类索引) u2 1 super_class(父类索引) u2 1 interfaces_count u2 1 interfaces(接口索引集合) u2 interfaces_count fields_count u2 1 fields(字段表集合) field_info fields_count methods_count u2 1 methods(方法表集合) method_info methods_count attributes_count u2 1 attributes(属性表集合) attribute_info attributes_count 1.魔数 每个class的头4个字节是魔数，他的作用是确定这个文件能不能被虚拟机接受，class的文件魔数的16进制是0xCAFEBABE(咖啡宝贝)，大部分文件都有魔数，比如图片。\n2.版本 魔数后4个字节是版本，第5、6个字节是次版本，次版本号是65535时表示技术预览版功能特性，这样虚拟机在加载类文件的时候能够区分出来。\n主版本从45开始，之后每个大版本号递增，比如JDK13的主版本号就是57。《Java虚拟机规范》要求虚拟机必须拒绝执行超过其主版本号的class文件，就是说JDK7不能执行JDK8编译之后的class。\n3.常量池 主版本号后面紧跟着常量池，由于常量池中元素个数不确定所以在入口放了一个u2的数据表示常量池容量，class中只有这个集合类型的索引是从1开始的，比如constant_pool_count是22，那么常量池的数量就是21，设计的时候考虑到常量池的0有特殊意义。\n常量池中的常量分成两类，一类是字面量，类似于Java里的常量，比如字符串、final修饰的变量等，另一类是符号引用，符号引用包括下面几类：\n","keywords":["JVM"],"articleBody":"编译的结果是字节码而不是机器码实现了“一次编写，到处运行”，而且语言无关性也越来越被重视，设计java的时候就是这么考虑的，所以把Java的规范拆分成《Java语言规范》和《Java虚拟机规范》，2018年graalVM公开之后基本上实现了语言无关性，目前运行在java虚拟机上的语言有Kotlin、Groovy、JRuby、JPython、Scala等等。\n实现平台、语言无关的关键就是虚拟机和编译之后的字节码(就是class文件)，比如javac把java程序编译成class文件、jrubyc把jruby程序编译成class文件。\nclass文件结构 class文件中只有两种数据格式，无符号数和表：\n无符号数是基本数据类型，u1、u2、u4、u8分别代表1个字节、2个字节、4个字节和8个字节，无符号数用来描述数字、引用或者字符串； 表：表就是多个无符号数或者其他表组成的复合数据类型，一般表都以_info结尾，整个class其实就是一张表。 class中的数据项严格按顺序紧凑的排列，没有任何分隔符，如果一个变量需要占用1个字节以上的空间时，按照高位在前的方式分割成多个字节，比如u2类型正常的顺序是11100111 00000001，在class文件中就应该是00000001 11100111。不管是表还是符号，在描述同一个类型但是数量不确定的时候都在前面定义一个变量标记这个同类型的若干个变量的数量，class表中各个数据项：\n名称 类型 数量 magic(魔数) u4 1 minor_version(次版本) u2 1 major_version(主版本) u2 1 constant_pool_count u2 1 constant_pool(常量池) cp_info constant_pool_count - 1 access_flags(访问标志) u2 1 this_class(类索引) u2 1 super_class(父类索引) u2 1 interfaces_count u2 1 interfaces(接口索引集合) u2 interfaces_count fields_count u2 1 fields(字段表集合) field_info fields_count methods_count u2 1 methods(方法表集合) method_info methods_count attributes_count u2 1 attributes(属性表集合) attribute_info attributes_count 1.魔数 每个class的头4个字节是魔数，他的作用是确定这个文件能不能被虚拟机接受，class的文件魔数的16进制是0xCAFEBABE(咖啡宝贝)，大部分文件都有魔数，比如图片。\n2.版本 魔数后4个字节是版本，第5、6个字节是次版本，次版本号是65535时表示技术预览版功能特性，这样虚拟机在加载类文件的时候能够区分出来。\n主版本从45开始，之后每个大版本号递增，比如JDK13的主版本号就是57。《Java虚拟机规范》要求虚拟机必须拒绝执行超过其主版本号的class文件，就是说JDK7不能执行JDK8编译之后的class。\n3.常量池 主版本号后面紧跟着常量池，由于常量池中元素个数不确定所以在入口放了一个u2的数据表示常量池容量，class中只有这个集合类型的索引是从1开始的，比如constant_pool_count是22，那么常量池的数量就是21，设计的时候考虑到常量池的0有特殊意义。\n常量池中的常量分成两类，一类是字面量，类似于Java里的常量，比如字符串、final修饰的变量等，另一类是符号引用，符号引用包括下面几类：\nimport的包； 类和接口的全限定名； 字段的名称和描述符； 方法的名称和描述符； 方法句柄和方法类型； 动态常量和动态调用点； 常量池中每个常量都是一张表，现在大约有17中常量类型；\n4.访问标志 标识类的访问信息，比如是接口还是class，是不是抽象类等等，access_flags一共有16个标识位可以使用，目前只使用了9个。具体如下：\n标志名称 值 含义 ACC_PUBLIC 0x0001 是否是public类型 ACC_FINAL 0x0010 是否是final类型 ACC_SUPER 0x0020 1.0.2之后编译出来的类都有这个标志，表示是否使用invokespecial字节码指令的新语义 ACC_INTERFACE 0x0200 标识这是一个接口 ACC_ABSTRACT 0x0400 是否是abstract类型，接口和抽象类都有这个标志 ACC_SYNTHETIC 0x1000 标识这个类不是用户代码产生的 ACC_ANNOTATION 0x2000 标识这是一个注解 ACC_ENUM 0x4000 标识这是一个枚举 ACC_MODULE 0x8000 标识这是一个模块 5.类索引、父类索引和接口索引集合 这3想数据用来确认继承关系，接口是集合而父索引只是一个无符号类型，因为Java不允许多继承。除了Object类之外的所有类都有父类，所以这些类的父类索引都不是0。类索引和父类索引的值都是一个指向CONSTANT_Class_info的类描述符常量，这个常量中有个索引，通过这个索引可以在常量池中找到对应的全限定名，接口索引集合就是前面比他们多了一个接口数量。\n6.字段表集合 字段表里放的是类变量、实例变量信息，没有方法里的局部变量，字段的信息有作用域(public、private)、实例变量还是类变量(static修饰)、可变性(final修饰)、并发可见性(volatile修饰)、能都被序列化(transient修饰)、数据类型、字段名称。其中修饰符都是用标志位来表示的，字段名、字段类型没有办法固定，就引用常量池中的常量，字段表的格式：\n名称 类型 数量 access_flags：他和类的access_flags非常像，但是他只有public、private、protected、final然后多了个static u2 1 name_index：字段名称，存放的是常量池中的索引 u2 1 descriptor_index：字段和方法的描述符，存放的也是常量池中的索引 u2 1 attributes_count u2 1 attributes他和类的attribute_info一样，笔记在类的attribute_info attribute_info attributes_count 7.方法表集合 方法表和字段表是一样的东西，但是不包括方法的代码部分，代码部分在属性表的code里，如果子类没有重写父类的方法，就不会出现在方发表里，方发表也会出现编译器自动添加的方法，比如类构造器()和实例构造器()。\n8.属性表集合 属性表一共有29项，每个属性表的属性名都是指向常量池的索引，值也是一张表，属性表中Code属性是字节码中最重要的属性，虚拟机定义的部分属性：\n属性名 使用位置 含义 Code 方法表 方法内容编译成的字节码指令 ConstantValue 字段表 由final关键字定义的常量值 Deprecated 类、方发表、字段表 被声明成deprecated的方法和字段 Exceptions 方发表 方法抛出的异常表 EnclosingMethod 类 表示这个类的外围方法，局部类或者内部类才有这个属性 InnerClasses 类 内部类表 LineNumberTable Code属性 源码的行号和字节码指令的对应关系 LocalVariableTable Code属性 方法局部变量描述 StackMapTable Code属性 这是个jdk6以后的类型验证器，验证方法的局部变量和操作数栈需要\n的类型是否匹配 Signatrue 类、方发表、字段表 用来记录泛型信息，因为Java是使用擦除法实现的伪泛型。\n编译之后签名中是没有泛型的，需要单独记录 SourceFile 类 源文件名 SourceDebugException 类 记录非Java语言的程序的调试信息，比如jsp Synthetic 类、方发表、字段表 表示方法或者字段是编译器自动生成的 LocalVariableTypeTable 类 使用特征签名代替描述符，为了引入泛型后能描述泛型参数话类型 NestHost 类 内部类通过这个属性找到宿主类 NestMembers 类 宿主类通过这个属性找到内部类 每个属性都由属性名的索引(attribute_name_index)、属性长度(attribute_length)和属性值(info)组成一张表。\n方法体经过编译之后变成字节码指令存储在Code属性中，具体的Code表结构：\n名称 说明 类型 attribute_name_index 指向常量池的索引，常量池中的值固定是Code u2 attribute_length 属性长度，因为属性名索引和属性长度一共6个字节\n所以属性值长度是属性表长 - 6字节 u4 max_stack 操作数栈深度最大值 u2 max_locals 局部变量表需要的存储空间，这个是编译的时候算出来的，变量表的最小单位是变量槽\n对于byte、int这种占用1个变量槽，变量槽是可以重用的 u2 code_length u4 code 方法体的字节码，每个指令就是u1类型的单字节，所以字节码指令一共只能有256个\n现在大约200个 u1 exception_table_length u2 exception_table 异常表 attributes_length u2 attribute 异常表中有4个属性：\n名称 类型 start_pc：try左括号所在字节码偏移量 u2 end_pc：try右括号所在自己码偏移量 u2 handler_pc：发生异常时跳转到的字节码偏移量 u2 catch_type：指向CONSTANT_Class_info的索引，为0时任何异常都需要跳转到handler_pc u2 例如：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 public int inc() { int x; try { x = 1; return x; } catch(Exception e) { x = 2; return x; } finally { x = 3; } } public static void main(String[] args) { System.out.println(new Test().inc()); } // 编译后的字节码 public int inc(); descriptor: ()I flags: ACC_PUBLIC Code: stack=1, locals=5, args_size=1 0: iconst_1 1: istore_1 2: iload_1 3: istore_2 4: iconst_3 5: istore_1 6: iload_2 7: ireturn 8: astore_2 9: iconst_2 10: istore_1 11: iload_1 12: istore_3 13: iconst_3 14: istore_1 15: iload_3 16: ireturn 17: astore 4 19: iconst_3 20: istore_1 21: aload 4 23: athrow Exception table: from to target type 0 4 8 Class java/lang/Exception 0 4 17 any 8 13 17 any 17 19 17 any LineNumberTable: line 7: 0 line 8: 2 line 13: 4 line 8: 6 line 9: 8 line 10: 9 line 11: 11 line 13: 13 line 11: 15 line 13: 17 line 14: 21 StackMapTable: number_of_entries = 2 frame_type = 72 /* same_locals_1_stack_item */ stack = [ class java/lang/Exception ] frame_type = 72 /* same_locals_1_stack_item */ stack = [ class java/lang/Throwable ] 上面的字节码中args_size是1，这个参数就是this，把this当参数传到方法中，这样就可以在方法中调用实例的属性了。\n字节码指令 下面的指令中T表示模板，可以替换成i、l、d、f等，i就是int的缩写，d就是double的缩写，reference类型用a表示。有的指令会不支持一些类型，Tconst不支持byte、short等类型，编译器会把他们转成int处理，还有boolean，所有指令都不能处理boolean，也要转成int。\n1.加载和存储指令 用来把数据在栈针中的局部变量表和操作数栈之间传输数据：\n把局部变量加载到操作数栈：Tload 把数据从操作数栈存储到局部变量表：Tstore 把常量加载到操作数栈：Tipush、ldc、Tconst 扩充局部变量表的访问索引：wide 2.运算指令 Tadd：加法指令 Tsub：减法指令 Tmul：乘法指令 Tdiv：除法指令 Trem：求余指令 Tneg：取反指令 Tshl、Tshr、Tushr：位移指令 Tor：或指令 Tand：与指令 Txor：异或指令 iinc：自增，只支持int类型 dcmpg、dcmpl、fcmpg、fcmpl、lcmp：比较指令 3.类型转换指令 虚拟机支持小范围向大范围不需要指令。大范围向小范围转换包括：i2b、i2c、i2s、l2i、f2i、f2l、d2i、d2l、d2f。转换结果可能导致数据不对、正负不对、精度丢失，比如long转int就是高高位丢弃，这样如果一个负数转换就可能变成正数，NaN转long或者int统一是0，如果double转float太小无法表示，就会变成0，如果太大无法表示就是无穷大。\n4.对象创建和访问指令 创建类实例：new 创建数组：newarray、anewarray、multianewarray 访问变量：getfield、putfield、getstatic、putstatic 把数组元素加载到操作数栈：Taload 把操作数栈的值存到数组中：Tastore 获取数组长度：arraylength 检查类实例类型：instanceof、checkcast 5.操作数栈管理指令 把栈顶的1个或2个元素出栈：pop、pop2 复制栈顶元素并重新压入栈顶：dup 把栈顶两个值互换：swap 6.控制转移指令 条件分支：ifeq、iflt、ifle、ifne、ifgt、ifge、ifnull、ifnonnull、if_icmpeq、if_icmpne、if_icmplt、if_icmpgt、if_icmple、if_icmpge、if_icmpeq、if_acmpne 复合条件分支：tableswitch、lookupswitch 无条件分支：goto、goto_w、jsr、jsr_w、ret 7.方法调用和返回指令 调用对象的实例方法：invokevirtual 调用接口方法：invokeinterface 调用一些需要特殊处理的实例方法，比如初始化、父类方法：invokespecial 调用静态方法：invokestatic 调用运行时动态根据限定符解析出的方法：invokedynamic 返回指令：Treturn 8.异常处理指令 方法中的try catch不是由指令完成的，而是由异常表完成的，很早之前是使用jsr和ret，现在不用了，显示抛出的异常由athrow指令实现。\n9.同步指令 同步都是使用管程(monitor)实现，方法级同步是通过方发表中的ACC_AYNCHRONIZED标志实现，如果设置了这个标志，执行线程要先持有管程，方法结束或者抛出异常会在方法边界之外自动释放管程。\n同步代码块是通过monitorenter和monitorexit指令实现，编译器需要保证monitorenter和monitorexit的执行必须要成对，所以如果方法没有任何异常处理的情况编译器也会生成一个异常表用来保证monitorenter和monitorexit配对执行，防止代码发生异常管程不释放。\n","wordCount":"538","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/6.%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/"},"publisher":{"@type":"Organization","name":"王小红的笔记","logo":{"@type":"ImageObject","url":"https://wangxiaohong123.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangxiaohong123.github.io/ accesskey=h title="王小红的笔记 (Alt + H)">王小红的笔记</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wangxiaohong123.github.io/posts/ title=笔记><span>笔记</span></a></li><li><a href=https://wangxiaohong123.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://wangxiaohong123.github.io/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">jvm-6.类文件结构</h1><div class=post-meta>3 min</div></header><div class=post-content><p>编译的结果是字节码而不是机器码实现了“一次编写，到处运行”，而且语言无关性也越来越被重视，设计java的时候就是这么考虑的，所以把Java的规范拆分成《Java语言规范》和《Java虚拟机规范》，2018年graalVM公开之后基本上实现了语言无关性，目前运行在java虚拟机上的语言有Kotlin、Groovy、JRuby、JPython、Scala等等。</p><p>实现平台、语言无关的关键就是虚拟机和编译之后的字节码(就是class文件)，比如javac把java程序编译成class文件、jrubyc把jruby程序编译成class文件。</p><h5 id=class文件结构>class文件结构<a hidden class=anchor aria-hidden=true href=#class文件结构>#</a></h5><p>class文件中只有两种数据格式，无符号数和表：</p><ul><li>无符号数是基本数据类型，u1、u2、u4、u8分别代表1个字节、2个字节、4个字节和8个字节，无符号数用来描述数字、引用或者字符串；</li><li>表：表就是多个无符号数或者其他表组成的复合数据类型，一般表都以_info结尾，整个class其实就是一张表。</li></ul><p><strong>class中的数据项严格按顺序紧凑的排列，没有任何分隔符</strong>，如果一个变量需要占用1个字节以上的空间时，按照高位在前的方式分割成多个字节，比如u2类型正常的顺序是11100111 00000001，在class文件中就应该是00000001 11100111。不管是表还是符号，在描述同一个类型但是数量不确定的时候都在前面定义一个变量标记这个同类型的若干个变量的数量，class表中各个数据项：</p><table><thead><tr><th>名称</th><th>类型</th><th>数量</th></tr></thead><tbody><tr><td>magic(魔数)</td><td>u4</td><td>1</td></tr><tr><td>minor_version(次版本)</td><td>u2</td><td>1</td></tr><tr><td>major_version(主版本)</td><td>u2</td><td>1</td></tr><tr><td>constant_pool_count</td><td>u2</td><td>1</td></tr><tr><td>constant_pool(常量池)</td><td>cp_info</td><td>constant_pool_count - 1</td></tr><tr><td>access_flags(访问标志)</td><td>u2</td><td>1</td></tr><tr><td>this_class(类索引)</td><td>u2</td><td>1</td></tr><tr><td>super_class(父类索引)</td><td>u2</td><td>1</td></tr><tr><td>interfaces_count</td><td>u2</td><td>1</td></tr><tr><td>interfaces(接口索引集合)</td><td>u2</td><td>interfaces_count</td></tr><tr><td>fields_count</td><td>u2</td><td>1</td></tr><tr><td>fields(字段表集合)</td><td>field_info</td><td>fields_count</td></tr><tr><td>methods_count</td><td>u2</td><td>1</td></tr><tr><td>methods(方法表集合)</td><td>method_info</td><td>methods_count</td></tr><tr><td>attributes_count</td><td>u2</td><td>1</td></tr><tr><td>attributes(属性表集合)</td><td>attribute_info</td><td>attributes_count</td></tr></tbody></table><h6 id=1魔数>1.魔数<a hidden class=anchor aria-hidden=true href=#1魔数>#</a></h6><p>每个class的头4个字节是魔数，他的作用是确定这个文件能不能被虚拟机接受，class的文件魔数的16进制是0xCAFEBABE(咖啡宝贝)，大部分文件都有魔数，比如图片。</p><h6 id=2版本>2.版本<a hidden class=anchor aria-hidden=true href=#2版本>#</a></h6><p>魔数后4个字节是版本，第5、6个字节是次版本，次版本号是65535时表示技术预览版功能特性，这样虚拟机在加载类文件的时候能够区分出来。</p><p>主版本从45开始，之后每个大版本号递增，比如JDK13的主版本号就是57。《Java虚拟机规范》要求虚拟机必须拒绝执行超过其主版本号的class文件，就是说JDK7不能执行JDK8编译之后的class。</p><h6 id=3常量池>3.常量池<a hidden class=anchor aria-hidden=true href=#3常量池>#</a></h6><p>主版本号后面紧跟着常量池，由于常量池中元素个数不确定所以在入口放了一个u2的数据表示常量池容量，<strong>class中只有这个集合类型的索引是从1开始的</strong>，比如constant_pool_count是22，那么常量池的数量就是21，设计的时候考虑到常量池的0有特殊意义。</p><p>常量池中的常量分成两类，一类是字面量，类似于Java里的常量，比如字符串、final修饰的变量等，另一类是符号引用，符号引用包括下面几类：</p><ul><li>import的包；</li><li>类和接口的全限定名；</li><li>字段的名称和描述符；</li><li>方法的名称和描述符；</li><li>方法句柄和方法类型；</li><li>动态常量和动态调用点；</li></ul><p>常量池中每个常量都是一张表，现在大约有17中常量类型；</p><h6 id=4访问标志>4.访问标志<a hidden class=anchor aria-hidden=true href=#4访问标志>#</a></h6><p>标识类的访问信息，比如是接口还是class，是不是抽象类等等，access_flags一共有16个标识位可以使用，目前只使用了9个。具体如下：</p><table><thead><tr><th>标志名称</th><th>值</th><th>含义</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x0001</td><td>是否是public类型</td></tr><tr><td>ACC_FINAL</td><td>0x0010</td><td>是否是final类型</td></tr><tr><td>ACC_SUPER</td><td>0x0020</td><td>1.0.2之后编译出来的类都有这个标志，表示是否使用invokespecial字节码指令的新语义</td></tr><tr><td>ACC_INTERFACE</td><td>0x0200</td><td>标识这是一个接口</td></tr><tr><td>ACC_ABSTRACT</td><td>0x0400</td><td>是否是abstract类型，接口和抽象类都有这个标志</td></tr><tr><td>ACC_SYNTHETIC</td><td>0x1000</td><td>标识这个类不是用户代码产生的</td></tr><tr><td>ACC_ANNOTATION</td><td>0x2000</td><td>标识这是一个注解</td></tr><tr><td>ACC_ENUM</td><td>0x4000</td><td>标识这是一个枚举</td></tr><tr><td>ACC_MODULE</td><td>0x8000</td><td>标识这是一个模块</td></tr></tbody></table><h6 id=5类索引父类索引和接口索引集合>5.类索引、父类索引和接口索引集合<a hidden class=anchor aria-hidden=true href=#5类索引父类索引和接口索引集合>#</a></h6><p>这3想数据用来确认继承关系，接口是集合而父索引只是一个无符号类型，因为Java不允许多继承。除了Object类之外的所有类都有父类，所以这些类的父类索引都不是0。类索引和父类索引的值都是一个指向CONSTANT_Class_info的类描述符常量，这个常量中有个索引，通过这个索引可以在常量池中找到对应的全限定名，接口索引集合就是前面比他们多了一个接口数量。</p><h6 id=6字段表集合>6.字段表集合<a hidden class=anchor aria-hidden=true href=#6字段表集合>#</a></h6><p>字段表里放的是类变量、实例变量信息，没有方法里的局部变量，字段的信息有作用域(public、private)、实例变量还是类变量(static修饰)、可变性(final修饰)、并发可见性(volatile修饰)、能都被序列化(transient修饰)、数据类型、字段名称。其中修饰符都是用标志位来表示的，字段名、字段类型没有办法固定，就引用常量池中的常量，字段表的格式：</p><table><thead><tr><th>名称</th><th>类型</th><th>数量</th></tr></thead><tbody><tr><td>access_flags：他和类的access_flags非常像，但是他只有public、private、protected、final然后多了个static</td><td>u2</td><td>1</td></tr><tr><td>name_index：字段名称，存放的是常量池中的索引</td><td>u2</td><td>1</td></tr><tr><td>descriptor_index：字段和方法的描述符，存放的也是常量池中的索引</td><td>u2</td><td>1</td></tr><tr><td>attributes_count</td><td>u2</td><td>1</td></tr><tr><td>attributes他和类的attribute_info一样，笔记在类的attribute_info</td><td>attribute_info</td><td>attributes_count</td></tr></tbody></table><h6 id=7方法表集合>7.方法表集合<a hidden class=anchor aria-hidden=true href=#7方法表集合>#</a></h6><p>方法表和字段表是一样的东西，但是不包括方法的代码部分，代码部分在属性表的code里，如果子类没有重写父类的方法，就不会出现在方发表里，方发表也会出现编译器自动添加的方法，比如类构造器&lt;clinit>()和实例构造器&lt;init>()。</p><h6 id=8属性表集合>8.属性表集合<a hidden class=anchor aria-hidden=true href=#8属性表集合>#</a></h6><p>属性表一共有29项，每个属性表的属性名都是指向常量池的索引，值也是一张表，属性表中Code属性是字节码中最重要的属性，虚拟机定义的部分属性：</p><table><thead><tr><th>属性名</th><th>使用位置</th><th>含义</th></tr></thead><tbody><tr><td>Code</td><td>方法表</td><td>方法内容编译成的字节码指令</td></tr><tr><td>ConstantValue</td><td>字段表</td><td>由final关键字定义的常量值</td></tr><tr><td>Deprecated</td><td>类、方发表、字段表</td><td>被声明成deprecated的方法和字段</td></tr><tr><td>Exceptions</td><td>方发表</td><td>方法抛出的异常表</td></tr><tr><td>EnclosingMethod</td><td>类</td><td>表示这个类的外围方法，局部类或者内部类才有这个属性</td></tr><tr><td>InnerClasses</td><td>类</td><td>内部类表</td></tr><tr><td>LineNumberTable</td><td>Code属性</td><td>源码的行号和字节码指令的对应关系</td></tr><tr><td>LocalVariableTable</td><td>Code属性</td><td>方法局部变量描述</td></tr><tr><td>StackMapTable</td><td>Code属性</td><td>这是个jdk6以后的类型验证器，验证方法的局部变量和操作数栈需要<br>的类型是否匹配</td></tr><tr><td>Signatrue</td><td>类、方发表、字段表</td><td>用来记录泛型信息，因为Java是使用擦除法实现的伪泛型。<br>编译之后签名中是没有泛型的，需要单独记录</td></tr><tr><td>SourceFile</td><td>类</td><td>源文件名</td></tr><tr><td>SourceDebugException</td><td>类</td><td>记录非Java语言的程序的调试信息，比如jsp</td></tr><tr><td>Synthetic</td><td>类、方发表、字段表</td><td>表示方法或者字段是编译器自动生成的</td></tr><tr><td>LocalVariableTypeTable</td><td>类</td><td>使用特征签名代替描述符，为了引入泛型后能描述泛型参数话类型</td></tr><tr><td>NestHost</td><td>类</td><td>内部类通过这个属性找到宿主类</td></tr><tr><td>NestMembers</td><td>类</td><td>宿主类通过这个属性找到内部类</td></tr></tbody></table><p>每个属性都由属性名的索引(attribute_name_index)、属性长度(attribute_length)和属性值(info)组成一张表。</p><p>方法体经过编译之后变成字节码指令存储在Code属性中，具体的Code表结构：</p><table><thead><tr><th>名称</th><th>说明</th><th>类型</th></tr></thead><tbody><tr><td>attribute_name_index</td><td>指向常量池的索引，常量池中的值固定是Code</td><td>u2</td></tr><tr><td>attribute_length</td><td>属性长度，因为属性名索引和属性长度一共6个字节<br>所以属性值长度是属性表长 - 6字节</td><td>u4</td></tr><tr><td>max_stack</td><td>操作数栈深度最大值</td><td>u2</td></tr><tr><td>max_locals</td><td>局部变量表需要的存储空间，这个是编译的时候算出来的，变量表的最小单位是变量槽<br>对于byte、int这种占用1个变量槽，变量槽是可以重用的</td><td>u2</td></tr><tr><td>code_length</td><td></td><td>u4</td></tr><tr><td>code</td><td>方法体的字节码，每个指令就是u1类型的单字节，所以字节码指令一共只能有256个<br>现在大约200个</td><td>u1</td></tr><tr><td>exception_table_length</td><td></td><td>u2</td></tr><tr><td>exception_table</td><td>异常表</td><td></td></tr><tr><td>attributes_length</td><td></td><td>u2</td></tr><tr><td>attribute</td><td></td><td></td></tr></tbody></table><p>异常表中有4个属性：</p><table><thead><tr><th>名称</th><th>类型</th></tr></thead><tbody><tr><td>start_pc：try左括号所在字节码偏移量</td><td>u2</td></tr><tr><td>end_pc：try右括号所在自己码偏移量</td><td>u2</td></tr><tr><td>handler_pc：发生异常时跳转到的字节码偏移量</td><td>u2</td></tr><tr><td>catch_type：指向CONSTANT_Class_info的索引，为0时任何异常都需要跳转到handler_pc</td><td>u2</td></tr></tbody></table><p>例如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>inc</span>() {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> x;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>        x <span style=color:#ff79c6>=</span> 1;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> x;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>catch</span>(Exception e) {
</span></span><span style=display:flex><span>        x <span style=color:#ff79c6>=</span> 2;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> x;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>finally</span> {
</span></span><span style=display:flex><span>        x <span style=color:#ff79c6>=</span> 3;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>main</span>(String<span style=color:#ff79c6>[]</span> args) {
</span></span><span style=display:flex><span>    System.<span style=color:#50fa7b>out</span>.<span style=color:#50fa7b>println</span>(<span style=color:#ff79c6>new</span> Test().<span style=color:#50fa7b>inc</span>());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// 编译后的字节码</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>inc</span>();
</span></span><span style=display:flex><span>    descriptor: ()I
</span></span><span style=display:flex><span>    flags: ACC_PUBLIC
</span></span><span style=display:flex><span>    Code:
</span></span><span style=display:flex><span>      stack<span style=color:#ff79c6>=</span>1, locals<span style=color:#ff79c6>=</span>5, args_size<span style=color:#ff79c6>=</span>1
</span></span><span style=display:flex><span>         0: iconst_1
</span></span><span style=display:flex><span>         1: istore_1
</span></span><span style=display:flex><span>         2: iload_1
</span></span><span style=display:flex><span>         3: istore_2
</span></span><span style=display:flex><span>         4: iconst_3
</span></span><span style=display:flex><span>         5: istore_1
</span></span><span style=display:flex><span>         6: iload_2
</span></span><span style=display:flex><span>         7: ireturn
</span></span><span style=display:flex><span>         8: astore_2
</span></span><span style=display:flex><span>         9: iconst_2
</span></span><span style=display:flex><span>        10: istore_1
</span></span><span style=display:flex><span>        11: iload_1
</span></span><span style=display:flex><span>        12: istore_3
</span></span><span style=display:flex><span>        13: iconst_3
</span></span><span style=display:flex><span>        14: istore_1
</span></span><span style=display:flex><span>        15: iload_3
</span></span><span style=display:flex><span>        16: ireturn
</span></span><span style=display:flex><span>        17: astore        4
</span></span><span style=display:flex><span>        19: iconst_3
</span></span><span style=display:flex><span>        20: istore_1
</span></span><span style=display:flex><span>        21: aload         4
</span></span><span style=display:flex><span>        23: athrow
</span></span><span style=display:flex><span>      Exception table:
</span></span><span style=display:flex><span>         from    to  target type
</span></span><span style=display:flex><span>             0     4     8   Class java<span style=color:#ff79c6>/</span>lang<span style=color:#ff79c6>/</span>Exception
</span></span><span style=display:flex><span>             0     4    17   any
</span></span><span style=display:flex><span>             8    13    17   any
</span></span><span style=display:flex><span>            17    19    17   any
</span></span><span style=display:flex><span>      LineNumberTable:
</span></span><span style=display:flex><span>        line 7: 0
</span></span><span style=display:flex><span>        line 8: 2
</span></span><span style=display:flex><span>        line 13: 4
</span></span><span style=display:flex><span>        line 8: 6
</span></span><span style=display:flex><span>        line 9: 8
</span></span><span style=display:flex><span>        line 10: 9
</span></span><span style=display:flex><span>        line 11: 11
</span></span><span style=display:flex><span>        line 13: 13
</span></span><span style=display:flex><span>        line 11: 15
</span></span><span style=display:flex><span>        line 13: 17
</span></span><span style=display:flex><span>        line 14: 21
</span></span><span style=display:flex><span>      StackMapTable: number_of_entries <span style=color:#ff79c6>=</span> 2
</span></span><span style=display:flex><span>        frame_type <span style=color:#ff79c6>=</span> 72 <span style=color:#6272a4>/* same_locals_1_stack_item */</span>
</span></span><span style=display:flex><span>          stack <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>[</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>java</span><span style=color:#ff79c6>/</span>lang<span style=color:#ff79c6>/</span>Exception <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>        frame_type <span style=color:#ff79c6>=</span> 72 <span style=color:#6272a4>/* same_locals_1_stack_item */</span>
</span></span><span style=display:flex><span>          stack <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>[</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>java</span><span style=color:#ff79c6>/</span>lang<span style=color:#ff79c6>/</span>Throwable <span style=color:#ff79c6>]</span>
</span></span></code></pre></td></tr></table></div></div><p>上面的字节码中args_size是1，<strong>这个参数就是this，把this当参数传到方法中，这样就可以在方法中调用实例的属性了</strong>。</p><h5 id=字节码指令>字节码指令<a hidden class=anchor aria-hidden=true href=#字节码指令>#</a></h5><p>下面的指令中T表示模板，可以替换成i、l、d、f等，i就是int的缩写，d就是double的缩写，reference类型用a表示。<strong>有的指令会不支持一些类型，Tconst不支持byte、short等类型</strong>，编译器会把他们转成int处理，还有boolean，<strong>所有指令都不能处理boolean</strong>，也要转成int。</p><h6 id=1加载和存储指令>1.加载和存储指令<a hidden class=anchor aria-hidden=true href=#1加载和存储指令>#</a></h6><p>用来把数据在栈针中的局部变量表和操作数栈之间传输数据：</p><ul><li>把局部变量加载到操作数栈：Tload</li><li>把数据从操作数栈存储到局部变量表：Tstore</li><li>把常量加载到操作数栈：Tipush、ldc、Tconst</li><li>扩充局部变量表的访问索引：wide</li></ul><h6 id=2运算指令>2.运算指令<a hidden class=anchor aria-hidden=true href=#2运算指令>#</a></h6><ul><li>Tadd：加法指令</li><li>Tsub：减法指令</li><li>Tmul：乘法指令</li><li>Tdiv：除法指令</li><li>Trem：求余指令</li><li>Tneg：取反指令</li><li>Tshl、Tshr、Tushr：位移指令</li><li>Tor：或指令</li><li>Tand：与指令</li><li>Txor：异或指令</li><li>iinc：自增，只支持int类型</li><li>dcmpg、dcmpl、fcmpg、fcmpl、lcmp：比较指令</li></ul><h6 id=3类型转换指令>3.类型转换指令<a hidden class=anchor aria-hidden=true href=#3类型转换指令>#</a></h6><p>虚拟机支持小范围向大范围不需要指令。大范围向小范围转换包括：i2b、i2c、i2s、l2i、f2i、f2l、d2i、d2l、d2f。转换结果可能导致数据不对、正负不对、精度丢失，比如long转int就是高高位丢弃，这样如果一个负数转换就可能变成正数，NaN转long或者int统一是0，如果double转float太小无法表示，就会变成0，如果太大无法表示就是无穷大。</p><h6 id=4对象创建和访问指令>4.对象创建和访问指令<a hidden class=anchor aria-hidden=true href=#4对象创建和访问指令>#</a></h6><ul><li>创建类实例：new</li><li>创建数组：newarray、anewarray、multianewarray</li><li>访问变量：getfield、putfield、getstatic、putstatic</li><li>把数组元素加载到操作数栈：Taload</li><li>把操作数栈的值存到数组中：Tastore</li><li>获取数组长度：arraylength</li><li>检查类实例类型：instanceof、checkcast</li></ul><h6 id=5操作数栈管理指令>5.操作数栈管理指令<a hidden class=anchor aria-hidden=true href=#5操作数栈管理指令>#</a></h6><ul><li>把栈顶的1个或2个元素出栈：pop、pop2</li><li>复制栈顶元素并重新压入栈顶：dup</li><li>把栈顶两个值互换：swap</li></ul><h6 id=6控制转移指令>6.控制转移指令<a hidden class=anchor aria-hidden=true href=#6控制转移指令>#</a></h6><ul><li>条件分支：ifeq、iflt、ifle、ifne、ifgt、ifge、ifnull、ifnonnull、if_icmpeq、if_icmpne、if_icmplt、if_icmpgt、if_icmple、if_icmpge、if_icmpeq、if_acmpne</li><li>复合条件分支：tableswitch、lookupswitch</li><li>无条件分支：goto、goto_w、jsr、jsr_w、ret</li></ul><h6 id=7方法调用和返回指令>7.方法调用和返回指令<a hidden class=anchor aria-hidden=true href=#7方法调用和返回指令>#</a></h6><ul><li>调用对象的实例方法：invokevirtual</li><li>调用接口方法：invokeinterface</li><li>调用一些需要特殊处理的实例方法，比如初始化、父类方法：invokespecial</li><li>调用静态方法：invokestatic</li><li>调用运行时动态根据限定符解析出的方法：invokedynamic</li><li>返回指令：Treturn</li></ul><h6 id=8异常处理指令>8.异常处理指令<a hidden class=anchor aria-hidden=true href=#8异常处理指令>#</a></h6><p>方法中的try catch不是由指令完成的，而是由异常表完成的，很早之前是使用jsr和ret，现在不用了，显示抛出的异常由athrow指令实现。</p><h6 id=9同步指令>9.同步指令<a hidden class=anchor aria-hidden=true href=#9同步指令>#</a></h6><p>同步都是使用管程(monitor)实现，方法级同步是通过方发表中的ACC_AYNCHRONIZED标志实现，如果设置了这个标志，执行线程要先持有管程，方法结束或者抛出异常会在方法边界之外自动释放管程。</p><p>同步代码块是通过monitorenter和monitorexit指令实现，编译器需要保证monitorenter和monitorexit的执行必须要成对，所以如果方法没有任何异常处理的情况编译器也会生成一个异常表用来保证monitorenter和monitorexit配对执行，防止代码发生异常管程不释放。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangxiaohong123.github.io/tags/jvm/>JVM</a></li></ul><nav class=paginav><a class=prev href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/5.%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/><span class=title>« Prev</span><br><span>jvm-5.常用工具</span>
</a><a class=next href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/7.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/><span class=title>Next »</span><br><span>jvm-7.类加载机制</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-6.类文件结构 on x" href="https://x.com/intent/tweet/?text=jvm-6.%e7%b1%bb%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f6.%25E7%25B1%25BB%25E6%2596%2587%25E4%25BB%25B6%25E7%25BB%2593%25E6%259E%2584%2f&amp;hashtags=JVM"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-6.类文件结构 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f6.%25E7%25B1%25BB%25E6%2596%2587%25E4%25BB%25B6%25E7%25BB%2593%25E6%259E%2584%2f&amp;title=jvm-6.%e7%b1%bb%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84&amp;summary=jvm-6.%e7%b1%bb%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84&amp;source=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f6.%25E7%25B1%25BB%25E6%2596%2587%25E4%25BB%25B6%25E7%25BB%2593%25E6%259E%2584%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-6.类文件结构 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f6.%25E7%25B1%25BB%25E6%2596%2587%25E4%25BB%25B6%25E7%25BB%2593%25E6%259E%2584%2f&title=jvm-6.%e7%b1%bb%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-6.类文件结构 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f6.%25E7%25B1%25BB%25E6%2596%2587%25E4%25BB%25B6%25E7%25BB%2593%25E6%259E%2584%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-6.类文件结构 on whatsapp" href="https://api.whatsapp.com/send?text=jvm-6.%e7%b1%bb%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84%20-%20https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f6.%25E7%25B1%25BB%25E6%2596%2587%25E4%25BB%25B6%25E7%25BB%2593%25E6%259E%2584%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-6.类文件结构 on telegram" href="https://telegram.me/share/url?text=jvm-6.%e7%b1%bb%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f6.%25E7%25B1%25BB%25E6%2596%2587%25E4%25BB%25B6%25E7%25BB%2593%25E6%259E%2584%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-6.类文件结构 on ycombinator" href="https://news.ycombinator.com/submitlink?t=jvm-6.%e7%b1%bb%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84&u=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f6.%25E7%25B1%25BB%25E6%2596%2587%25E4%25BB%25B6%25E7%25BB%2593%25E6%259E%2584%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wangxiaohong123.github.io/>王小红的笔记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>