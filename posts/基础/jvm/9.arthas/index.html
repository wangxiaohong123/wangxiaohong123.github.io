<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>jvm-9.arthas | 王小红的笔记</title><meta name=keywords content="JVM"><meta name=description content="1.定位
他的定位是监控、排查故障以及性能优化。
2.用法
a.启动
启动方式有两种，第一种下载jar包[https://arthas.aliyun.com/arthas-boot.jar]，下载完直接使用jar包的方式启动：


1
2
3
4


# telnet-port 指定arthas监听的telnet端口，用来和arthas shell通信
# -1表示不监听，0表示随机
# 相关配置在arthas.properties里
java -jar arthas-boot.jar --telnet-port 4659 <pid>


启动之后可以看到监听端口

第二种下载arthas远程客户端(启动远程客户端需要先安装telnet)


1
2
3
4


curl -L https://arthas.aliyun.com/install.sh | sh

# 启动并指定监听进程的ip和端口，这里设置的是Web Console页面的ip和端口
./as.sh --target-ip 127.0.0.1 --target-port 8888 <pid>


不管哪种方式启动，如果启动时没有指定进程id，会列出所有java进程："><meta name=author content><link rel=canonical href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/9.arthas/><link crossorigin=anonymous href=/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as=style><link rel=icon href=https://wangxiaohong123.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wangxiaohong123.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangxiaohong123.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wangxiaohong123.github.io/apple-touch-icon.png><link rel=mask-icon href=https://wangxiaohong123.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/9.arthas/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=/katex/katex.min.css><script defer src=/katex/katex.min.js></script><script defer src=/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><meta property="og:url" content="https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/9.arthas/"><meta property="og:site_name" content="王小红的笔记"><meta property="og:title" content="jvm-9.arthas"><meta property="og:description" content="1.定位 他的定位是监控、排查故障以及性能优化。
2.用法 a.启动 启动方式有两种，第一种下载jar包[https://arthas.aliyun.com/arthas-boot.jar]，下载完直接使用jar包的方式启动：
1 2 3 4 # telnet-port 指定arthas监听的telnet端口，用来和arthas shell通信 # -1表示不监听，0表示随机 # 相关配置在arthas.properties里 java -jar arthas-boot.jar --telnet-port 4659 <pid> 启动之后可以看到监听端口
第二种下载arthas远程客户端(启动远程客户端需要先安装telnet)
1 2 3 4 curl -L https://arthas.aliyun.com/install.sh | sh # 启动并指定监听进程的ip和端口，这里设置的是Web Console页面的ip和端口 ./as.sh --target-ip 127.0.0.1 --target-port 8888 <pid> 不管哪种方式启动，如果启动时没有指定进程id，会列出所有java进程："><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:tag" content="JVM"><meta name=twitter:card content="summary"><meta name=twitter:title content="jvm-9.arthas"><meta name=twitter:description content="1.定位
他的定位是监控、排查故障以及性能优化。
2.用法
a.启动
启动方式有两种，第一种下载jar包[https://arthas.aliyun.com/arthas-boot.jar]，下载完直接使用jar包的方式启动：


1
2
3
4


# telnet-port 指定arthas监听的telnet端口，用来和arthas shell通信
# -1表示不监听，0表示随机
# 相关配置在arthas.properties里
java -jar arthas-boot.jar --telnet-port 4659 <pid>


启动之后可以看到监听端口

第二种下载arthas远程客户端(启动远程客户端需要先安装telnet)


1
2
3
4


curl -L https://arthas.aliyun.com/install.sh | sh

# 启动并指定监听进程的ip和端口，这里设置的是Web Console页面的ip和端口
./as.sh --target-ip 127.0.0.1 --target-port 8888 <pid>


不管哪种方式启动，如果启动时没有指定进程id，会列出所有java进程："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangxiaohong123.github.io/posts/"},{"@type":"ListItem","position":2,"name":"jvm-9.arthas","item":"https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/9.arthas/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"jvm-9.arthas","name":"jvm-9.arthas","description":"1.定位 他的定位是监控、排查故障以及性能优化。\n2.用法 a.启动 启动方式有两种，第一种下载jar包[https://arthas.aliyun.com/arthas-boot.jar]，下载完直接使用jar包的方式启动：\n1 2 3 4 # telnet-port 指定arthas监听的telnet端口，用来和arthas shell通信 # -1表示不监听，0表示随机 # 相关配置在arthas.properties里 java -jar arthas-boot.jar --telnet-port 4659 \u0026lt;pid\u0026gt; 启动之后可以看到监听端口\n第二种下载arthas远程客户端(启动远程客户端需要先安装telnet)\n1 2 3 4 curl -L https://arthas.aliyun.com/install.sh | sh # 启动并指定监听进程的ip和端口，这里设置的是Web Console页面的ip和端口 ./as.sh --target-ip 127.0.0.1 --target-port 8888 \u0026lt;pid\u0026gt; 不管哪种方式启动，如果启动时没有指定进程id，会列出所有java进程：\n","keywords":["JVM"],"articleBody":"1.定位 他的定位是监控、排查故障以及性能优化。\n2.用法 a.启动 启动方式有两种，第一种下载jar包[https://arthas.aliyun.com/arthas-boot.jar]，下载完直接使用jar包的方式启动：\n1 2 3 4 # telnet-port 指定arthas监听的telnet端口，用来和arthas shell通信 # -1表示不监听，0表示随机 # 相关配置在arthas.properties里 java -jar arthas-boot.jar --telnet-port 4659 启动之后可以看到监听端口\n第二种下载arthas远程客户端(启动远程客户端需要先安装telnet)\n1 2 3 4 curl -L https://arthas.aliyun.com/install.sh | sh # 启动并指定监听进程的ip和端口，这里设置的是Web Console页面的ip和端口 ./as.sh --target-ip 127.0.0.1 --target-port 8888 不管哪种方式启动，如果启动时没有指定进程id，会列出所有java进程：\n只要选择前面的序号就可以选择对应的java进程，如果觉得每次重启java进程之后pid都会发生变化可以使用select指定进程名：\n1 java -jar arthas-boot.jar --select com.example.Main 启动之后可以使用指定的target-ip+target-port在浏览器中访问。\nb.基本命令 命令 说明 命令 说明 dashboard 实时系统数据面板，可以看到线程、内存信息 getstatic 查看类的静态属性，可以背ognl替代 heapdump 导出内存快照 jvm 查看jvm信息 logger 查看 logger 信息，更新 logger level mbean 查看mbean信息 memory 查看内存信息 ognl 执行ognl表达式(之前的groovy可能内存泄漏) perfcounter 查看当前JVM的Performance Counter(性能技术器)信息 sysenv 查看系统变量 sysprop 查看系统属性 thread 查看线程堆栈信息 vmoption 查看或更新vm诊断参数 vmtool 利用jvmti接口查询内存对象或者强制GC classloader 查看或使用类加载器 dump 把加载完的字节码文件dump到指定目录 jad 反编译已加载的类的源码 mc 编译java文件成class文件 readfine 动态修改已经加载的类(不能修改类的结构和正在运行的函数) retransform 和readfine功能相同，更灵活 sc 打印已加载的类信息 sm 打印已加载类的方法信息 monitor 方法执行监控 stack 查看方法的被调用堆栈信息 trace 输出方法内部节点路径上的节点耗时 tt 打印方法的入参、出参和耗时 watch 和tt类似，更灵活，但是使用更复杂 profiler 针对cpu、对向分配、锁等信息生成火焰图 jfr 使用jfr诊断工具 auth 开启或关闭会话验证 options 全局设置 base64 进行base64编解码 cat 打印文件内容 cls 清空屏幕 echo 打印命令或者文本 grep help history keymap 输出命令的快捷键映射表 pwd quit 退出客户端 reset 重制被arthas增强的类 session 显示会话信息 stop 关闭arthas服务端 tee version c. 利用Arthas进行性能分析 分析消耗CPU的代码\n首先开启profiler：\n1 2 # 默认采样cpu，支持采样cpu, alloc(对象分配), lock(锁竞争), cache-misses(cpu缓存未命中信息) profiler start -e cpu 然后执行方法：\n1 2 3 4 5 6 7 8 9 10 public void hCPU() { for (int i = 0; i \u003c 100; i++) { fib(i); } } private int fib(int n) { if (n \u003c= 1) return n; return fib(n-1) + fib(n-2); } 方法执行完后停止profiler：\n1 2 # 如果是生成html的文件可以直接在浏览器中访问，默认是html格式 profiler stop --format html 生成完火焰图可以直接打开或者访问http://127.0.0.1:8563/arthas-output/查看生成的火焰图，找到了占用CPU最高的方法fib()，之后就可以使用trace命令查看方法的内部调用路径，查看方法内部节点耗时：\n1 trace com.example.DemoService fib 排查内存泄漏问题\n排查内存溢出\n进行代码热替换\nIV. Arthas工作原理 A. 类加载和字节码增强\nJava类加载的基本原理 ","wordCount":"229","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/9.arthas/"},"publisher":{"@type":"Organization","name":"王小红的笔记","logo":{"@type":"ImageObject","url":"https://wangxiaohong123.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangxiaohong123.github.io/ accesskey=h title="王小红的笔记 (Alt + H)">王小红的笔记</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wangxiaohong123.github.io/posts/ title=笔记><span>笔记</span></a></li><li><a href=https://wangxiaohong123.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://wangxiaohong123.github.io/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">jvm-9.arthas</h1><div class=post-meta>2 min</div></header><div class=post-content><h5 id=1定位>1.定位<a hidden class=anchor aria-hidden=true href=#1定位>#</a></h5><p>他的定位是监控、排查故障以及性能优化。</p><h5 id=2用法>2.用法<a hidden class=anchor aria-hidden=true href=#2用法>#</a></h5><h6 id=a启动>a.启动<a hidden class=anchor aria-hidden=true href=#a启动>#</a></h6><p>启动方式有两种，第一种下载jar包[https://arthas.aliyun.com/arthas-boot.jar]，下载完直接使用jar包的方式启动：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#6272a4># telnet-port 指定arthas监听的telnet端口，用来和arthas shell通信</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># -1表示不监听，0表示随机</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 相关配置在arthas.properties里</span>
</span></span><span style=display:flex><span>java -jar arthas-boot.jar --telnet-port <span style=color:#bd93f9>4659</span> &lt;pid&gt;
</span></span></code></pre></td></tr></table></div></div><p>启动之后可以看到监听端口</p><p><img alt=arthas启动成功 loading=lazy src=https://raw.githubusercontent.com/wangxiaohong123/p-bed/main/uPic/arthas%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F.png></p><p>第二种下载arthas远程客户端(启动远程客户端需要先安装telnet)</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -L https://arthas.aliyun.com/install.sh | sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 启动并指定监听进程的ip和端口，这里设置的是Web Console页面的ip和端口</span>
</span></span><span style=display:flex><span>./as.sh --target-ip 127.0.0.1 --target-port <span style=color:#bd93f9>8888</span> &lt;pid&gt;
</span></span></code></pre></td></tr></table></div></div><p>不管哪种方式启动，如果启动时没有指定进程id，会列出所有java进程：</p><p><img alt=Xnip2023-07-27_08-54-03 loading=lazy src=https://raw.githubusercontent.com/wangxiaohong123/p-bed/main/uPic/Xnip2023-07-27_08-54-03.png></p><p>只要选择前面的序号就可以选择对应的java进程，如果觉得每次重启java进程之后pid都会发生变化可以使用select指定进程名：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar arthas-boot.jar --select com.example.Main
</span></span></code></pre></td></tr></table></div></div><p>启动之后可以使用指定的target-ip+target-port在浏览器中访问。</p><h6 id=b基本命令>b.基本命令<a hidden class=anchor aria-hidden=true href=#b基本命令>#</a></h6><table><thead><tr><th>命令</th><th>说明</th><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>dashboard</td><td>实时系统数据面板，可以看到线程、内存信息</td><td>getstatic</td><td>查看类的静态属性，可以背ognl替代</td></tr><tr><td>heapdump</td><td>导出内存快照</td><td>jvm</td><td>查看jvm信息</td></tr><tr><td>logger</td><td>查看 logger 信息，更新 logger level</td><td>mbean</td><td>查看mbean信息</td></tr><tr><td>memory</td><td>查看内存信息</td><td>ognl</td><td>执行ognl表达式(之前的groovy可能内存泄漏)</td></tr><tr><td>perfcounter</td><td>查看当前JVM的Performance Counter(性能技术器)信息</td><td>sysenv</td><td>查看系统变量</td></tr><tr><td>sysprop</td><td>查看系统属性</td><td>thread</td><td>查看线程堆栈信息</td></tr><tr><td>vmoption</td><td>查看或更新vm诊断参数</td><td>vmtool</td><td>利用jvmti接口查询内存对象或者强制GC</td></tr><tr><td>classloader</td><td>查看或使用类加载器</td><td>dump</td><td>把加载完的字节码文件dump到指定目录</td></tr><tr><td>jad</td><td>反编译已加载的类的源码</td><td>mc</td><td>编译java文件成class文件</td></tr><tr><td>readfine</td><td>动态修改已经加载的类(不能修改类的结构和正在运行的函数)</td><td>retransform</td><td>和readfine功能相同，更灵活</td></tr><tr><td>sc</td><td>打印已加载的类信息</td><td>sm</td><td>打印已加载类的方法信息</td></tr><tr><td>monitor</td><td>方法执行监控</td><td>stack</td><td>查看方法的被调用堆栈信息</td></tr><tr><td>trace</td><td>输出方法内部节点路径上的节点耗时</td><td>tt</td><td>打印方法的入参、出参和耗时</td></tr><tr><td>watch</td><td>和tt类似，更灵活，但是使用更复杂</td><td>profiler</td><td>针对cpu、对向分配、锁等信息生成火焰图</td></tr><tr><td>jfr</td><td>使用jfr诊断工具</td><td>auth</td><td>开启或关闭会话验证</td></tr><tr><td>options</td><td>全局设置</td><td>base64</td><td>进行base64编解码</td></tr><tr><td>cat</td><td>打印文件内容</td><td>cls</td><td>清空屏幕</td></tr><tr><td>echo</td><td>打印命令或者文本</td><td>grep</td><td></td></tr><tr><td>help</td><td></td><td>history</td><td></td></tr><tr><td>keymap</td><td>输出命令的快捷键映射表</td><td>pwd</td><td></td></tr><tr><td>quit</td><td>退出客户端</td><td>reset</td><td>重制被arthas增强的类</td></tr><tr><td>session</td><td>显示会话信息</td><td>stop</td><td>关闭arthas服务端</td></tr><tr><td>tee</td><td></td><td>version</td><td></td></tr></tbody></table><h6 id=c-利用arthas进行性能分析>c. 利用Arthas进行性能分析<a hidden class=anchor aria-hidden=true href=#c-利用arthas进行性能分析>#</a></h6><ul><li><p>分析消耗CPU的代码</p><p>首先开启profiler：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#6272a4># 默认采样cpu，支持采样cpu, alloc(对象分配), lock(锁竞争), cache-misses(cpu缓存未命中信息)</span>
</span></span><span style=display:flex><span>profiler start -e cpu
</span></span></code></pre></td></tr></table></div></div><p>然后执行方法：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>hCPU</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> 0; i <span style=color:#ff79c6>&lt;</span> 100; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>        fib(i);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>fib</span>(<span style=color:#8be9fd>int</span> n) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (n <span style=color:#ff79c6>&lt;=</span> 1) <span style=color:#ff79c6>return</span> n;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> fib(n<span style=color:#ff79c6>-</span>1) <span style=color:#ff79c6>+</span> fib(n<span style=color:#ff79c6>-</span>2);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>方法执行完后停止profiler：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#6272a4># 如果是生成html的文件可以直接在浏览器中访问，默认是html格式</span>
</span></span><span style=display:flex><span>profiler stop --format html
</span></span></code></pre></td></tr></table></div></div><p>生成完火焰图可以直接打开或者访问http://127.0.0.1:8563/arthas-output/查看生成的火焰图，找到了占用CPU最高的方法fib()，之后就可以使用trace命令查看方法的内部调用路径，查看方法内部节点耗时：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>trace com.example.DemoService fib
</span></span></code></pre></td></tr></table></div></div></li><li><p>排查内存泄漏问题</p></li><li><p>排查内存溢出</p></li><li><p>进行代码热替换</p></li></ul><h3 id=iv-arthas工作原理>IV. Arthas工作原理<a hidden class=anchor aria-hidden=true href=#iv-arthas工作原理>#</a></h3><p>A. 类加载和字节码增强</p><ol><li>Java类加载的基本原理</li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangxiaohong123.github.io/tags/jvm/>JVM</a></li></ul><nav class=paginav><a class=prev href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/8.%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E5%99%A8/><span class=title>« Prev</span><br><span>jvm-8.即时编译器</span>
</a><a class=next href=https://wangxiaohong123.github.io/posts/%E5%9F%BA%E7%A1%80/jvm/1.java%E5%8E%86%E5%8F%B2/><span class=title>Next »</span><br><span>jvm-java历史</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-9.arthas on x" href="https://x.com/intent/tweet/?text=jvm-9.arthas&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f9.arthas%2f&amp;hashtags=JVM"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-9.arthas on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f9.arthas%2f&amp;title=jvm-9.arthas&amp;summary=jvm-9.arthas&amp;source=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f9.arthas%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-9.arthas on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f9.arthas%2f&title=jvm-9.arthas"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-9.arthas on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f9.arthas%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-9.arthas on whatsapp" href="https://api.whatsapp.com/send?text=jvm-9.arthas%20-%20https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f9.arthas%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-9.arthas on telegram" href="https://telegram.me/share/url?text=jvm-9.arthas&amp;url=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f9.arthas%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share jvm-9.arthas on ycombinator" href="https://news.ycombinator.com/submitlink?t=jvm-9.arthas&u=https%3a%2f%2fwangxiaohong123.github.io%2fposts%2f%25E5%259F%25BA%25E7%25A1%2580%2fjvm%2f9.arthas%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wangxiaohong123.github.io/>王小红的笔记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>