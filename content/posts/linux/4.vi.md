---
title: linux-4.vi
tags:
  - linux
categories: 基础
copyright: true
---

比vi好用的编辑器有很多，比如nano，但是不是所有发行版都内置除vi意外的编辑器。最重要的是很多软件的编辑接口都会主动调用vi，比如crontab、visudo，所以vi是最重要的。vim是vi的升级版，他会根据文件的扩展名和文件内的开头信息显示对应的语法样式，其实感觉就是多个颜色、下划线等样式，缩进啥的还是很痛苦。

大部分的发行版都用vim替换vi了，如果输入**alias**时出现**alias vi='vim'**表示执行vi就是在执行vim，否则还是要手动执行vim。

vi分为3中模式：

*   一般命令模式：vi 文件名 就进入一般命令模式了，简称一般模式，在这个模式里可以使用上下左右移动光标，删除字符或者删除整行，也可以使用复制粘贴；
*   编辑模式：一般模式不能编辑，直到按下【i、l、o、O、a、A、r、R】任意一个字母才会进入编辑模式，一般编辑模式屏幕左下方会出现insert、replace等字样，按【esc】退出编辑模式；
*   命令模式：在一般模式下输入【:、/、?】任意一个进入命令模式，在这个模式里可以查找数据、保存、批量替换、退出vi、显示行号等操作；

##### 一般命令模式的按键：

| 移动光标方法         | 可以使用数字加命令，比如30↓就是向下移动30个字符              |
| -------------------- | ------------------------------------------------------------ |
| h或者←               | 光标向左移动一个字符                                         |
| j或者↓               | 光标向下移动一个字符                                         |
| k或者↑               | 光标向上移动一个字符                                         |
| l或者→               | 光标向右移动一个字符                                         |
| ctrl+f               | 屏幕向下翻页                                                 |
| ctrl+b               | 屏幕向上翻页                                                 |
| ctrl+d               | 屏幕向下翻半页                                               |
| ctrl+u               | 屏幕向上翻半页                                               |
| +                    | 光标移动到非空格的下一行                                     |
| -                    | 光标移动到非空格的上一行                                     |
| N + 空格             | n是数字，光标向右移动n个字符                                 |
| 0或者home键          | 移动到这一行的第一个字符位置，这个是数字0                    |
| $或者end键           | 移动到这一行的最后一个字符位置                               |
| H                    | 移动到屏幕最上方第一行第一个字符                             |
| M                    | 移动到屏幕中央那行的第一个字符                               |
| L                    | 移动到屏幕最下方最后一行的第一个字符                         |
| G                    | 移动到文件的最后一行                                         |
| nG                   | n是数字，移动到文件的第n行                                   |
| gg                   | 移动到文件的第一行，相当于1G                                 |
| n + 回车             | n是数字，光标向下移动n行                                     |
| **查找和替换**       |                                                              |
| /word                | 向光标之下查找第一个名为word的字符串                         |
| ?word                | 向光标之上查找第一个名为word的字符串                         |
| n                    | n是按键，代表重复前一个查找的操作，比如/word之后在按n就是继续查找 |
| N                    | N是按键，和n相反，反向前一个查找的操作，/word会变成?word     |
| :n1,n2/word1/word2/g | n1和n2是数字，在第n1和n2行之间查找word1，并把word1替换成word2 |
| :1,$s/word1/word2/g  | 从第1行到最后一行之间查找word1，并把word1替换成word2         |
| :1,$s/word1/word2/gc | 从第1行到最后一行之间查找word1，并把word1替换成word2，且在替换前给用户显示确认提示字符 |
| **删除，复制和粘贴** |                                                              |
| x、X                 | x表示向后删除一个字符，X表示向前删除一个字符                 |
| nx                   | n是数字，向后删除n个字符                                     |
| dd                   | 删除光标所在一整行                                           |
| ndd                  | n是数字，向下删除光标所在的下n行                             |
| d1G                  | 删除光标到第一行的所有数据                                   |
| dG                   | 删除光标到最后一行的所有数据                                 |
| d$                   | 删除光标所在位置到这行最后一个字符                           |
| d0                   | 删除光标所在位置到这行第一个字符                             |
| yy                   | 复制光标所在行                                               |
| nyy                  | n是数字，复制光标所在行的下n行                               |
| y1G                  | 复制光标所在行到第一行的所有数据                             |
| yG                   | 复制光标所在行到最后一行的所有数据                           |
| y0                   | 复制光标所在字符到行首的所有数据                             |
| y$                   | 复制光标所在字符到行尾的所有数据                             |
| p、P                 | p是把复制的数据在光标下一行粘贴，P是在上一行粘贴             |
| J                    | 把光标所在行和下一行合成同一行                               |
| c                    | 删除重复多个数据                                             |
| u                    | 恢复前一个操作                                               |
| ctrl + r             | 重做上一个操作                                               |

##### 一般命令模式切换到编辑模式的按键：

| i和I | 插入，i是从光标处开始插入，I是从光标所在行的第一个非空格开始插入 |
| ---- | ------------------------------------------------------------ |
| a和A | 插入，a是从光标所在的下一个字符开始插入，A是光标所在行的最后一个字符开始插入 |
| o和O | o是在光标所在行的下一行插入一个新空行，O是在上一行插入一个空行 |
| r和R | r会替换光标所在的字符，R会一直替换光标所在的字符，直到按下esc键 |
| esc  | 退出编辑模式                                                 |

##### 一般命令模式切换到命令模式的按键

| :w                  | 将编辑的数据写入到硬盘                                       |
| ------------------- | ------------------------------------------------------------ |
| :w!                 | 如果文件的权限是只读，强制写入，能不能强制跟你对该文件的权限有关 |
| :q                  | 退出                                                         |
| :q!                 | 强制退出，不保存                                             |
| :wq                 | 保存后退出，如果是:wq!就是强制保存退出                       |
| ZZ                  | 和:wq的效果一样                                              |
| :w [filename]       | 另存为                                                       |
| :r [filename]       | 把文件内容加载到光标所在行后面                               |
| :n1,n2 w [filename] | 把n1到n2的内容另存为新文件                                   |
| :! command          | 暂时退出vi到命令模式下执行command的显示结果<br />例如【:! ls /home】就是在vi中查看/home下面以ls输出文件信息 |
| :set nu(针对vim)    | 显示行号                                                     |
| :set nonu(针对vim)  | 取消行号                                                     |

##### vim的缓存

vim防止某些原因导致的程序异常退出的情况会在编辑文件时创建一个.filename.swp的文件，这个文件里缓存了对filename的操作，如果打开文件之前出现了.swp文件就会报错，说什么found a swap file之类的，出现这个错误可能有两种情况：第一个就是多人维护同一个文件，第二个就是异常退出了。

如果是多个人维护同一个文件就要协商是另一个人先退出来还是你在等等，如果是异常退出此时你有6个选择：

*   输入o：以只读的方式打开文件，什么都不能做；
*   输入e：继续打开文件，但是还可能出现问题；
*   输入r：加载缓存内容，编辑完之后还是要手动删除缓存文件；
*   输入d：删除缓存文件；
*   输入q：不进行任何操作退出；
*   输入a：忽略操作，感觉和q一样的效果；

##### vim的额外功能

vim的编辑界面会多出两个标识，一个是光标所在行和所在行的多少字符，另一个是界面占整体文件的百分比。

可视区块：

| v        | 字符选择，将光标经过的地方反白选择 |
| -------- | ---------------------------------- |
| V        | 行选择，将光标经过的行反白选择     |
| ctrl + v | 可视区块，用矩形的方式选择数据     |
| y        | 复制反白的地方                     |
| d        | 删除反白的地方                     |
| p        | 将刚刚复制的区块在光标处粘贴       |

多文件编辑：

| :n     | 编辑下一个文件            |
| ------ | ------------------------- |
| :N     | 编辑上一个文件            |
| :files | 列出这个vim开启的所有文件 |

多窗口功能：

当一个文件非常大想要同时看到前面和后面的数据或者想对比两个文件时多窗口非常好用：

| :sp [filename]                 | 如果没有filename就表示两个窗口打开的同一个文件         |
| ------------------------------ | ------------------------------------------------------ |
| ctrl + w + j<br />ctrl + w + ↓ | 按住ctrl + w后松开，在按j或者↓，光标可以移动到下个窗口 |
| ctrl + w + k<br />ctrl + w + ↑ | 用法同上，光标移动到上个窗口                           |
| ctrl + w + q                   | 关闭下方的窗口，就是【ctrl + w + ↓】和:q的组合         |

环境设置和记录：

vim会自动把我们的操作记录在~/.viminfo中，实现的效果就是我们在编辑文件之后在打开，光标会停留在上次编辑的位置，或者我们在执行其他操作比如查找反白之后，下次在打开，上次反白的地方还在。

环境设置分为针对文件设置和默认设置，在一般命令模式下，执行**:set all**可以看到这个文件的设置，也可以执行**:set 参数**来设置，比如:set nu就是显示行号，也可以在/etc/vimrc中设置默认值，但是最好在~/.vimrc中设置，这个是针对用户的，默认不存，他可以针对用户自动覆盖/etc/vimrc文件中的设置，常用的设置项【注意，文件里使用双引号注释】：

```bash
set nu					" 设置行号
set nonu				" 取消行号
set hlsearch			" 高亮查找，就是查找的结果反白
set nohlsearch			" 取消高亮查找
set autoindent			" 自动缩进
set noaudoindent		" 不自动缩进
set backup				" 自动备份，如果开启，在编辑文件时会多出来一个filename~的文件
set ruler				" 是否显示最后一行右侧的状态，就是行号、百分比什么的
set showmode			" 是否显示最后一行左侧的状态，就是--INSERT--之类的
set backspace=(0/1/2)	" 2表示可以用backspace键删除任意字符，0或者1表示只能删除刚刚输入的字符
syntax on				" 进行语法检查
syntax off				" 不进行语法检查
set bg=dark				" dark主题
set bg=light			" light主题
```

编码问题：

windows的dos和linux的一些字符定义不同，比如linux的换行符是LF(\$)，dos的换行符是CRLF(^M\$)，可以用dos2unix和unix2dos命令转换。

转换编码的话可以用iconv命令。
