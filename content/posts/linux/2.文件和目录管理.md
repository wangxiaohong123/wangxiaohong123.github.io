---
title: linux-2.文件和目录管理
tags:
  - linux
categories: 基础
copyright: true
---

### 用户和用户组

Linux是多人多任务系统，可能同时有多人使用服务器，考虑每个人的隐私权限和每个人喜好的工作环境，这样每个用户都可以把自己的文件权限设置成自己可见，就保证了隐私。用户组主要是为了团队协同工作，这样既能保证每个人的隐私，又能实现多人共同维护服务。

用户组就相当于一个家庭，谁都可以在客厅玩、吃饭、看书，用户相当于每个人自己的卧室，需要得到本人的允许才能进入，others就是陌生人，连进到客厅都需要得要允许。

root用户就是天神，所有文件对于他来说都没有权限。

所有的账号信息都在**/etc/passwd**文件里，个人的密码在**/etc/shadow**文件里，所有的组名在**/etc/group**文件里。

### 文件权限

执行**ls -al**查看文件权限，他的缩写是**ll**，执行之后可以得到类似下面的内容：

```shell
-rw-r--r--   1    root root   1879158   4月28 17:17 test.sql
#   权限	   连接  用户  用户组  文件大小     修改日期     文件名
```

ls是list的意思。链接就是有多少文件名链接到了这个节点(inode)。文件大小的默认单位是byte。如果文件名前面多个[.]表示隐藏文件。

ls的更多更多用法使用**ls --help**或者**man ls**或者**info ls**查看。

##### 文件类型

*   常规文件：[-]表示常规文件，按照文件内容可以分成3类：
    1.   纯文本文件，纯文本文件的内容我们可以直接看到，比如数字、字母。
    2.   二进制文件，linux中可以执行的文件就是二进制文件，不包括脚本，比如他一些命令，就是一个为进制文件。
    3.   数据文件，有些程序在运行的时候会读取某些特定格式的文件，比如在用户登录的时候会记录登录数据在/var/log/wtpm里，如果使用cat查看就是乱码，可以使用last命令查看。
*   目录：就是文件夹。
*   链接文件：类似windows的快捷方式，
*   设备和设备文件：和系统周边及存储相关的文件，一般都在/dev下，通常可以分成两类：
    1.   区块设备，提供系统随机读写的接口设备，比如硬盘。
    2.   字符设备，一些串行端口的接口设备，鼠标键盘这种，这些设备的特点就是一次性读取，不能断，比如说可以让鼠标移动到一个位置，但是不能让鼠标跳到一个位置。
*   数据接口文件：一般是网络上的数据交换，在/run或者/tmp目录里。
*   数据输送文件(FIFO,pipe)：他是为了解决多个程序同时写一个文件的问题，FIFO全称是first-in-first-out，就是管道。

可以使用man fifo和man socket查看数据输送文件和数据接口文件的说明。

##### 权限说明

权限栏一共有10个字符，第一个字符表示这个文件是目录、文件还是链接，如果是[d]就表示目录，如果是[-]就表示文件；如果是[l]就表示链接文件；如果是[b]就表示可以存储的周边设备；如果是[c]就表示串行端口设备；[s]表示数据接口文件；[p]表示数据传送文件。

后面的9个字符每3个一组，均为[rwx]的组合，位置不会变，如果没有权限就是[-]。

###### 文件权限

*   [r]代表可读，就是读取文件的文字内容。
*   [w]代表可编辑，新增、修改、删除内容，但是不能删除文件。
*   [x]代表可执行，跟扩展名无关，只要有x属性就可以执行。

第一组是文件拥有者的权限，第二组是所属用户组的其他账号的权限，第三组是没有加入用户组的其他账号的权限。

###### 目录权限

*   [r]代表查看目录里的文件。
*   [w]代表可以创建新的目录和文件、删除文件或者目录、移动目录里的文件或者目录。
*   [x]代表可执行，跟扩展名无关，只要有x属性就可以执行。

##### 修改文件属性和权限

**chgrp [-R] groupName dirname/filename**修改文件所属用户组，-R表示递归修改，把子目录下的所有文件、目录都改成这个用户组，同时group name需要在/etc/group文件中存在。

**chown [-R] 账号[:group name] dirname/filename**修改文件所属用户，-R表示递归修改，这个命令如果账号后面还有:组名，会把所属用户组一起修改，冒号换成点也可以。

一般在复制文件给其他用户的时候会用到这两个命令，因为复制文件会一起复制属性和权限。

**chmod [-R] 文件权限 文件名**修改文件权限，他有两种方式，第一种是数字形式，第二种是符号形式：

*   数字形式：r、w、x分别对应4、2、1，比如6就是rw，**chmod 770 test.sql**就是把test.sql的权限设置成[-rwxrwx---]。
*   符号形式：u、g、o分别代表users、group、others三种身份的权限，每种身份对应的权限设置有+、-、=，比如test.sql的权限设置成[-rwxrwxr--]：**chmod ug=rwx,o=r test.sql**，把test.sql的group的x权限去掉：**chmod g-x test.sql**。

### 目录配置

所有发行版的目录都是差不多的额，因为他们都一句FHS(Filesystem Hierarchy Standard)标准，FHS建议根目录(/)越小越好，且不要再根目录安装东西，可以挂载一个其他分区，因为根目录和系统启动、还原、修复操作相关，根目录单独一个分区系统不容易发生问题，性能也好。

FHS要求根目录应该有以下子目录，即使没有物理目录也应该有链接目录：

|  目录  |                           放置内容                           |
| :----: | :----------------------------------------------------------: |
|  /bin  | 在单人维护模式下还能使用的命令，/bin下的命令可以被root和一般账号使用，比如cat、chmod、mv等 |
| /boot  | 存放启动会用到的启动选项文件和启动配置文件，linux内核常用的文件名是vmlinuz |
|  /dev  |                         存放设备文件                         |
|  /etc  | 所有的配置文件，比如账号密码、服务启动文件，一般这个目录下的文件所有用户都可以查看，但是只有root能够修改，另外这个目录不建议放可执行文件 |
|  /lib  | 存放启动时会用到的函数库，以及/bin和/sbin下面命令会用到的函数库 |
| /media |                  存放可删除的设备，比如光盘                  |
|  /mnt  |        挂载的额外的设备，没有/media的时候他就是/media        |
|  /opt  | 给三方软件的目录，我们自己安装的也可以放到这里，但是我习惯放到/usr/local下 |
|  /run  | 系统启动后产生的各项信息，之前是/var/run，改成/run之后性能会更好，因为/run是内存不是磁盘 |
| /sbin  | 系统启动、修复、还原需要的命令，只有root才能使用，/usr/sbin是服务器自带软件的命令，我们安装的软件产生的命令文件一般在/usr/local/sbin下 |
|  /srv  |      一些网络服务启动之后所需要用到的数据目录，比如html      |
|  /tmp  | 临时目录，这个目录所有人都有权限读取，FHS建议启动时把该目录下的文件都删掉 |
|  /usr  | 他是UNIX Software Resource的缩写，里面放的是系统所有的自带软件，CentOS已经把/bin、/sbin和/lib都移到了/usr下，外面只是个链接目录 |
|  /var  | 针对经常变动的文件，比如日志、缓存和一些软件运行产生的文件，比如MySQL的数据。/var/lib放的是软件的数据文件。/vsr/lock是设备锁，一些设备或者文件只能被一个文件使用，需要锁来控制，现在链接到了/run/lock。/var/log是最重要的日志，比如/var/log/messages。/var/run是存放进程的PID，也被链接到了/run下。/var/spool存放一些队列数据，比如crontab计划会被写到/var/spool/cron里，执行完就被删除。 |

可以看到命令都是在某些目录的bin或者sbin下，他们都是通过环境变量(PATH)的配置实现在任何目录下都可以执行这些命令，在执行命令的时候系统会先根据PATH遍历目录下的文件，找到第一个和命令同名的文件去执行，可以使用**echo $PATH**打印被PATH定义的目录。

### 文件目录管理

##### 1)目录管理常用命令

###### 1.cd

.表示当前目录，..表示上一层目录，-表示上一个工作目录，\~表示当前账号的家目录，\~account表示account这个账号的家目录。

cd是change directory的缩写，每个账号刚登录默认都是在这个账号的家目录，root的家目录是/root，其他账号的家目录是/home/账号，如果cd后面不跟路径的话就是进入当前账号的家目录。上面的符号比如点或者横线可以直接放在cd后面，比如：

```shell
cd /data/stars/web
cd /root
# 从/root回到/data/stars/web目录中
cd -
```

###### 2.pwd

pwd是print working directory的缩写，显示当前所在目录，pwd -P表示如果是链接目录就显示真正的目录路径。

###### 3.mkdir

创建目录，**mkdir [-mp]**，-m表示设置目录的权限，-p表示递归创建不存在的目录，比如**mkdir -m 711 -p test2**。

###### 4.rmdir

删除空目录，他也有个-p参数，连同上一层的空目录一起删除。

##### 2)文件管理常用命令

###### 1.文件列表

ls应该是最常用的命令，如果不加参数就只会显示文件、目录名，不包括隐藏的文件，目录，文件和压缩包等用不同颜色区分。他有非常多的参数可以选择：

*   -a：显示隐藏的文件；
*   -A：显示隐藏的文件，不包括.和..；
*   -d：只显示目录；
*   -f：不按照文件名排序；
*   -F：在文件名后面追加文件信息，比如*代表可执行文件，/代表目录，=代表socket文件，|代表FIFO文件；
*   -h：带单位显示文件大小；
*   -i：列出incode码；
*   -l：显示详细信息，包括属性和权限，ls -l的缩写是ll；
*   -r：倒叙输出；
*   -R：递归显示子目录内容；
*   -S：按文件大小排序；
*   -t：按时间排序；
*   --color=never：不加颜色高亮，never可以换成always或者auto；
*   --full-time：输出完整日期
*   --time={atime,ctime}：输出access时间(读取时间)或者修改权限属性时间，而不是内容修改时间；

###### 2.复制

cp就是copy的缩写，cp除了可以复制文件还可以创建链接文件(快捷方式)、对比两个文件的新旧然后在更新、复制整个目录等等：

*   -a：相当于-dr，--preserve=all的意思；
*   -d：如果源文件是链接文件，就复制链接文件的属性，而不是链接文件的指向文件；
*   -f：强制的意思，如果目标文件已经存在并且无法打开就删除在复制；
*   -i：如果目标文件已经存在，先询问是否覆盖；
*   -l：进行硬链接，而不是复制文件本身；
*   -p：把文件属性一起复制过去，没有这个参数会使用默认属性，备份的时候常用；
*   -r：递归复制；
*   -s：复制成快捷方式；
*   -u：目标文件不存在或者比源文件更旧才复制；

###### 3.移动

mv是move的缩写，他除了移动还可以重命名：

*   -f：强制移动，直接覆盖；
*   -i：如果文件已存在，询问是否覆盖；
*   -u：如果目标文件已存在，并且源文件比较新才会覆盖；

###### 4.删除

rm是remove的缩写，很多发行版会在这个命令里默认加上-i选项，防止误删：

*   -f：强制删除，忽略不存在的文件，不会出现警告信息；
*   -i：删除前询问是否删除；
*   -r：递归删除；

###### 5.basename和dirname

**basename /root/server/network**获取文件名，得到的结果是network。

**dirname  /root/server/network**获取目录名，得到的结果是 /root/server。

###### 6.查看文件内容

查看文件内容的命令有很多：

*   cat [-AbEnTv]：从第一行开始显示，-A相当于-vET的组合，-b是列出行号，-E是显示换行符，-n比-b多一个空白行的行号，-T把tab键以^I符号显示出来，-v显示特除字符。
*   tac：tac是cat倒着写，功能也是和cat相反，从最后一行开始显示。
*   nl [-bnw]：显示内容的时候同时输出行号，他的重点是在行号的显示，3个参数都是跟行号相关的。
*   more：如果文件行数超过了屏幕就会分页显示，输入空格表示向下翻页，回车下翻一行，/字符串是在显示出来的内容里向下查找，查找的时候按n就是继续查找，:f是显示文件名和当前显示的行数，q是退出，b向前翻页。
*   less：less比more的功能更多，比如可以直接按pagedown键就是向下翻页，pageup就是向上翻页，?字符串是向前查找字符串，N是反向重复前一个查找，g跳到第一行，G跳到最后一行，好像比more少了个回车。
*   head [-n number]：输出文件的前几行，number是具体的数字，如果number是负数就表示输出前面所有行数，但是不包括最后100行。
*   tail [-n number -f]：-n的用法和head是一样的，-f表示文件有写入数据就马上输出到屏幕。
*   od [-t type]：od是用来查看非文本文件的，比如执行文件或者命令文件，type如果是a表示默认的字符，如果是c就是输出ASCII码，d、o、x分别对应10进制、8进制、16进制。比如**od -t oCc /etc/issue**意思是以8进制列出文件内容和ASCII的对照表。

###### 7.修改文件时间或创建新文件

每个文件在linux下面都会记录3个时间参数，mtime(修改时间)，只有文件的内容改变的时候才会修改这个时间、ctime(状态时间)，权限和属性被修改的时候会更新这个时间、atime(读取时间)，当文件的内容被读取的时候会去修改这个时间。查看文件时间：

```shell
# atime可以换成ctime或者mtime
# ls默认显示mtime
ll --time=atime
```

修改文件时间或者创建文件的命令是touch，他有几个可选参数：

*   -a：自定义atime；
*   -c：只修改时间，如果文件不存在不会创建空文件；
*   -d：具体日期，如果没有这个参数会使用当前日期；
*   -m：修改mtime；
*   -t：具体时间，格式[YYYYMMDDhhmm]；

没有参数就是单纯的创建空文件，最有意思的是-d参数，他可以这么写：

```shell
# atime和ctime都改成2天前
touch -d "2 days ago" test.sql
```

##### 3)文件查找

###### 1.脚本查找

使用which查找命令的完整文件路径，默认找到第一个，如果是which -a就是列出PATH中所有这个名字的命令的位置，但是which不能查找bash内置命令的位置(如果要查看bash内置命令位置要使用type)，比如：

```bash
# 找到ifconfig命令的位置
which ifconfig
# 因为history是bash内置命令，这个命令会报no history in ……
which history
```

###### 2.文件查找

whereis、locate、find都可以查找文件，但是whereis只在系统特定目录下查找，locate利用数据库查找文件名，find会去硬盘中查找，一般来说都是先用whereis，没找到在用locate，最后在用find。

---

whereis [-bmsu] 文件名或者目录名，如果没有参数就是把所有的文件显示出来：

*   -b：只查找2进制格式的文件；
*   -m：只找说明文件manual路径下的文件；
*   -s：只找source源文件；
*   -u：查找不在上面-bms中的其他特殊文件；

另外**whereis -l**是列出whereis搜索的目录。

---

locate [-iclSr] 文件名：

*   -i：忽略大小写；
*   -c：不输出文件名，只显示数量；
*   -l：只输出几行，不全部显示；
*   -S：输出locate使用的数据库信息；
*   -r：后面接正则的显示方式；

locate可能会找不到文件，因为他用到的数据是存到/var/lib/mlocate里，这个文件每天更新一次，可以执行updatedb，他会按照硬盘里的文件刷新数据，但是要花几分钟。

---

find [PATH] [option] [action]，这个命令比较强大

跟时间相关的参数：

```bash
# -atime或者-mtime或者-ctime，下面以-mtime举例
# -mtime n 表示第n天前修改过的文件
# -mtime +n 表示n天前修改过的文件
# -mtime -n 表示n天内修改过的文件
# 0就代表当前时间，意思就是24小时内被修改过的文件
find / -mtime 0

# +0就表示修改过的文件都显示
find / -mtime +0

# 找出/etc下面比/etc/passwd更新的文件
find /etc -newer /etc/passwd
```

跟用户或者用户组相关的参数：

```bash
# n是用户id，可以在/etc/passwd中查找
-uid n
# n是groupId，可以在/etc/group中查找
-gid n
# name是用户名
-user name
# name是group名
-group name
# 查找的文件的拥有者不在/etc/passwd中
-nouser
# 查找文件的属组不在/etc/group中
-nogroup

# 查找根目录下root用户的文件
find / -user root
```

跟文件名称和权限有关的参数：

```bash
# 根据文件名查找
-name filename
# 找出比SIZE大或者小的文件，SIZE的规格有c：代表bytes，k代表1024bytes，比如找大于50kb的文件就是+50k
-size [+-]SIZE
# 查找类型是TYPE的文件，TYPE可选：d、l、b、s、p
-type TYPE
# 查找权限刚好等于mode的文件，如果有-号就是权限大于mode的，/表示包含任意一个权限就列出
-perm [-/]mode
```

其他命令：

-exec command：command是其他命令，可以处理查找到的结果，例如：

```bash
# 644就是rw-r--r--，只要包含r或者w的就列出
# exec后面跟的命令不支持别名，所以只能写ls -l
# {}代表find的内容。因为;在bash中有特殊意义，所以这里用\来转义
find /usr/bin /usr/sbin -perm /644 -exec ls -l {} \;
```

