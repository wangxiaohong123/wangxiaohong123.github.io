---
title: docker组件
tags:
  - docker
categories: 基础
copyright: true
---

##### 安全性

相对于虚拟机来说，虚拟机使用虚拟机管理系统(Hypervisor)模拟硬件，在模拟硬件上创建操作系统，容器采用namespace实现文件系统、进程、设备、网络隔离，使用CGroups对CPU、内存隔离，虚拟机有更好的隔离性和安全性。容器的优点是性能损耗非常小。

容器存在的问题：

*   很多资源没有被完全隔离，比如/sys，/proc。
*   所有容器共享主机内核，也就是说一个容器的内核崩溃会影响主机的其他服务。

##### 监控

*   docker stats命令：docker自带的监控命令，只能看当前时间当前容器的状态
*   cAdvisor：采集主机上所有容器信息，提供界面和接口，也是k8s的默认容器监控工具
*   Prometheus：

##### namespace

namespace是Linux内核的特性，他可以保证同一个主机中的进程ID、用户ID、主机名、文件名、网络和进程通信的隔离。

Linux5.6内核提供了8种类型的namespace

*   mount(met)：实现不同的进程看到不同的挂在目录
*   process ID(pid)：隔离进程
*   network(net)：隔离网络设备、ip和端口等，可以让每个进程拥有自己的独立ip
*   interprocess communication(ipc)：隔离进程通信的，同一个ipc下的进程才能通信
*   UTS：隔离主机名
*   user：隔离用户和用户组
*   control group(cGroup)：隔离cgroups
*   time：隔离系统时间

##### cgroups

限制进程使用的CPU、内存、io、带宽等。

##### docker组件

![docker架构(1)](https://raw.githubusercontent.com/wangxiaohong123/p-bed/main/uPic/docker架构 (1).png)

##### 网络

CNM是docker发布的容器网络标准，它定义了一些接口，只要是实现了这些接口都可以介入docker网络。Libnetwork是CNM官方的实现。Libnetwork有4种模式

*   null模式：没有网卡配置、ip、路由等；
*   bridge模式：可以实现容器和容器的网络互通，由Linux bridge + Linux veth实现，Linux bridge相当于一个虚拟的交换机，Linux veth相当于一根虚拟的网线；
*   host模式：容器直接使用主机的网络配置，端口也是直接占用主机的端口；
*   container模式：两个容器之间共享网络配置；

不过最后还是k8s的CNI成为了容器的网络标准

##### 卷(Volume)

卷是容器的文件系统，让容器可以把数据持久化到磁盘。

2种方式创建卷：

```shell
# 手动创建卷
docker volume create myVolume

# 启动容器时指定容器内需要被持久化的路径，docker会自动创建卷
docker run …… -v /xxx/xxx
```

查看卷

```shell
docker colume ls
```

使用卷

```shell
# 使用-mount命令指定容器使用myVolume卷
docker run …… -mount source=myVolume,target=/xxx/xxxx
```

删除容器时不会删除容器创建的卷，需要使用`docker volume rm`命令

主机和容器的目录共享

```shell
# 启动时使用-v参数让主机的/data目录挂在到容器的/usr/local/data目录下
docker run …… -v /data:/usr/local/data ……
```

