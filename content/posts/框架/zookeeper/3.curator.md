---
title: 3.zk-curator
tags:
  - 大数据
categories: zookeeper
copyright: ture
---

curator是业内使用最广泛的zk客户端框架。他是网飞的。

1.   crud

     ```java
     public static void main(String[] args) throws Exception {
         RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 3);
         // 源码里用的构造器模式
         CuratorFramework client = CuratorFrameworkFactory.newClient("localhost:2181",
                                                                     // 心跳超时时间
                                                                     5000,
                                                                     // 连接超时时间
                                                                     3000,
                                                                     retryPolicy);
         client.start();
     
         client.delete().forPath("/my/path");
     
         // creatingParentsIfNeeded是自动创建父节点
         // withMode是节点类型，临时节点、永久节点、临时顺序节点……
         client.create().creatingParentsIfNeeded().withMode(CreateMode.PERSISTENT)
             .forPath("/my/path", "100".getBytes(StandardCharsets.UTF_8));
         System.out.println(new String(client.getData().forPath("/my/path")));
     
         client.setData().forPath("/my/path", "200".getBytes(StandardCharsets.UTF_8));
         System.out.println(new String(client.getData().forPath("/my/path")));
     
         client.close();
     }
     ```

2.   znode节点监听

     ```java
     public static void main(String[] args) throws Exception {
         RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 3);
         CuratorFramework client = CuratorFrameworkFactory.newClient("localhost:2181",
                                                                     5000, 3000, retryPolicy);
         client.start();
     
         NodeCache nodeCache = new NodeCache(client, "/cluster/node");
         nodeCache.start();
         nodeCache.getListenable().addListener(() -> {
     
         });
     }
     ```

3.   子节点监听

     ```java
     public static void main(String[] args) throws Exception {
         RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 3);
         CuratorFramework client = CuratorFrameworkFactory.newClient("localhost:2181",
                                                                     5000, 3000, retryPolicy);
         client.start();
     
         PathChildrenCache pathChildrenCache = new PathChildrenCache(client, "/cluster", true);
         // 添加监听
         pathChildrenCache.getListenable().addListener((curatorFramework, pathChildrenCacheEvent) -> {
     
         });
         // start可以指定模式，比如：PathChildrenCache.StartMode.BUILD_INITIAL_CACHE
         pathChildrenCache.start();
     }
     ```

     