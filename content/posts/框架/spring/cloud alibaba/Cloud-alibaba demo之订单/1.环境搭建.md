---
title: 1.环境搭建
tags:
  - cloud-alibaba
categories: 订单demo
copyright: true
---

### 1.安装jdk

jdk版本：8u191

把rpm包传到虚拟机，执行命令安装：

```shell
rpm -ivh jdk-8u191-linux-x64.rpm
```

默认的安装目录是**/usr/java/**

配置环境变量，编辑.bash_profile文件：

```shell
vi ~/.bash_profile
```

在文件中添加JAVA_HOME：

```shell
export JAVA_HOME=/usr/java/latest
export PATH=$PATH:$JAVA_HOME/bin
```

![](https://tva1.sinaimg.cn/large/008i3skNly1gxcq2ha9x5j30zg0eumyl.jpg)

保存退出，刷新配置文件：

```shell
source ~/.bash_profile
```

### 2.安装MySQL

使用yum仓库安装mysql5.7版本：

```shell
wget http://repo.mysql.com//mysql57-community-release-el7-11.noarch.rpm

yum localinstall mysql57-community-release-el7-11.noarch.rpm

yum install -y mysql-community-server.x86_64
```

启动MySQL server：

```shell
systemctl start mysqld.service
```

在MySQL日志里找到root的临时密码：

```shell
cat /var/log/mysqld.log | grep 'password'
```

复制临时密码登录MySQL：

```shell
mysql -uroot -p
```

首次登录需要设置密码，否则不能进行数据库操作，旧版本mysql的password()函数将会被抛弃，使用下面的命令来修改密码：

```mysql
# 他这个默认密码策略应该是高，长度最少8位，大小写字母加数字加符号
# 查看策略：SHOW VARIABLES LIKE 'validate_password%';
# 修改策略：set global validate_password_policy=LOW;
# 其他策略关键词：
# validate_password_length  固定密码的总长度；
# validate_password_dictionary_file 指定密码验证的文件路径；
# validate_password_mixed_case_count  整个密码中至少要包含大/小写字母的总个数；
# validate_password_number_count  整个密码中至少要包含阿拉伯数字的个数；
# validate_password_policy 指定密码的强度验证等级，默认为 MEDIUM；
# validate_password_policy的取值：
#	0/LOW：只验证长度；
#	1/MEDIUM：验证长度、数字、大小写、特殊字符；
#	2/STRONG：验证长度、数字、大小写、特殊字符、字典文件；
# validate_password_special_char_count 整个密码中至少要包含特殊字符的个数
ALTER USER 'root'@'localhost' IDENTIFIED BY 'Wang123!';

# exit;退出后重启MySQL
systemctl start mysqld.service
```

#### 配置

*   配置root远程授权：

    先登录MySQL执行以下命令授权：

    ```mysql
    grant all privileges on *.* to 'root'@'%' identified by 'Wang123!' with grant option;
    # 刷新权限
    FLUSH PRIVILEGES;
    ```

*   大小写敏感配置，编辑配置文件：

    ```shell
    vi /etc/my.cnf
    ```

    增加配置：

    ```properties
    lower_case_table_names=1
    ```

*   修改最大连接数，在my.cnf中增加配置：

    ```properties
    max_connections=1000
    ```

修改完后再次重启生效

### 3.安装nacos

将nacos-server-2.0.3传到服务器上解压：

```shell
tar -zxvf nacos-server-2.0.3.tar.gz
```

配置mysql持久化：nacos的mysql初始化文件在nacos的conf目录(nacos-mysql.sql)，下载这个文件，然后在链接MySQL创建一个nacos_config数据库：

```mysql
CREATE database if NOT EXISTS `nacos_config` default character set utf8 collate utf8_general_ci;

use nacos_config;
```

然后执行刚才下载的脚本：

```mysql
source nacos-mysql.sql
```

然后配置nacos的mysql支持，编辑conf目录下的application.properties:

```properties
spring.datasource.platform=mysql
db.num=1
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC
db.user.0=root
db.password.0=Wang123!
```

修改nacos/bin/startup.sh里的jvm参数，然后单机模式启动：

```shell
./nacos/bin/startup.sh -m standalone
```

启动完了可以使用jps -l查看是否有nacos的进程，或者查看nacos/logs/start.out日志文件。启动成功后开发8848端口，通过ip:8848/nacos打开nacos控制台，默认用户密码都是nacos。

### 4.安装redis6

先安装gcc依赖：

```shell
yum install -y gcc-c++ autoconf automake
# 查看gcc版本
gcc -v
# centos7默认安装的gcc版本是4.8.5，安装redis6需要5.3以上的版本
# 执行一下命令直接升到9版本
yum -y install centos-release-scl
yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
scl enable devtoolset-9 bash  
echo "source /opt/rh/devtoolset-9/enable" >>/etc/profile
```

安装tcl：

```shell
# tcl要求8.5以上，centos7默认安装的是8.5
yum install -y tcl
```

将redis6上传到服务器并解压：

```shell
tar -zxvf redis-6.2.6.tar.gz
```

进入redis目录编译安装：

```shell
cd redis-6.2.6
make test
# make install这个命令就是自动把redis-6.2.6/src目录下redis的相关命令安装到了linux的PATH目录中去了
make && make install
```

配置：

将redis-6.2.6/utils/目录下的redis_init_script脚本拷贝到/etc/init.d/目录加，重命名为redis_6379:

```shell
cp utils/redis_init_script /etc/init.d/redis_6379
```

在etc下创建redis目录：

```shell
mkdir /etc/redis
```

将redis目录下的redis.conf拷贝到/etc/redis/下，重命名为6379.conf：

```shell
cp ~/redis-6.2.6/redis.conf /etc/redis/6379.conf
```

创建目录/var/redis/6379，用于存放redis的持久化文件：

```shell
mkdir -p /var/redis/6379/
```

修改/etc/redis/6379.conf中的配置：

```properties
# 让redis以daemon进程运行
daemonize	yes
# 设置redis的pid文件位置
pidfile		/var/run/redis_6379.pid
# 设置redis的监听端口号
port		6379
# 设置持久化文件的存储位置
dir			/var/redis/6379
# 注释掉这一行，允许公网ip访问                             
# bind 127.0.0.1
# 默认是yes，要改为no，允许远程连接
protected-mode no
# 设置密码
requirepass Wang123
```

让redis跟随系统启动时自动启动：修改/etc/init.d/redis_6379脚本中，在### BEGIN INIT INFO上面，加入两行注释：

```shell
# chkconfig:   2345 90 10 
# description:  Redis is a persistent key-value database
```

设置开机启动：

```shell
chmod 777 /etc/init.d/redis_6379
chkconfig /etc/init.d/redis_6379 on
```

启动并连接redis：

```shell
service redis_6379 start

redis-cli -h 127.0.0.1 -p 6379
# 进入redis页面后输入密码
auth Wang123
```

### 5.安装rocektmq

将rocketmq-all-4.7.1-bin-release.zip传到服务器解压：

```shell
yum install -y unzip
unzip rocketmq-all-4.7.1-bin-release.zip
```

调整nameserver的jvm参数：

```shell
vim ~/rocketmq-all-4.7.1-bin-release/bin/runserver.sh 
```

守护进程方式启动nameserver：

```shell
nohup sh ~/rocketmq-all-4.7.1-bin-release/bin/mqnamesrv &
```

查看nameserver日志：

```shell
tail -f ~/logs/rocketmqlogs/namesrv.log
```

修改broker的jvm参数：

```shell
vim ~/rocketmq-all-4.7.1-bin-release/bin/runbroker.sh
```

守护进程的方式启动broker：

```shell
# 39.103.162.187:9876是Name Server服务的地址与端口
nohup sh ~/rocketmq-all-4.7.1-bin-release/bin/mqbroker -n 39.103.162.187:9876 &
```

查看broker日志：

```shell
tail -f ~/logs/rocketmqlogs/broker.log
```

启动控制台：
将rocketmq-console-ng-1.0.1.jar闯到服务器并启动：

```shell
nohup java -jar -server -Xms1g -Xmx1g -Drocketmq.config.namesrvAddr=39.103.162.187:9876 -Dserver.port=8080 rocketmq-console-ng-1.0.1.jar &
```

访问**http://39.103.162.187:8080/**进入控制台。

### 6.安装seata

将seata-server-1.3.0.zip传到服务器并解压：

```shell
unzip seata-server-1.3.0.zip
```

进入seata目录：

```shell
cd seata
```

修改jvm参数：

```shell
vi bin/seata-server.sh
```

启动并查看日志：

```shell
nohup sh bin/seata-server.sh &

tail -f nohup.out
```

