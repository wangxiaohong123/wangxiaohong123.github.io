---
title: nacos-1.集群搭建
tags:
  - nacos
categories: 框架
copyright: true
---

官网推荐vip模式集群，VIP是指虚拟ip，单点故障的时候会自动漂移到可用节点。 三台机器分别安装keepalived和nacos：

先整个jdk；

安装keepalived：

```shell
yum install -y gcc openssl-devel popt-devel
yum install -y libnl libnl-devel
yum install -y libnfnetlink-devel
yum install -y curl gcc openssl-devel libnl3-devel net-snmp-devel libnfnetlink-devel

# 解压安装
tar -xzvf keepalived-2.1.5.tar.gz
cd keepalived-2.1.5/
./configure --prefix=/usr/local/keepalived
make && make install

# 创建启动文件
cd /usr/local/
cp  -a keepalived/etc/keepalived /etc/init.d/
cp  -a keepalived/etc/sysconfig/keepalived /etc/sysconfig/
cp  -a keepalived/sbin/keepalived /usr/sbin/

# 创建配置文件
mkdir /etc/keepalived
cd  /etc/keepalived
##复制配置文件
cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived
```

修改keeplived.conf

```shell
global_defs {
    }
    # nacos内网ip
    router_id 172.20.236.192
}

vrrp_instance VI_52 {
    state BACKUP
    interface eth0
    virtual_router_id 52
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
    	192.168.30.110
    }
}
```

```shell
# 启动
systemctl start keepalived.service
# 查看是否启动成功
cat /var/log/messages

# 重新加载
systemctl daemon-reload
# 设置开机自动启动
systemctl enable keepalived.service
# 取消开机自动启动
systemctl disable keepalived.service
# 停止
systemctl stop keepalived.service
```

systemctl daemon-reload重新加载配置文件

安装nacos

```shell
tar -zxvf nacos-server-1.4.0.tar.gz
# 进去解压后的conf目录
vim application.properties
```

修改数据库信息：

```shell
spring.datasource.platform=mysql

### Count of DB:
db.num=1

### Connect URL of DB:
db.url.0=jdbc:mysql://rm-8vb83pc34p80xo5d5.mysql.zhangbei.rds.aliyuncs.com:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=GMT+8
db.user=nacos
db.password=Qiyuan1502
```

配置集群

```shell
mv cluster.conf.example  cluster.conf

# 修改集群信息
172.20.236.192:8848
172.20.236.193:8848
172.20.236.194:8848

# 进入nacosbin目录，启动服务
sh startup.sh
```

