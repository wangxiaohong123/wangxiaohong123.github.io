---
title: saga事务
tags:
  - 事务
categories: 框架
copyright: true
---

saga和tcc很像，tcc是把接口拆成三个，try、confirm、cancel，saga就是两个，try和confirm合并为一个。

### 两种思想

*   编排模式：事件驱动模式，服务之间的调用时通过发布事件，监听时间来驱动，比如借助mq，回滚也是一样的，通过事件来驱动。编排模式很有去中心化的思想，而且是异步调用，缺点就是异步发生异常不好排查问题，而且需要依赖mq。
*   命令模式：类似tcc，有一个saga分布式事务管理器，同步调用。优点和缺点和编排模式相反。

### AxonFramework

AxonFramework是一个CQRS框架，在国内几乎没人用，不过它是基于DDD，现在国内DDD正火，而且这个框架自带saga事务的实现，

**aggregate**：聚合，就是类图中的聚合。

**event sourcing**：回溯，存储数据变化的历史版本，这样就可以找到历史的版本。

**Actor模型**：每个actor都是一个线程，都有个mailbox，各个actor都可以通过mailbox相互通信，这样的话就没有并发问题了，因为线程值直接修改数据的。

**CQRS**：命令和查询职责分离，c就是command，增删改的操作，q就是query，查询，大概意思就是增删改和查询时两个服务，写服务写到单独的存储里去，比如mysql，有一个单独的同步组件，把数据同步到读用到的存储中，比如es。

这些都是DDD中的概念。DDD中提到了一种事务模型，就是saga事务模型。

### saga事务框架

Eventuate Tram Saga：gitbub才100多star，哈哈哈哈哈哈，作者还出了本书。

AxonFramework：1000多star，他不是事务框架，只是顺带包括了saga事务。

华为的ServiceComb：这是一套分布式的技术栈，包括了saga的支持。

这就能看出来，saga的运用还是比较少的，也没有单独的成熟的方案，都是包括在了框架中。