---
title: 3.分布式id-leaf
date: 2021-01-19 06:27:35
tags:
  - 分布式id
categories: 框架
copyright: true
---

leaf有两种实现方式，flicker和snowflake，[leaf文档][https://tech.meituan.com/2017/04/21/mt-leaf.html]，它实现的flicker和之前的方案一模一样，多了一个号段的buffer，当一个号段用完之后切换，实现一个号段buffer一只可用，没有号段用完的阻塞。

leaf实现的snowflake要简单一些，启动的时候判断是否发生长时间的时钟回拨，然后在生成id的时候简单判断当前时间和上次生成id的时候，如果比上次生成id的时间小就等10ms，如果还是不行就返回错误了，并且他建议关闭NTP同步服务，他把一些细节比如重试、服务下线什么的交给自己实现了。

源码非常简单。