---
title: 2.Dart基础
tags:
  - flutter
categories: 前端
copyright: true
---

**Dart是单线程模型，他的核心是基于Isolate（隔离单元）的并发模型**

### 1 空安全

Dart在2.12版本之后支持了空安全，空安全就是避免null引起的崩溃。

在变量类型后出现问号'?'表示变量允许为空，比如`String? name`，对于可以为空的变量在使用时也需要增加问号。

启用空安全后类的成员变量是不允许为空的，初始化的方式可以为：

```dart
class CommonModel {
    // 定义时初始化
    List names = [];
    // 构造方法中初始化
    final List colors;
    // 延迟初始化，对于没法在定义的时候初始化，又不想使用问号?访问，但是延迟初始化还是会有null异常的情况
    late List urls;
    
    setUrls(List urls) {
        this.urls = urls;
    }
}
```

叹号'!'表示取反或者空值的断言。

### 2 数据类型

Dart中可以使用var或者具体的类型来声明变量，当使用var的时候编译器会自动推断类型。默认情况未初始化的变量值都是null，所有类型都是对象，即Object的子类。

1.   数字
     *   num：int和double的父类，它可以是整数或者浮点数
     *   int(64位)：整型
     *   double(64位)：浮点型
     *   字符串（String），可以使用单引号或者双引号来定义，多行字符串使用三个双引号或者单引号，还能在字符串中嵌入常量或者表达式：`var s = 'this is a uppercased string: ${s.toUpperCase()}'`。
2.   布尔（bool），编译时常量。
3.   数组（List），他是有泛型的，不指定泛型的时候可以放任意类型比如`List l = [1, 2, "qqq"]`，如果指定泛型比如`List<int>`插入double类型就会报错。 
4.   字典（Map），和List一样不指定泛型的时候key和value可以是任意类型。
5.   动态类型（dynamic），所有类型的基础类型，一般不直接使用，因为直接使用这个定义的变量不会检查属性或者方法是否支持。var是一个关键字，他的作用和dynamic差不多，都是动态推断类型，但是一旦赋值之后不能改变类型，这是他和dynamic的区别。

定义常量使用关键字final或者const，const表示编译时确定，final可以在运行时指定。

### 3 函数

函数的定义是返回值类型 + 方法名 + 参数，比如`int sum(int i, int j) {}`，返回值可以是void也可以缺省。入参如果在大括号中表示可选命名参数，用这种方式来代替java中的函数重载概念。参数可以设置默认值。**下划线修饰的方法表示私有方法**。

除了可选命名参数，还有一种可选参数，使用中括号扩起来，**可选参数和可选命名参数在函数的声明时都可以设置默认值，调用时都可以不传**，二者的区别是可选参数调用时不需要指定对应的变量名，按顺序给参数赋值，可编命名参数调用时必须指定对应的参数名：

```dart
// 可选参数
void printUserInfo(String name, [int age = 18, String? city]) {
  print('Name: $name, Age: $age, City: ${city ?? 'Unknown'}');
}

// 可选命名参数
void printUserProfile(String name, {int age = 18, String? city}) {
  print('Name: $name, Age: $age, City: ${city ?? 'Unknown'}');
}

void main() {
  // 可选参数调用
  printUserInfo('Alice');           // 输出: Name: Alice, Age: 18, City: Unknown
  printUserInfo('Bob', 25);         // 输出: Name: Bob, Age: 25, City: Unknown
  printUserInfo('Charlie', 30, 'NY'); // 输出: Name: Charlie, Age: 30, City: NY

  // 可选命名参数调用
  printUserProfile('Alice');                   // 输出: Name: Alice, Age: 18, City: Unknown
  printUserProfile('Bob', age: 25);            // 输出: Name: Bob, Age: 25, City: Unknown
  printUserProfile('Charlie', city: 'NY', age: 30); // 输出: Name: Charlie, Age: 30, City: NY
}
```

### 4 类

Dart中没有public、protected、private 这些关键字，下划线开头的变量或者函数表示私有，但是Dart中的私有不是类级别的，而是库级别的，在Dart中，一个文件就相当于一个库。

```dart
class Person {
    // 构造方法,方法体不是必须的
    Person(this.name, this.age):full = '$name.$age' {}
    
    // 命名构造方法
    Person.cover(Person p) {}
    
    String? name;
    int? age;
    String? full;
    String? _school;
    
    set school(String school) {
        _school = school;
    }
    String? get school => _school;
    
    @override
    String toString() {
        return 'name:$name,age:$age'
    }
}
```

除了继承和实现，Dart中还有一个混入的概念，不需要继承和实现也能使用其他类的方法和变量，使用关键字`with`实现。

### 5 运算符

Dart中有几个特殊的运算符：

*   ?.：为空时跳过，比如`p?.printInfo()`
*   ??=：如果a是空，则给a赋值，比如`a??=1`
*   ??：三位运算符的省略版，如果a是空返回b，不是空就返回a，`return a??b`
