---
title: 常用命令
tags:
  - git
categories: git
copyright: true
---
```shell
# 设置用户名和邮箱
# --global：设置当前用户范围内的配置，对机器上的其他用户是无效的
# --system：对当前机器上所有用户都生效
# 什么都不写是对当前所在的git项目本身生效
git config --global user.name "xiaohong"
git config --global user.email "2211966086@qq.com.com"
# 查看git配置
git config --list

# windows初始化git之前需要执行这个
git config --global core.autocrlf false
# 初始化git项目
git init
# 添加变更，如果不写--all，被删除的文件不会提交
git add --all .
# 提交变更
git commit -m 'description'
# 添加远程仓库，初始化后需要执行一次
git remote add origin https://gitee.com/HongJie123/gitTest.git
# 提交到远程仓库。-u的意思是和远程仓库关联，第一次使用之后就不用了
git push -u origin master

# 查看托管到git的文件的状态
git status
# 查看最近2次提交历史，没有用，有的时候提交的内容很多，根本显示不下，看的你头皮发麻
git log --patch -2
# 只用一行显示，显示commit内容用SHA1的hash算法算出来的hash值，默认显示前7位，--graph是图形化的
git log --oneline --abbrev-commit --graph
# 拉取代码
git pull
# 变基拉取代码
git pull --rebase

# 回退到上一个版本，加上--hard会把工作区也还原
git reset --hard HEAD^
# 回退到倒数第5个版本
git reset --hard HEAD~5
# 回退到d324644的版本，包括回退之前的版本也可以回退
git reset --hard HEAD d324644
# 也是查看log，他可以看到被删除的commit记录和reset的记录，想要还原reset可以用这个命令查看然后git reset --hard HEAD d324644进行还原
git reflog

# 创建分支
git branch testing
# 切换分支
git checkout testing
# 将分支推送到远程仓库
git push -u origin testing
# 创建featrue/张三分支并切换
git checkout -b featrue/张三
# 合并分支
git merge featrue/张三
# 删除分支
git branch -d featrue/张三
```

##### SSH多账户(云效平台)

多个项目不同的代码管理平台时需要使用多个SSH账户分别绑定项目，先为每个项目创建ssh密钥对：

```shell
# 邮箱是云效平台绑定的邮箱

# takela_rsa是为塔可拉主体创建的密钥对名称
ssh-keygen -t rsa -C "2211966086@qq.com" -f ~/.ssh/takela_rsa

# qiyuan_rsa是为起源科技主体创建的密钥对名称
ssh-keygen -t rsa -C "wanghongyu@orderorigins.com" -f ~/.ssh/qiyuan_rsa

# github
ssh-keygen -t rsa -C "2211966086@qq.com" -f ~/.ssh/github_rsa
```

然后配置ssh配置文件(～/.ssh/config)：

```shell
# 塔可拉账号
Host takela
HostName codeup.aliyun.com
IdentityFile ~/.ssh/takela_rsa
PreferredAuthentications publickey
IdentityAgent none
IdentitiesOnly yes

# 起源
Host qiyuan
HostName codeup.aliyun.com
IdentityFile ~/.ssh/qiyuan_rsa
PreferredAuthentications publickey
IdentityAgent none
IdentitiesOnly yes

# github
Host github
HostName github.com
# Github必须要有这个配置
User git
IdentityFile ~/.ssh/github_rsa
PreferredAuthentications publickey
IdentityAgent none
IdentitiesOnly yes
```

其中Host takela是配置的别名，之后配置代码git地址要用到，IdentityFile改成具体的路径，剩下的都是固定的。

最后在云效或者github配置公钥(.pub文件)。

```shell
# 测试，如果返回You've successfully authenticated...说明配置成功
ssh -T qiyuan
```

**新项目克隆**时将域名换成刚才ssh配置文件的别名，例如：

```shell
# 正常克隆命令
git clone git@codeup.aliyun.com:654603e231b5b6a2396d3059/so_candy-cms.git
# 多ssh文件克隆命令
git clone git@takela:654603e231b5b6a2396d3059/so_candy-cms.git
```

如果**项目在本地已经存在**只需要修改本地代码的远程仓库地址：

```shell
git remote set-url origin git@takela:654603e231b5b6a2396d3059/so_candy_cms_web.git
git fetch --all

# 如果远程仓库提示远程和本地历史记录没有共同的起点：
# efusing to merge unrelated histories
# 拉取远程分支，允许无关历史合并
git pull origin master --allow-unrelated-histories --no-rebase
# 解决合并冲突（如果有的话）
git status
# 编辑冲突文件并解决冲突
git add .
git commit -m "Merge remote master branch with unrelated histories"
# 推送到远程
git push origin master
```

```shell
git remote add origin git@github:wangxiaohong123/wangxiaohong123.github.io.git
git branch -M main  # 设置主分支为 main（GitHub 默认）
```

