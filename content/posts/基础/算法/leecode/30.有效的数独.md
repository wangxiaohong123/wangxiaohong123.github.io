---
title: 30.有效的数独
date: 2022-11-30 06:27:35
tags:
  - 算法
categories: leecode
copyright: true
---

### 题目

请你判断一个 9 x 9 的数独是否有效。只需要 根据以下规则 ，验证已经填入的数字是否有效即可。

1.   数字 1-9 在每一行只能出现一次。
2.   数字 1-9 在每一列只能出现一次。
3.   数字 1-9 在每一个以粗实线分隔的 3x3 宫内只能出现一次。（请参考示例图）

**注意：**

*   一个有效的数独（部分已被填充）不一定是可解的。
*   只需要根据以上规则，验证已经填入的数字是否有效即可。
*   空白格用 '.' 表示。

### 题解

判断数独是否有效不难，因为他不需要判断是否可解，挑战的点可能就是判断[i][j]属于第几个小矩阵：$ (i / 3) * 3 + j / 3$

##### 1.hash

把每行、每列、每个9宫格都放到map中，判断是否出现重复。

##### 2.按位存储

hash是很浪费空间的，因为我们把每个数都存了3遍。可以利用位运算把每个数字以偏移量的方式存到int中：

```java
public class ValidSudoku {

    public boolean isValidSudoku(char[][] board) {
        // 把map换成二维数组会更省空间
        Map<Integer, Integer> rowMap = new HashMap<>(9);
        Map<Integer, Integer> colMap = new HashMap<>(9);
        Map<Integer, Integer> cellMap = new HashMap<>(9);

        for (int i = 0; i < board.length; i++) {
            for (int j = 0; j < board[i].length; j++) {
                char c = board[i][j];
                if (c == '.') {
                    continue;
                }

                int cn = 1 << c;
                if ((colMap.getOrDefault(i, 0) & cn) > 0) {
                    return false;
                } else {
                    colMap.put(i, colMap.getOrDefault(i, 0) | cn);
                }

                if ((rowMap.getOrDefault(j, 0) & cn) > 0) {
                    return false;
                } else {
                    rowMap.put(j, rowMap.getOrDefault(j, 0) | cn);
                }

                int cellOrder = (i / 3) * 3 + j / 3;
                if ((cellMap.getOrDefault(cellOrder, 0) & cn) > 0) {
                    return false;
                } else {
                    cellMap.put(cellOrder, cellMap.getOrDefault(cellOrder, 0) | cn);
                }
            }
        }

        return true;
    }
}
```