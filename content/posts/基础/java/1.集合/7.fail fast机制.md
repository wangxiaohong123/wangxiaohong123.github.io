---
title: fail fast
tags:
  - java源码
  - 集合
categories: 基础
copyright: true
---

fail fast就是说，在迭代器遍历的时候，其他线程过来修改集合，迭代器就会报错，concurrentModificationException。

之前看的集合源码中的增删改操作都会有个操作，modCount++，在初始化迭代器的时候会把modCount赋值给迭代器的exceptedModCount。

```java
int expectedModCount = ArrayList.this.modCount;
```

在执行next()的时候会执行checkForComodification方法，如果不相等就抛出异常。

```java
final void checkForComodification() {
    if (expectedModCount != ArrayList.this.modCount)
        throw new ConcurrentModificationException();
}
```

