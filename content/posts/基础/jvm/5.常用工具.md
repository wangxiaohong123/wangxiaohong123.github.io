---
title: jvm-5.常用工具
tags:
  - JVM
categories: 基础
copyright: true
---

这些工具都在java_home/bin目录下，主要分成3类：

*   商业授权工具：主要是JMC以及他要用到的JFR，用这个需要付费。
*   正式支持工具：长期支持，可能会因为版本、平台稍微不同，但是不会突然消失。
*   实验性工具：这些工具在说明中被声明成不支持并且是实验性质的，可能会转正也可能会消失。

##### jstat

jstat是用来监视虚拟机各种运行状态信息的命令。命令格式是jstat [option] PID [interval[s|ms]] [count]。比如 jstat -gc 20420 1000 10 ：每过1s打印一次PID是20420的系统的gc信息，打印十次。

![](https://tva1.sinaimg.cn/large/006tNbRwly1gatx2glmk3j30r101ua9z.jpg)

* S0C： From Survivor区大小

* S1C：To Survivor区大小

* S0U：From Survivor区使用的内存大小

* S1U：To Survivor区使用的内存大小

* EC：Eden区大小

* EU：Eden区使用的内存大小

* OC：老年代大小

* OU：老年代使用的内存大小

* MC：元数据空间大小

* MU：元数据空间使用大小

* CCSC：压缩类空间大小

* CCSU：压缩类空间使用内存大小

* YGC：系统运行到现在yongGC的次数

* YGCT：YGC的总耗时（秒）

* FGC：系统运行到现在OldGC的次数

* FGCT：FGC的总耗时（秒）

* GCT：所有GC的总耗时（秒）

```shell
# 查看类加载、卸载、总空间以及装在消耗时间
jstat -class PID
# 堆内存分析
jstat -gccapacity PID
# 年轻代GC分析，这里的TT和MTT可以看到对象在年轻代存活的年龄和存活的最大年龄
jstat -gcnew PID
# 年轻代内存分析
jstat -gcnewcapacity PID
# 老年代GC分析
jstat -gcold PID
# 老年代内存分析
jstat -gcoldcapacity PID
# 元数据区内存分析
jstat -gcmetacapacity PID
# 即时编译过的方法、耗时
jstat -compiler PID
```

##### jmap

主要就是用来生成堆的快照。

*   jmap -histo PID：显示对象的实例数和占用内存大小，从大到小排序；
*   jmap -dump:[live],format=b,file=dump.hprof [PID]，将jvm里对象输出到dump.hprof文件快照里，这是一个二进制文件，需要使用jhat或者mat等工具打开，live的意思是只dump出存活对象；
*   jmap -heap PID：显示堆详细信息，比如使用什么回收器、参数、分带情况等；
*   -F：当-dump没有响应的时候，使用这个强制生成内存快照；

##### jhat

用来分析jmap生成的内存快照，比较简陋，一般不会用，因为不会有人在服务器上直接分析内存，很费资源，如果下载的话就使用别的工具了。

jhat dump.hprof：使用jhat打开dump.hprof文件，会启动一个http服务，在浏览器通过ip:7000访问（默认7000端口）。

##### jstack

生成虚拟机的线程快照，可以查看当前每条线程正在执行的方法堆栈，一般用来定位长时间停顿的原因的。jstack [-Flm] PID，F表示输出的请求没有响应的时候强制输出线程堆栈，l意思是显示锁的附加信息，m意思是显示本地方法。

但是java.lang.Thread类有个方法叫getAllStackTraces()用来获取所有线程的堆栈信息，这个是可以代替kstack的。

##### javap

javap -verbose class文件：用来分析class的字节码内容。