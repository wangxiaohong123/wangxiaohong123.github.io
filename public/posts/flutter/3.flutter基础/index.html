<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>3.Flutter基础 | 王小红的笔记</title>
<meta name="keywords" content="flutter">
<meta name="description" content="Flutter就是一个内嵌了多平台原生工程的父工程。
最省事的跨平台方案是继浏览器控件的，比如uniApp，99%的需求都可以使用一套代码实现。但是这种基于手机内嵌的浏览器内核在性能上很差，比如web方式的跨平台一般使用css&#43;js实现动画，原生可以使用GPU加速；浏览器内核需要解析HTML、CSS、JavaScript，和iOS的UIKit、Android的View没法比，其次WebView的内存管理不好，容易导致内存占用过高。
React Native虽然使用的是JavaScript&#43;React方式，但是他使用原生渲染，性能可以但是复杂的交互和动画实现不了。**Flutter自己对Dart进行了封装，而且自己实现了渲染逻辑。**他使用SKia(2005年收购的产品)作为图像绘制引擎，SKia保证一套代码在不同平台渲染出相同效果。
1 架构和渲染

Flutter架构分为三层：

Embedder ：操作系统适配层，实现了渲染 Surface 设置，线程设置，以及平台插件等平台相关特性的适配。Flutter 平台相关特性并不多，这就使得从框架层面保持跨端一致性的成本相对较低。
Engine ：引擎层，主要包含 Skia、Dart 和 Text，实现了 Flutter 的渲染引擎、文字排版、事件处理和 Dart 运行时等功能。Skia 和 Text 为上层接口提供了调用底层渲染和排版的能力，Dart 则为 Flutter 提供了运行时调用 Dart 和渲染引擎的能力。而 Engine 层的作用，则是将它们组合起来，从它们生成的数据中实现视图渲染。
Framework ：一个用 Dart 实现的 UI SDK，包含了动画、图形绘制和手势识别等功能。为了在绘制控件等固定样式的图形时提供更直观、更方便的接口，Flutter 还基于这些基础能力，根据 Material 和 Cupertino 两种视觉设计风格封装了一套 UI 组件库。我们在开发 Flutter 的时候，可以直接使用这些组件库。其中Material是基于Google 的 Material Design 设计的组件库，Cupertino是基于Apple 的 iOS 设计规范设计的组件库。

1.1 渲染
渲染氛围4个阶段：布局、绘制、合成、渲染。Flutter中的元素以树的形式存在，采用深度优先的方式进行布局和绘制，然后进行一次合成，将所有涂层根据 大小、层级、透明度等规则计算出最终的显示效果，这么做是为了简化渲染树，提高渲染效率，合并完成之后交给SKia加工成二维的图像数据，最后交给GPU渲染。
2 线程模型

Dart是单线程的，但Flutter是多线程的，在Flutter中Dart的代码都运行在UI线程上，Dart的单线程模型中涉及到2个任务队列，微任务队列和事件队列，微任务队列的优先级比事件队列要高。所以微任务队列用来处理短小、优先级高的任务，flutter的回调、async的内部调度等；事件队列用来处理定时器、网络请求、用户输入、UI等任务。因为UI线程是主线程，是所有任务的入口，不过一些请求虽然会进到事件任务队列，但是UI线程会根据语法判断出这些任务不是自己处理的。
当出现不是UI线程处理的任务时会调用引擎API，让引擎判断应该是哪个线程处理后通过消息发送到对应线程的Task Runner，其他线程处理完任务也会通过引擎发送到UI线程的Task Runner，之后会将任务的处理结果封装成回调重新入队。
3 Widget
**Widget不可变设计：**为了简化开发，并发修改时是线程不安全的。
Flutter中Widget是数据映射，也是功能的抽象描述，也是试图的配置信息，他是组建实现的基本逻辑单位，一切皆是Widget。
大部分UI框架都会将试图数据封装成树结构，在将这些数据提供给渲染引擎，Flutter视图树进行了扩展，分成了Widget、Element和RenderObject三层。">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/flutter/3.flutter%E5%9F%BA%E7%A1%80/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css" integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/flutter/3.flutter%E5%9F%BA%E7%A1%80/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="/katex/katex.min.css">
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false},
        {left: "\\(", right: "\\)", display: false},
        {left: "\\[", right: "\\]", display: true}
      ]
    });
  });
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="王小红的笔记 (Alt + H)">王小红的笔记</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="笔记">
                    <span>笔记</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      3.Flutter基础
    </h1>
    <div class="post-meta">9 min

</div>
  </header> 
  <div class="post-content"><p><strong>Flutter就是一个内嵌了多平台原生工程的父工程。</strong></p>
<p>最省事的跨平台方案是继浏览器控件的，比如uniApp，99%的需求都可以使用一套代码实现。但是这种基于手机内嵌的浏览器内核在性能上很差，比如web方式的跨平台一般使用css+js实现动画，原生可以使用GPU加速；浏览器内核需要解析HTML、CSS、JavaScript，和iOS的UIKit、Android的View没法比，其次WebView的内存管理不好，容易导致内存占用过高。</p>
<p>React Native虽然使用的是JavaScript+React方式，但是他使用原生渲染，性能可以但是复杂的交互和动画实现不了。**Flutter自己对Dart进行了封装，而且自己实现了渲染逻辑。**他使用SKia(2005年收购的产品)作为图像绘制引擎，SKia保证一套代码在不同平台渲染出相同效果。</p>
<h3 id="1-架构和渲染">1 架构和渲染<a hidden class="anchor" aria-hidden="true" href="#1-架构和渲染">#</a></h3>
<p><img alt="flutter架构图" loading="lazy" src="https://raw.githubusercontent.com/wangxiaohong123/p-bed/main/uPic/flutter%E6%9E%B6%E6%9E%84%E5%9B%BE.png"></p>
<p>Flutter架构分为三层：</p>
<ol>
<li>Embedder ：操作系统适配层，实现了渲染 Surface 设置，线程设置，以及平台插件等平台相关特性的适配。Flutter 平台相关特性并不多，这就使得从框架层面保持跨端一致性的成本相对较低。</li>
<li>Engine ：引擎层，主要包含 Skia、Dart 和 Text，实现了 Flutter 的渲染引擎、文字排版、事件处理和 Dart 运行时等功能。Skia 和 Text 为上层接口提供了调用底层渲染和排版的能力，Dart 则为 Flutter 提供了运行时调用 Dart 和渲染引擎的能力。而 Engine 层的作用，则是将它们组合起来，从它们生成的数据中实现视图渲染。</li>
<li>Framework ：一个用 Dart 实现的 UI SDK，包含了动画、图形绘制和手势识别等功能。为了在绘制控件等固定样式的图形时提供更直观、更方便的接口，Flutter 还基于这些基础能力，根据 Material 和 Cupertino 两种视觉设计风格封装了一套 UI 组件库。我们在开发 Flutter 的时候，可以直接使用这些组件库。<strong>其中Material是基于Google 的 Material Design 设计的组件库，Cupertino是基于Apple 的 iOS 设计规范设计的组件库</strong>。</li>
</ol>
<h4 id="11-渲染">1.1 渲染<a hidden class="anchor" aria-hidden="true" href="#11-渲染">#</a></h4>
<p>渲染氛围4个阶段：布局、绘制、合成、渲染。Flutter中的元素以树的形式存在，采用深度优先的方式进行布局和绘制，然后进行一次合成，将所有涂层根据 大小、层级、透明度等规则计算出最终的显示效果，这么做是为了简化渲染树，提高渲染效率，合并完成之后交给SKia加工成二维的图像数据，最后交给GPU渲染。</p>
<h3 id="2-线程模型">2 线程模型<a hidden class="anchor" aria-hidden="true" href="#2-线程模型">#</a></h3>
<p><img alt="Flutter线程模型" loading="lazy" src="https://raw.githubusercontent.com/wangxiaohong123/p-bed/main/uPic/Flutter%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B.png"></p>
<p>Dart是单线程的，但Flutter是多线程的，在Flutter中Dart的代码都运行在UI线程上，Dart的单线程模型中涉及到2个任务队列，微任务队列和事件队列，微任务队列的优先级比事件队列要高。所以微任务队列用来处理短小、优先级高的任务，flutter的回调、async的内部调度等；事件队列用来处理定时器、网络请求、用户输入、UI等任务。因为UI线程是主线程，是所有任务的入口，不过一些请求虽然会进到事件任务队列，但是UI线程会根据语法判断出这些任务不是自己处理的。</p>
<p>当出现不是UI线程处理的任务时会调用引擎API，让引擎判断应该是哪个线程处理后通过消息发送到对应线程的Task Runner，其他线程处理完任务也会通过引擎发送到UI线程的Task Runner，之后会将任务的处理结果封装成回调重新入队。</p>
<h3 id="3-widget">3 Widget<a hidden class="anchor" aria-hidden="true" href="#3-widget">#</a></h3>
<p>**Widget不可变设计：**为了简化开发，并发修改时是线程不安全的。</p>
<p>Flutter中Widget是数据映射，也是功能的抽象描述，也是试图的配置信息，他是组建实现的基本逻辑单位，一切皆是Widget。</p>
<p>大部分UI框架都会将试图数据封装成树结构，在将这些数据提供给渲染引擎，Flutter视图树进行了扩展，分成了Widget、Element和RenderObject三层。</p>
<ol>
<li>Widget：存储了视图渲染的配置，包括布局、属性、事件响应等。分为无状态（StatelessWidget）和有状态（StateFulWidget），有状态的Widget可以通过改变Widget的状态出发重布局（<code>state.setState</code>）达到改变Widget属性的效果。重布局就是找到状态改变的Widget进行rebuild操作(调用widget里的build方法)，所以有状态和无状态的Widget的区别就是能否自重建。以数据驱动UI构建的方式简单高效，但是这样会涉及到大量对象的销毁和重建，性能和垃圾回收都会受影响，不过<strong>Widget不涉及实际渲染位图(屏幕上的像素)，只是轻量级的数据重构，所以重建造成的内存成本很低，至于重新渲染的成本是由其他组件优化的</strong>。</li>
<li>Element：是Widget的一个实例化对象，也是Widget到RenderObject的中间态，渲染时先通过Widget树构建Element树，然后创建对应的RenderObject关联到Element.RenderObject属性上，最后构建成RenderObject树。**为什么要增加一层Element？**因为Widget是不可变的，Element是可变的，Widget重构时Element通过diff算法比较Widget的变化，判断需不需要重新渲染，将变化同步到RenderObject中，降低性能损耗。</li>
<li>RenderObject：完成渲染的布局、绘制阶段，将绘制完的RenderObject树交给SKia进行合成和渲染阶段。</li>
</ol>
<h4 id="31-widget状态的选择">3.1 Widget状态的选择<a hidden class="anchor" aria-hidden="true" href="#31-widget状态的选择">#</a></h4>
<p>Flutter中Widget采用深度优先的方式构建，也就是自顶向下，由父到子，那就可以理解为**符Widget如果可以通过初始化的参数完全控制子Widget的展示效果，子Widget就可以使用StatelessWidget。**比如弹窗，每次弹窗初始化Widget的时候只需要将样式和提示信息传给弹窗Widget即可。</p>
<p>即使StatefulWidget可以替代StatelessWidget也不能完全使用StatefulWidget，会影响渲染性能。</p>
<h3 id="4-生命周期">4 生命周期<a hidden class="anchor" aria-hidden="true" href="#4-生命周期">#</a></h3>
<h4 id="41-有状态widget的生命周期">4.1 有状态Widget的生命周期<a hidden class="anchor" aria-hidden="true" href="#41-有状态widget的生命周期">#</a></h4>
<p>有状态的Widget也就是StatefulWidget的子类中都会有一个继承State的内部类，State中实现的build方法以及监听元素变化。</p>
<p>State的生命周期可以分为3个阶段：初始化、更新和销毁；</p>
<h5 id="411-初始化">4.1.1 初始化<a hidden class="anchor" aria-hidden="true" href="#411-初始化">#</a></h5>
<p>初始化时会依次执行 ：构造方法 -&gt; initState -&gt; didChangeDependencies -&gt; build，随后完成页面渲染。</p>
<ul>
<li>构造方法中可以接受父Widget传递的UI配置，Flutter也会在构造方法中调用StatefulWidget.createState() 来创建一个 State。</li>
<li>initState() 会在State对象被插入试图树的时候调用，这个函数在整个生命周期只会被调用1次，一些状态的默认值是在这一步设置的。</li>
<li>didChangeDependencies()用来专门处理State对象依赖关系变化，initState()结束后被Flutter调用。</li>
<li>build()作用是构建视图，我们需要在这个函数中，根据父 Widget 传递过来的初始化配置数据，以及 State 的当前状态，创建一个 Widget 然后返回。</li>
</ul>
<h5 id="412-更新">4.1.2 更新<a hidden class="anchor" aria-hidden="true" href="#412-更新">#</a></h5>
<p>Widget 的状态更新，主要由 3 个方法触发：setState、didchangeDependencies 和 didUpdateWidget。</p>
<ul>
<li>setState()：最常用的方法，当状态数据发生变化时，通过调用这个方法告诉Flutter使用更新后的数据重建UI。</li>
<li>didchangeDependencies()：State对象的依赖关系发生变化后，Flutter会调用这个方法，出发组件构建。比如系统语言或者主题发生改变时系统会通知 State 执行 didChangeDependencies 回调方法。</li>
<li>didUpdateWidget()：当 Widget 的配置发生变化时，比如，父 Widget 触发重建（即父 Widget 的状态发生变化时），热重载时，系统会调用这个函数。</li>
</ul>
<h5 id="413-销毁">4.1.3 销毁<a hidden class="anchor" aria-hidden="true" href="#413-销毁">#</a></h5>
<p>组件被移除或者页面销毁的时候，系统会调用 deactivate 和 dispose 这两个方法，来移除或销毁组件。</p>
<ul>
<li>deactivate()：组件的可见状态发生变化，包括页面切换会调用这个方法。</li>
<li>dispose()：永久移除时调用，可以在这里进行最终的资源释放、移除监听、清理环境，等等。</li>
</ul>
<h4 id="42-app的生命周期">4.2 App的生命周期<a hidden class="anchor" aria-hidden="true" href="#42-app的生命周期">#</a></h4>
<p>App的生命周期类似于从后台进入前台、从前台退到后台，或是在 UI 绘制完成。原生中通过重写 Activity、ViewController 生命周期回调方法，或是注册应用程序的相关通知。Flutter中使用WidgetsBindingObserver实现。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">abstract</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">WidgetsBindingObserver</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// 页面pop
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  Futrue<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">bool</span><span style="color:#ff79c6">&gt;</span> didPopRoute() <span style="color:#ff79c6">=&gt;</span> Futrue<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">bool</span><span style="color:#ff79c6">&gt;</span>.value(<span style="color:#ff79c6">false</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// 页面push
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  Futrue<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">bool</span><span style="color:#ff79c6">&gt;</span> didPushRoute(<span style="color:#8be9fd">String</span> route) <span style="color:#ff79c6">=&gt;</span> Futrue<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">bool</span><span style="color:#ff79c6">&gt;</span>.value(<span style="color:#ff79c6">false</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// 系统窗口相关改变回调，如旋转
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">void</span> didChangeMetrics() { }
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// 文本缩放系数变化
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">void</span> didChangeTextScaleFactor() { }
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// 系统亮度变化
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">void</span> didChangePlatformBrightness() { }
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// 本地化语言变化
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">void</span> didChangeLocales(List<span style="color:#ff79c6">&lt;</span>Locale<span style="color:#ff79c6">&gt;</span> locale) { }
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// App生命周期变化
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">void</span> didChangeAppLifecycleState(AppLifecycleState state) { }
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// 内存警告回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">void</span> didHaveMemoryPressure() { }
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// Accessibility相关特性回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">void</span> didChangeAccessibilityFeatrues() {}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="421-didchangeapplifecyclestate">4.2.1 didChangeAppLifecycleState<a hidden class="anchor" aria-hidden="true" href="#421-didchangeapplifecyclestate">#</a></h5>
<p>didChangeAppLifecycleState 回调函数中，有一个参数类型为 AppLifecycleState 的枚举类，这个枚举类是 Flutter 对 App 生命周期状态的封装。它的常用状态包括 resumed、inactive、paused 这三个。</p>
<ul>
<li>resumed：可见的，并能响应用户的输入。</li>
<li>inactive：处在不活动状态，无法处理用户响应。</li>
<li>paused：不可见并不能响应用户的输入，但是在后台继续活动中。</li>
</ul>
<p>从后台切入前台，控制台打印的 App 生命周期变化如下: AppLifecycleState.paused-&gt;AppLifecycleState.inactive-&gt;AppLifecycleState.resumed；从前台退回后台，控制台打印的 App 生命周期变化则变成了：AppLifecycleState.resumed-&gt;AppLifecycleState.inactive-&gt;AppLifecycleState.paused。</p>
<h3 id="5-经典控件">5 经典控件<a hidden class="anchor" aria-hidden="true" href="#5-经典控件">#</a></h3>
<h4 id="51-文本">5.1 文本<a hidden class="anchor" aria-hidden="true" href="#51-文本">#</a></h4>
<p>单一样式文本：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>Text(
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;文本是视图系统中的常见控件，用来显示一段特定样式的字符串，就比如Android里的TextView，或是iOS中的UILabel。&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">textAlign:</span> TextAlign.center,<span style="color:#6272a4">// 居中显示
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">style:</span> TextStyle(<span style="color:#8be9fd;font-style:italic">fontWeight:</span> FontWeight.bold, <span style="color:#8be9fd;font-style:italic">fontSize:</span> <span style="color:#bd93f9">20</span>, <span style="color:#8be9fd;font-style:italic">color:</span> Colors.red),<span style="color:#6272a4">// 20号红色粗体展示
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>混合样式文本：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>TextStyle blackStyle <span style="color:#ff79c6">=</span> TextStyle(<span style="color:#8be9fd;font-style:italic">fontWeight:</span> FontWeight.normal, <span style="color:#8be9fd;font-style:italic">fontSize:</span> <span style="color:#bd93f9">20</span>, <span style="color:#8be9fd;font-style:italic">color:</span> Colors.black); <span style="color:#6272a4">// 黑色样式
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>TextStyle redStyle <span style="color:#ff79c6">=</span> TextStyle(<span style="color:#8be9fd;font-style:italic">fontWeight:</span> FontWeight.bold, <span style="color:#8be9fd;font-style:italic">fontSize:</span> <span style="color:#bd93f9">20</span>, <span style="color:#8be9fd;font-style:italic">color:</span> Colors.red); <span style="color:#6272a4">// 红色样式
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>Text.rich(
</span></span><span style="display:flex;"><span>    TextSpan(
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>TextSpan<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>          TextSpan(<span style="color:#8be9fd;font-style:italic">text:</span><span style="color:#f1fa8c">&#39;文本是视图系统中常见的控件，它用来显示一段特定样式的字符串，类似&#39;</span>, <span style="color:#8be9fd;font-style:italic">style:</span> redStyle), <span style="color:#6272a4">// 第1个片段，红色样式 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          TextSpan(<span style="color:#8be9fd;font-style:italic">text:</span><span style="color:#f1fa8c">&#39;Android&#39;</span>, <span style="color:#8be9fd;font-style:italic">style:</span> blackStyle), <span style="color:#6272a4">// 第1个片段，黑色样式 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          TextSpan(<span style="color:#8be9fd;font-style:italic">text:</span><span style="color:#f1fa8c">&#39;中的&#39;</span>, <span style="color:#8be9fd;font-style:italic">style:</span>redStyle), <span style="color:#6272a4">// 第1个片段，红色样式 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          TextSpan(<span style="color:#8be9fd;font-style:italic">text:</span><span style="color:#f1fa8c">&#39;TextView&#39;</span>, <span style="color:#8be9fd;font-style:italic">style:</span> blackStyle) <span style="color:#6272a4">// 第1个片段，黑色样式 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        ]),
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">textAlign:</span> TextAlign.center,
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="52-图片">5.2 图片<a hidden class="anchor" aria-hidden="true" href="#52-图片">#</a></h4>
<ul>
<li>加载本地资源图片，如 Image.asset(‘images/logo.png’)；</li>
<li>加载本地（File 文件）图片，如 Image.file(new File(’/storage/xxx/xxx/test.jpg’))；</li>
<li>加载网络图片，如 Image.network('http://xxx/xxx/test.gif') 。</li>
</ul>
<p>FadeInImage 控件比Flutter自带的Image多了很多功能，比如占位图、加载动画等：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>FadeInImage.assetNetwork(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">placeholder:</span> <span style="color:#f1fa8c">&#39;assets/loading.gif&#39;</span>, <span style="color:#6272a4">// gif占位
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">image:</span> <span style="color:#f1fa8c">&#39;https://xxx/xxx/xxx.jpg&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">fit:</span> BoxFit.cover, <span style="color:#6272a4">// 图片拉伸模式
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">200</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">200</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>图片的加载是异步的，由ImageProvider 触发。首先，ImageProvider 根据 _ImageState 中传递的图片配置生成对应的图片缓存 key；然后，去 ImageCache 中查找是否有对应的图片缓存，如果有，则通知 _ImageState 刷新 UI；如果没有，则启动 ImageStream 开始异步加载，加载完毕后，更新缓存；最后，通知 _ImageState 刷新 UI。</p>
<p>ImageCache使用LRU淘汰策略，保留最近做多使用的1000张图片，最大缓存时100MB，这种方式的缓存只在运行期间作用在内存中，如果想要支持缓存到文件系统，可以使用第三方的<strong>CachedNetworkImage</strong>控件。</p>
<h4 id="53-按钮">5.3 按钮<a hidden class="anchor" aria-hidden="true" href="#53-按钮">#</a></h4>
<p>Flutter 提供了三个基本的按钮控件： FloatingActionButton、FlatButton 和 RaisedButton。</p>
<ul>
<li>FloatingActionButton：圆形按钮，用来处理界面中最常用、最基础的操作。</li>
<li>FlatButton：凸起的按钮，带灰色背景，点击后背景加深。</li>
<li>RaisedButton：扁平的按钮，透明背景，点击后变灰色背景。</li>
</ul>
<p>按钮有2个重要参数：</p>
<ul>
<li>onPressed 参数用于设置点击回调，告诉 Flutter 在按钮被点击时通知我们。如果 onPressed 参数为空，则按钮会处于禁用状态，不响应用户点击。</li>
<li>child 参数用于设置按钮的内容，告诉 Flutter 控件应该长成什么样，也就是控制着按钮控件的基本样式。child 可以接收任意的 Widget，比如我们在上面的例子中传入的 Text，除此之外我们还可以传入 Image 等控件。</li>
</ul>
<h4 id="54-列表">5.4 列表<a hidden class="anchor" aria-hidden="true" href="#54-列表">#</a></h4>
<h5 id="541listview">5.4.1ListView<a hidden class="anchor" aria-hidden="true" href="#541listview">#</a></h5>
<p>ListView可以沿一个方向排列所有子Widget，常用于各种列表。</p>
<p>ListView默认的构造函数可以通过设置Children将所有子Widget包含到ListView中，但是这种一次性将列表创建好的方式影响性能，可以用这种方式实现少量元素的ListView：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>ListView(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//设置ListTile组件的标题与图标 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    ListTile(<span style="color:#8be9fd;font-style:italic">leading:</span> Icon(Icons.map),  <span style="color:#8be9fd;font-style:italic">title:</span> Text(<span style="color:#f1fa8c">&#39;Map&#39;</span>)),
</span></span><span style="display:flex;"><span>    ListTile(<span style="color:#8be9fd;font-style:italic">leading:</span> Icon(Icons.mail), <span style="color:#8be9fd;font-style:italic">title:</span> Text(<span style="color:#f1fa8c">&#39;Mail&#39;</span>)),
</span></span><span style="display:flex;"><span>    ListTile(<span style="color:#8be9fd;font-style:italic">leading:</span> Icon(Icons.message), <span style="color:#8be9fd;font-style:italic">title:</span> Text(<span style="color:#f1fa8c">&#39;Message&#39;</span>)),
</span></span><span style="display:flex;"><span>  ]);
</span></span></code></pre></td></tr></table>
</div>
</div><p>另一个构造函数ListView.builder和ListView.separated适用于Widget比较多的场景，这个构造函数有2个关键参数：</p>
<ul>
<li>itemBuilder，是列表项的创建方法。当列表滚动到相应位置时，ListView 会调用该方法创建对应的子 Widget。</li>
<li>itemCount，表示列表项的数量，如果为空，则表示 ListView 为无限列表。</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>ListView.builder(
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">itemCount:</span> <span style="color:#bd93f9">100</span>, <span style="color:#6272a4">//元素个数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">itemExtent:</span> <span style="color:#bd93f9">50.0</span>, <span style="color:#6272a4">//列表项高度
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">itemBuilder:</span> (BuildContext context, <span style="color:#8be9fd">int</span> index) <span style="color:#ff79c6">=&gt;</span> ListTile(<span style="color:#8be9fd;font-style:italic">title:</span> Text(<span style="color:#f1fa8c">&#34;title </span><span style="color:#f1fa8c">$</span>index<span style="color:#f1fa8c">&#34;</span>), <span style="color:#8be9fd;font-style:italic">subtitle:</span> Text(<span style="color:#f1fa8c">&#34;body </span><span style="color:#f1fa8c">$</span>index<span style="color:#f1fa8c">&#34;</span>))
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>ListView.separated比ListView.builder多了一个分割线的参数：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#6272a4">// 使用ListView.separated设置分割线
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>ListView.separated(
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">itemCount:</span> <span style="color:#bd93f9">100</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">separatorBuilder:</span> (BuildContext context, <span style="color:#8be9fd">int</span> index) <span style="color:#ff79c6">=&gt;</span> index <span style="color:#ff79c6">%</span><span style="color:#bd93f9">2</span> <span style="color:#ff79c6">==</span><span style="color:#bd93f9">0</span><span style="color:#ff79c6">?</span> Divider(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.green) <span style="color:#ff79c6">:</span> Divider(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.red),<span style="color:#6272a4">// index为偶数，创建绿色分割线；index为奇数，则创建红色分割线
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">itemBuilder:</span> (BuildContext context, <span style="color:#8be9fd">int</span> index) <span style="color:#ff79c6">=&gt;</span> ListTile(<span style="color:#8be9fd;font-style:italic">title:</span> Text(<span style="color:#f1fa8c">&#34;title </span><span style="color:#f1fa8c">$</span>index<span style="color:#f1fa8c">&#34;</span>), <span style="color:#8be9fd;font-style:italic">subtitle:</span> Text(<span style="color:#f1fa8c">&#34;body </span><span style="color:#f1fa8c">$</span>index<span style="color:#f1fa8c">&#34;</span>))<span style="color:#6272a4">// 创建子Widget
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="542-customscrollview">5.4.2 CustomScrollView<a hidden class="anchor" aria-hidden="true" href="#542-customscrollview">#</a></h5>
<p>对于一些功能比如效果联动、视图跟随手势、精细滑动等，就需要使用CustomScrollView来自定义滚动效果。在CustomScrollView中，彼此独立、可滚动的Widget统称为Sliver。</p>
<p>比如要实现一个滚动视差效果：让多层背景以不同速度移动，形成立体滚动效果。具体需求：一个有封面头图的列表，用户滚动列表时头图根据手势进行缩小或者展开。实现这个需求需要2个Sliver，头图的SliverAppBar，作为列表的SliverList：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>CustomScrollView(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">slivers:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>    SliverAppBar(<span style="color:#6272a4">// SliverAppBar作为头图控件
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">title:</span> Text(<span style="color:#f1fa8c">&#39;CustomScrollView Demo&#39;</span>),<span style="color:#6272a4">// 标题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">floating:</span> <span style="color:#ff79c6">true</span>,<span style="color:#6272a4">// 设置悬浮样式
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">flexibleSpace:</span> Image.network(<span style="color:#f1fa8c">&#34;https://xx.jpg&#34;</span>,<span style="color:#8be9fd;font-style:italic">fit:</span>BoxFit.cover),<span style="color:#6272a4">// 设置悬浮头图背景
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">expandedHeight:</span> <span style="color:#bd93f9">300</span>,<span style="color:#6272a4">// 头图控件高度
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    ),
</span></span><span style="display:flex;"><span>    SliverList(<span style="color:#6272a4">// SliverList作为列表控件
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">delegate:</span> SliverChildBuilderDelegate(
</span></span><span style="display:flex;"><span>            (context, index) <span style="color:#ff79c6">=&gt;</span> ListTile(<span style="color:#8be9fd;font-style:italic">title:</span> Text(<span style="color:#f1fa8c">&#39;Item #</span><span style="color:#f1fa8c">$</span>index<span style="color:#f1fa8c">&#39;</span>)),<span style="color:#6272a4">// 列表项创建方法
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#8be9fd;font-style:italic">childCount:</span> <span style="color:#bd93f9">100</span>,<span style="color:#6272a4">// 列表元素个数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      ),
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>  ]);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-布局">6 布局<a hidden class="anchor" aria-hidden="true" href="#6-布局">#</a></h3>
<p>Flutter提供了31种布局Widget，包括单子Widget、多子Widget、层叠Widget。</p>
<h4 id="61-常用的单子widget">6.1 常用的单子Widget<a hidden class="anchor" aria-hidden="true" href="#61-常用的单子widget">#</a></h4>
<p>单子Widget就是说只有一个儿子，但是可以有很多孙子。</p>
<h5 id="611-container">6.1.1 Container<a hidden class="anchor" aria-hidden="true" href="#611-container">#</a></h5>
<p>Container可以作为单独的控件，比如设置背景颜色、宽高，也可以作为其他空间的父级：定义子Widget如何摆放，不过他只能包含一个子Widget。如果用Container设置多个子Widget的布局需要先用一个根Widget包装所有子Widget，然后把根Widget放到Container中，由Container设置对齐(alignment)、边距(padding)等基础属性。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>Container(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">child:</span> Text(<span style="color:#f1fa8c">&#39;Container（容器）在UI框架中是一个很常见的概念，Flutter也不例外。&#39;</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">padding:</span> EdgeInsets.all(<span style="color:#bd93f9">18.0</span>), <span style="color:#6272a4">// 内边距
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">margin:</span> EdgeInsets.all(<span style="color:#bd93f9">44.0</span>), <span style="color:#6272a4">// 外边距
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">180.0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">height:</span><span style="color:#bd93f9">240</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">alignment:</span> Alignment.center, <span style="color:#6272a4">// 子Widget居中对齐
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">decoration:</span> BoxDecoration( <span style="color:#6272a4">//Container样式
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">color:</span> Colors.red, <span style="color:#6272a4">// 背景色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">borderRadius:</span> BorderRadius.circular(<span style="color:#bd93f9">10.0</span>), <span style="color:#6272a4">// 圆角边框
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  ),
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="612-padding">6.1.2 Padding<a hidden class="anchor" aria-hidden="true" href="#612-padding">#</a></h5>
<p>如果子Widget只需要设定边距可以使用</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>Padding(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">padding:</span> EdgeInsets.all(<span style="color:#bd93f9">44.0</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">child:</span> Text(<span style="color:#f1fa8c">&#39;Container（容器）在UI框架中是一个很常见的概念，Flutter也不例外。&#39;</span>),
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="613-center">6.1.3 Center<a hidden class="anchor" aria-hidden="true" href="#613-center">#</a></h5>
<p>讲子Widget居中排列</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>Scaffold(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">body:</span> Center(<span style="color:#8be9fd;font-style:italic">child:</span> Text(<span style="color:#f1fa8c">&#34;Hello&#34;</span>)) <span style="color:#6272a4">// This trailing comma makes auto-formatting nicer for build methods.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>一般Center会和Container一起使用</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>Container(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">child:</span> Center(<span style="color:#8be9fd;font-style:italic">child:</span> Text(<span style="color:#f1fa8c">&#39;Container（容器）在UI框架中是一个很常见的概念，Flutter也不例外。&#39;</span>)),
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">padding:</span> EdgeInsets.all(<span style="color:#bd93f9">18.0</span>), <span style="color:#6272a4">// 内边距
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">margin:</span> EdgeInsets.all(<span style="color:#bd93f9">44.0</span>), <span style="color:#6272a4">// 外边距
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">180.0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">height:</span><span style="color:#bd93f9">240</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">decoration:</span> BoxDecoration( <span style="color:#6272a4">//Container样式
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">color:</span> Colors.red, <span style="color:#6272a4">// 背景色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">borderRadius:</span> BorderRadius.circular(<span style="color:#bd93f9">10.0</span>), <span style="color:#6272a4">// 圆角边框
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  ),
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="62-常用的多子widget">6.2 常用的多子Widget<a hidden class="anchor" aria-hidden="true" href="#62-常用的多子widget">#</a></h4>
<p>多子Widget的布局就是2种规则的抽象：水平方向如何布局、垂直方向如何布局。</p>
<p>和前端的Flex一样，Flutter也有将子Widget按水平排列的Row和垂直排列的Column，以及负责这些子Widget在布局方向中剩余空间的Expanded。</p>
<p>Row和Column的使用就是将子Widget按序加入到children即可：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#6272a4">// Row的用法示范
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Row(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.yellow, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">60</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">80</span>,),
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.red, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">100</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">180</span>,),
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.black, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">60</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">80</span>,),
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.green, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">60</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">80</span>,),
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Column的用法示范
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Column(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.yellow, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">60</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">80</span>,),
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.red, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">100</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">180</span>,),
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.black, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">60</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">80</span>,),
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.green, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">60</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">80</span>,),
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面的Row和Column都不能占满屏幕，如果想要设置黄色和绿色均分剩下的空间，可以使用Expanded之后不指定宽度，再将弹性系数参数flex设置成1即可</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>Row(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>    Expanded(<span style="color:#8be9fd;font-style:italic">flex:</span> <span style="color:#bd93f9">1</span>, <span style="color:#8be9fd;font-style:italic">child:</span> Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.yellow, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">60</span>)), <span style="color:#6272a4">// 设置了flex=1，因此宽度由Expanded来分配
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.red, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">100</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">180</span>,),
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.black, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">60</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">80</span>,),
</span></span><span style="display:flex;"><span>    Expanded(<span style="color:#8be9fd;font-style:italic">flex:</span> <span style="color:#bd93f9">1</span>, <span style="color:#8be9fd;font-style:italic">child:</span> Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.green,<span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">60</span>),)<span style="color:#6272a4">// 设置了flex=1，因此宽度由Expanded来分配
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  ],
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>对于Row和Column，Flutter提供了根据坐标轴的对齐方式，Row和Column的主轴、纵轴划分：</p>
<p><img alt="flutter主轴、纵轴" loading="lazy" src="https://raw.githubusercontent.com/wangxiaohong123/p-bed/main/uPic/flutter%E4%B8%BB%E8%BD%B4%E3%80%81%E7%BA%B5%E8%BD%B4.png"></p>
<p>根据主轴与纵轴，设置子 Widget 在这两个方向上的对齐规则 mainAxisAlignment 与 crossAxisAlignment。比如，主轴方向 start 表示靠左对齐、center 表示横向居中对齐、end 表示靠右对齐、spaceEvenly 表示按固定间距对齐；而纵轴方向 start 则表示靠上对齐、center 表示纵向居中对齐、end 表示靠下对齐，Row中主轴和纵轴的对齐效果：</p>
<p><img src="https://raw.githubusercontent.com/wangxiaohong123/p-bed/main/uPic/flutter-row对齐.png" alt="flutter-row对齐" style="zoom:67%;" /><img src="https://raw.githubusercontent.com/wangxiaohong123/p-bed/main/uPic/flutter-row纵轴.png" alt="flutter-row纵轴" style="zoom: 67%;" /></p>
<p>对于主轴而言，Flutter默认让父容器决定长度，即主轴方向的长度尽可能大；如果设置了<code>mainAxisSize: MainAxisSize.min</code>，主轴的宽度或者高度就由所有子Widget决定，即主轴方向的长度尽可能小。如果设置了<code>mainAxisSize: MainAxisSize.min</code>，Row的宽度和子Widget一样，因此设置助手的对齐方式就不起作用了。</p>
<h4 id="63-常用的层叠widget布局">6.3 常用的层叠Widget布局<a hidden class="anchor" aria-hidden="true" href="#63-常用的层叠widget布局">#</a></h4>
<p>当需要让一个空间叠加到另一个控件的上面，比如图片上防文字，图片上加按钮。这个时候可以使用层叠容器Stack。</p>
<p>Stack提供了容器，Positioned提供设置Widget位置的能力：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>Stack(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>    Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.yellow, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">300</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">300</span>),<span style="color:#6272a4">// 黄色容器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    Positioned(
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">left:</span> <span style="color:#bd93f9">18.0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">top:</span> <span style="color:#bd93f9">18.0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">child:</span> Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.green, <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">50</span>, <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">50</span>),<span style="color:#6272a4">// 叠加在黄色容器之上的绿色控件
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    ),
</span></span><span style="display:flex;"><span>    Positioned(
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">left:</span> <span style="color:#bd93f9">18.0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">top:</span><span style="color:#bd93f9">70.0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">child:</span> Text(<span style="color:#f1fa8c">&#34;Stack提供了层叠布局的容器&#34;</span>),<span style="color:#6272a4">// 叠加在黄色容器之上的文本
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    )
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Positioned只能在Stack中使用</strong>。</p>
<h4 id="64-组合与自绘">6.4 组合与自绘<a hidden class="anchor" aria-hidden="true" href="#64-组合与自绘">#</a></h4>
<p>组合与自绘是用来自定义Widget的，使用基本Widget组装成一个高级的Widget。</p>
<p>组合：使用基础Widget布局摆放基础Widget，在控件内部设置基础Widget样式。这种方式对外暴露的接口比较少，减少上层使用成本，增强控件复用性。</p>
<p>自绘：对于现有Widget无法实现的视图，比如k线图，这个时候需要手动绘制。手动绘制使用CustomPaint，他是一个承接自绘控件的容器，容器中使用画布Canvas与画笔Paint绘制。</p>
<h3 id="7-主题">7 主题<a hidden class="anchor" aria-hidden="true" href="#7-主题">#</a></h3>
<p>主题一般由颜色、图片、字体、字号组成。视觉效果是易变的，将变化的部分抽离出来，把提供不同视觉效果的资源和配置按照主题进行归类，整合到统一的中间层进行管理，这样就能实现主题的管理和切换了。</p>
<p>在iOS中，主题的配置是预先写到plist文件中，通过单例控制app使用哪种配置，Android的配置则写入各个style属性值的xml中，通过activity的setTheme切换，前端也可以通过更换css实现多套主题；Flutter使用<strong>ThemeData</strong>统一管理主题的配置信息。</p>
<h4 id="71-全局统一的视觉风格">7.1 全局统一的视觉风格<a hidden class="anchor" aria-hidden="true" href="#71-全局统一的视觉风格">#</a></h4>
<p>MaterialApp 的初始化方法提供了设置主题的能力：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>MaterialApp(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">title:</span> <span style="color:#f1fa8c">&#39;Flutter Demo&#39;</span>,<span style="color:#6272a4">//标题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">theme:</span> ThemeData(<span style="color:#6272a4">//设置主题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">brightness:</span> Brightness.dark,<span style="color:#6272a4">//设置明暗模式为暗色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">accentColor:</span> Colors.black,<span style="color:#6272a4">//(按钮）Widget前景色为黑色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">primaryColor:</span> Colors.cyan,<span style="color:#6272a4">//主色调为青色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">iconTheme:</span>IconThemeData(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.yellow),<span style="color:#6272a4">//设置icon主题色为黄色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">textTheme:</span> TextTheme(<span style="color:#8be9fd;font-style:italic">body1:</span> TextStyle(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.red))<span style="color:#6272a4">//设置文本颜色为红色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  ),
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">home:</span> MyHomePage(<span style="color:#8be9fd;font-style:italic">title:</span> <span style="color:#f1fa8c">&#39;Flutter Demo Home Page&#39;</span>),
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="72-局部独立的视觉风格">7.2 局部独立的视觉风格<a hidden class="anchor" aria-hidden="true" href="#72-局部独立的视觉风格">#</a></h4>
<p>为某个页面或者某个区块设置不同的风格样式，比如选择不同主题时的预览窗口，可以使用Theme控件，他是一个单子Widget容器，在Theme中可以选择使用Theme.of继承app的主题+copyWith更新部分样式；或者使用ThemeData创建新主题。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#6272a4">// 新建主题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Theme(
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">data:</span> ThemeData(<span style="color:#8be9fd;font-style:italic">iconTheme:</span> IconThemeData(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.red)),
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">child:</span> Icon(Icons.favorite)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 继承主题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Theme(
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">data:</span> Theme.of(context).copyWith(<span style="color:#8be9fd;font-style:italic">iconTheme:</span> IconThemeData(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.green)),
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">child:</span> Icon(Icons.feedback)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>不同场景使用不同主题：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#6272a4">// iOS浅色主题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">final</span> ThemeData kIOSTheme <span style="color:#ff79c6">=</span> ThemeData(
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">brightness:</span> Brightness.light,<span style="color:#6272a4">// 亮色主题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">accentColor:</span> Colors.white,<span style="color:#6272a4">// (按钮)Widget前景色为白色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">primaryColor:</span> Colors.blue,<span style="color:#6272a4">// 主题色为蓝色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">iconTheme:</span>IconThemeData(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.grey),<span style="color:#6272a4">// icon主题为灰色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">textTheme:</span> TextTheme(<span style="color:#8be9fd;font-style:italic">body1:</span> TextStyle(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.black))<span style="color:#6272a4">// 文本主题为黑色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>);
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Android深色主题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">final</span> ThemeData kAndroidTheme <span style="color:#ff79c6">=</span> ThemeData(
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">brightness:</span> Brightness.dark,<span style="color:#6272a4">// 深色主题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">accentColor:</span> Colors.black,<span style="color:#6272a4">// (按钮)Widget前景色为黑色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">primaryColor:</span> Colors.cyan,<span style="color:#6272a4">// 主题色Wie青色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">iconTheme:</span>IconThemeData(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.blue),<span style="color:#6272a4">// icon主题色为蓝色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">textTheme:</span> TextTheme(<span style="color:#8be9fd;font-style:italic">body1:</span> TextStyle(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.red))<span style="color:#6272a4">// 文本主题色为红色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>);
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 应用初始化
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>MaterialApp(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">title:</span> <span style="color:#f1fa8c">&#39;Flutter Demo&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">theme:</span> defaultTargetPlatform <span style="color:#ff79c6">==</span> TargetPlatform.iOS <span style="color:#ff79c6">?</span> kIOSTheme <span style="color:#ff79c6">:</span> kAndroidTheme,<span style="color:#6272a4">// 根据平台选择不同主题
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">home:</span> MyHomePage(<span style="color:#8be9fd;font-style:italic">title:</span> <span style="color:#f1fa8c">&#39;Flutter Demo Home Page&#39;</span>),
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="8-依赖管理">8 依赖管理<a hidden class="anchor" aria-hidden="true" href="#8-依赖管理">#</a></h3>
<h4 id="81-app内资源">8.1 App内资源<a hidden class="anchor" aria-hidden="true" href="#81-app内资源">#</a></h4>
<p>图片、字符串、字体配置文件等叫做资源，代码与资源分离时现代UI框架的主流设计理念，这样可以对特定设备提供更准确的兼容性。</p>
<p>在iOS中图片和其他原始资源是区分开的，在Flutter里，assets可以放任意类型的文件：图片、JSON、字体等。对于资源的存放位置，Flutter没有像Android那样预先定义资源的目录结构，我们可以把资源放到任意目录下，<strong>只需要根据pubspec.yaml对资源所在位置进行显示生命就可以</strong>。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">flutter</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">assets</span>:
</span></span><span style="display:flex;"><span>    - assets/background.jpg   <span style="color:#6272a4"># 挨个指定资源路径</span>
</span></span><span style="display:flex;"><span>    - assets/loading.gif  <span style="color:#6272a4"># 挨个指定资源路径</span>
</span></span><span style="display:flex;"><span>    - assets/result.json  <span style="color:#6272a4"># 挨个指定资源路径</span>
</span></span><span style="display:flex;"><span>    - assets/icons/    <span style="color:#6272a4"># 子目录批量指定</span>
</span></span><span style="display:flex;"><span>    - assets/ <span style="color:#6272a4"># 根目录也是可以批量指定的</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>目录的批量指定不会递归，如果目录下还有子目录的话需要单独指定。</p>
<p>Flutter中图片可以使用<code>Image.asset</code>加载，其他资源通过Flutter的猪资源Bundle对象rootBundle直接访问。字符串资源使用<code>rootBundle.loadString</code>，二进制文件使用<code>rootBundle.load</code>方法。</p>
<p>Flutter也遵循了基于像素密度的管理方式，如1.0x，2.0x，3.0x，根据当前设备分辨率加载最接近设备像素比例的图片资源，想让Flutter适配不同分辨率需要将其他分辨率放到对应的分辨率子目录中，声明时仅声明1.0x的图片资源即可：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#6272a4"># 目录结构</span>
</span></span><span style="display:flex;"><span>assets
</span></span><span style="display:flex;"><span>├── background.jpg    //1.0x图
</span></span><span style="display:flex;"><span>├── 2.0x
</span></span><span style="display:flex;"><span>│   └── background.jpg  //2.0x图
</span></span><span style="display:flex;"><span>└── 3.0x
</span></span><span style="display:flex;"><span>    └── background.jpg  //3.0x图
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 声明</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">flutter</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">assets</span>:
</span></span><span style="display:flex;"><span>    - assets/background.jpg   <span style="color:#6272a4"># 1.0x图资源</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>更换App图标、启动页都需要在原生中操作</strong>。</p>
<h4 id="82-三方依赖">8.2 三方依赖<a hidden class="anchor" aria-hidden="true" href="#82-三方依赖">#</a></h4>
<p>pubspec.yaml 更为重要的作用是管理 Flutter 工程代码的依赖，比如第三方库、Dart运行环境、Flutter版本等。</p>
<p>Dart提供了包管理工具Pub，和Maven、npm类似。和pubspec.yaml类似的还有.packages和pubspec.lock，.packages是表示包在本地目录缓存的地址，pubspec.lock是把依赖锁死的文件，.packages不需要版本管理，这是个人环境，pubspec.lock需要做版本管理，统一工程环境。</p>
<h3 id="9-交互">9 交互<a hidden class="anchor" aria-hidden="true" href="#9-交互">#</a></h3>
<h4 id="91-用户交互">9.1 用户交互<a hidden class="anchor" aria-hidden="true" href="#91-用户交互">#</a></h4>
<h5 id="911-指针事件">9.1.1 指针事件<a hidden class="anchor" aria-hidden="true" href="#911-指针事件">#</a></h5>
<p>指针事件表示用户交互的原始触摸数据，比如手指接触屏幕 PointerDownEvent、手指在屏幕上移动 PointerMoveEvent、手指抬起 PointerUpEvent，以及触摸取消 PointerCancelEvent等。当手指触摸屏幕，触摸事件发起时，Flutter咸确定手指与屏幕接触的位置上有哪些组件，将事件交给最内层的组件，从最内层开始向根节点分发事件。</p>
<p>Flutter中通过Listener Widget监听子Widget的指针事件：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>Listener(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">child:</span> Container(
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">color:</span> Colors.red,<span style="color:#6272a4">// 背景色红色
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">300</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">300</span>,
</span></span><span style="display:flex;"><span>  ),
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">onPointerDown:</span> (event) <span style="color:#ff79c6">=&gt;</span> print(<span style="color:#f1fa8c">&#34;down </span><span style="color:#f1fa8c">$</span>event<span style="color:#f1fa8c">&#34;</span>),<span style="color:#6272a4">// 手势按下回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">onPointerMove:</span>  (event) <span style="color:#ff79c6">=&gt;</span> print(<span style="color:#f1fa8c">&#34;move </span><span style="color:#f1fa8c">$</span>event<span style="color:#f1fa8c">&#34;</span>),<span style="color:#6272a4">// 手势移动回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">onPointerUp:</span>  (event) <span style="color:#ff79c6">=&gt;</span> print(<span style="color:#f1fa8c">&#34;up </span><span style="color:#f1fa8c">$</span>event<span style="color:#f1fa8c">&#34;</span>),<span style="color:#6272a4">// 手势抬起回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="912-手势识别">9.1.2 手势识别<a hidden class="anchor" aria-hidden="true" href="#912-手势识别">#</a></h5>
<p>指针事件比较原始，复杂功能很难处理，比如点击 onTap、双击 onDoubleTap、长按 onLongPress、拖拽 onPanUpdate、缩放 onScaleUpdate 等。响应用户交互使用的是Gestrue，Gestrue 可以支持同时分发多个手势交互行为，就是可以同时监听多个事件。</p>
<p>Gestrue是手势语义的抽象，如果想要在Widget中实现监听需要使用GestrueDetector：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#6272a4">// 红色container坐标
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd">double</span> _top <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0.0</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">double</span> _left <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0.0</span>;
</span></span><span style="display:flex;"><span>Stack(<span style="color:#6272a4">// 使用Stack组件去叠加视图，便于直接控制视图坐标
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>    Positioned(
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">top:</span> _top,
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">left:</span> _left,
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">child:</span> GestrueDetector(<span style="color:#6272a4">// 手势识别
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#8be9fd;font-style:italic">child:</span> Container(<span style="color:#8be9fd;font-style:italic">color:</span> Colors.red,<span style="color:#8be9fd;font-style:italic">width:</span> <span style="color:#bd93f9">50</span>,<span style="color:#8be9fd;font-style:italic">height:</span> <span style="color:#bd93f9">50</span>),<span style="color:#6272a4">// 红色子视图
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#8be9fd;font-style:italic">onTap:</span> ()<span style="color:#ff79c6">=&gt;</span>print(<span style="color:#f1fa8c">&#34;Tap&#34;</span>),<span style="color:#6272a4">// 点击回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#8be9fd;font-style:italic">onDoubleTap:</span> ()<span style="color:#ff79c6">=&gt;</span>print(<span style="color:#f1fa8c">&#34;Double Tap&#34;</span>),<span style="color:#6272a4">// 双击回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#8be9fd;font-style:italic">onLongPress:</span> ()<span style="color:#ff79c6">=&gt;</span>print(<span style="color:#f1fa8c">&#34;Long Press&#34;</span>),<span style="color:#6272a4">// 长按回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#8be9fd;font-style:italic">onPanUpdate:</span> (e) {<span style="color:#6272a4">// 拖动回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          setState(() {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 更新位置
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            _left <span style="color:#ff79c6">+=</span> e.delta.dx;
</span></span><span style="display:flex;"><span>            _top <span style="color:#ff79c6">+=</span> e.delta.dy;
</span></span><span style="display:flex;"><span>          });
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      ),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>对于同时监听多个手势事件的情况，Flutter引入了手势竞技场的概念，手势竞技场根据触摸屏幕时长、位移、方向等决定有本次处理权的手势，就是说**虽然监听多个手势，但是只有一个手势会收到回调。**可以通过自定义手势识别器实现多事件响应。</p>
<h4 id="92-组件交互">9.2 组件交互<a hidden class="anchor" aria-hidden="true" href="#92-组件交互">#</a></h4>
<p>组件的数据可以通过组件内变量获取，但是如果组件的层级很深每级都保存一份数据是浪费而且麻烦的。所以，对于数据的跨层传递，Flutter 还提供了三种方案：InheritedWidget、Notification 和 EventBus。</p>
<h5 id="921-inheritedwidget">9.2.1 InheritedWidget<a hidden class="anchor" aria-hidden="true" href="#921-inheritedwidget">#</a></h5>
<p>Theme就是通过InheritedWidget实现的，使用InheritedWidget时需要自定义一个字类，然后字类提供of方法方便其他Widget在组件树中使用，最后重写updateShouldNotify方法，这个方法会在Flutter判断InheritedWidget需要重建时通知下层观察者组更新数据的：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">CountContainer</span> <span style="color:#8be9fd;font-style:italic">extends</span> InheritedWidget {
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">//方便其子Widget在Widget树中找到它
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">static</span> CountContainer of(BuildContext context) <span style="color:#ff79c6">=&gt;</span> context.inheritFromWidgetOfExactType(CountContainer) <span style="color:#ff79c6">as</span> CountContainer;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> count;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  CountContainer({
</span></span><span style="display:flex;"><span>    Key key,
</span></span><span style="display:flex;"><span>    @<span style="color:#8be9fd;font-style:italic">required</span> <span style="color:#ff79c6">this</span>.count,
</span></span><span style="display:flex;"><span>    @<span style="color:#8be9fd;font-style:italic">required</span> Widget child,
</span></span><span style="display:flex;"><span>  })<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">super</span>(<span style="color:#8be9fd;font-style:italic">key:</span> key, <span style="color:#8be9fd;font-style:italic">child:</span> child);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// 判断是否需要更新
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  @override
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">bool</span> updateShouldNotify(CountContainer oldWidget) <span style="color:#ff79c6">=&gt;</span> count <span style="color:#ff79c6">!=</span> oldWidget.count;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 使用
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_MyHomePageState</span> <span style="color:#8be9fd;font-style:italic">extends</span> State<span style="color:#ff79c6">&lt;</span>MyHomePage<span style="color:#ff79c6">&gt;</span> {
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">//将CountContainer作为根节点，并使用0作为初始化count
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">return</span> CountContainer(
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">count:</span> <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">child:</span> Counter()
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Counter</span> <span style="color:#8be9fd;font-style:italic">extends</span> StatelessWidget {
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//获取InheritedWidget节点
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    CountContainer state <span style="color:#ff79c6">=</span> CountContainer.of(context);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Scaffold(
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">appBar:</span> AppBar(<span style="color:#8be9fd;font-style:italic">title:</span> Text(<span style="color:#f1fa8c">&#34;InheritedWidget demo&#34;</span>)),
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">body:</span> Text(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#39;You have pushed the button this many times: </span><span style="color:#f1fa8c">${</span>state.count<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;</span>,
</span></span><span style="display:flex;"><span>      ),
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="922-notification">9.2.2 Notification<a hidden class="anchor" aria-hidden="true" href="#922-notification">#</a></h5>
<p>Notification做子组件向上传递数据，比如子Widget状态变更，通知上报。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">CustomNotification</span> <span style="color:#8be9fd;font-style:italic">extends</span> Notification {
</span></span><span style="display:flex;"><span>  CustomNotification(<span style="color:#ff79c6">this</span>.msg);
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">String</span> msg;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//抽离出一个子Widget用来发通知
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">CustomChild</span> <span style="color:#8be9fd;font-style:italic">extends</span> StatelessWidget {
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> RaisedButton(
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">//按钮点击时分发通知
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">onPressed:</span> () <span style="color:#ff79c6">=&gt;</span> CustomNotification(<span style="color:#f1fa8c">&#34;Hi&#34;</span>).dispatch(context),
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">child:</span> Text(<span style="color:#f1fa8c">&#34;Fire Notification&#34;</span>),
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>父Widget中监听这个通知做操作即可</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_MyHomePageState</span> <span style="color:#8be9fd;font-style:italic">extends</span> State<span style="color:#ff79c6">&lt;</span>MyHomePage<span style="color:#ff79c6">&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">String</span> _msg <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;通知：&#34;</span>;
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//监听通知
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">return</span> NotificationListener<span style="color:#ff79c6">&lt;</span>CustomNotification<span style="color:#ff79c6">&gt;</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">onNotification:</span> (notification) {
</span></span><span style="display:flex;"><span>          setState(() {_msg <span style="color:#ff79c6">+=</span> notification.msg<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34;  &#34;</span>;});<span style="color:#6272a4">//收到子Widget通知，更新msg
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">child:</span>Column(
</span></span><span style="display:flex;"><span>          <span style="color:#8be9fd;font-style:italic">mainAxisAlignment:</span> MainAxisAlignment.center,
</span></span><span style="display:flex;"><span>          <span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[Text(_msg),CustomChild()],<span style="color:#6272a4">//将子Widget加入到视图树中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        )
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="923-eventbus">9.2.3 EventBus<a hidden class="anchor" aria-hidden="true" href="#923-eventbus">#</a></h5>
<p>适用于任何关系的Widget通信，遵循发布/订阅模式，需要依赖三方插件：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">dependencies:</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">event_bus:</span> <span style="color:#bd93f9">1.1</span>.<span style="color:#bd93f9">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#6272a4">// 自定义事件类
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">CustomEvent</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">String</span> msg;
</span></span><span style="display:flex;"><span>  CustomEvent(<span style="color:#ff79c6">this</span>.msg);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 建立公共的event bus
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>EventBus eventBus <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> EventBus();
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 第一个页面
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_FirstScreenState</span> <span style="color:#8be9fd;font-style:italic">extends</span>  State<span style="color:#ff79c6">&lt;</span>FirstScreen<span style="color:#ff79c6">&gt;</span>  {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">String</span> msg <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;通知：&#34;</span>;
</span></span><span style="display:flex;"><span>  StreamSubscription subscription;
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  initState() {
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">// 监听CustomEvent事件，刷新UI
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    subscription <span style="color:#ff79c6">=</span> eventBus.on<span style="color:#ff79c6">&lt;</span>CustomEvent<span style="color:#ff79c6">&gt;</span>().listen((event) {
</span></span><span style="display:flex;"><span>      setState(() {msg<span style="color:#ff79c6">+=</span> event.msg;});<span style="color:#6272a4">// 更新msg
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">super</span>.initState();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  dispose() {
</span></span><span style="display:flex;"><span>    subscription.cancel();<span style="color:#6272a4">// State销毁时，清理注册
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">super</span>.dispose();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> Scaffold(
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">body:</span>Text(msg),
</span></span><span style="display:flex;"><span>      ...
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="93-页面交互">9.3 页面交互<a hidden class="anchor" aria-hidden="true" href="#93-页面交互">#</a></h4>
<p>Flutter中页面之间的跳转使用Route和Navigator管理。</p>
<ul>
<li>Route是页面的抽象，负责创建页面，接收参数，响应Navigator打开或关闭；</li>
<li>Navigator维护一个路由栈管理Route，Route打开就是入栈，关闭就是出栈，还可以替换栈内的Route。</li>
</ul>
<p>Flutter中路由管理有2种方式，基本路由和命名路由</p>
<h5 id="931-基本路由">9.3.1 基本路由<a hidden class="anchor" aria-hidden="true" href="#931-基本路由">#</a></h5>
<p>导航到一个新的页面需要创建一个MaterialPageRoute实例，调用Navigator.push方法将页面压倒栈的顶部。MaterialPageRoute是一种路由模板，定义过渡动画等相关配置，可以针对不同平台，实现与平台页面切换动画风格一致的路由切换动画。</p>
<p>返回上一个页面需要调用Navigator.pop方法从栈中删除这个页面。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">FirstScreen</span> <span style="color:#8be9fd;font-style:italic">extends</span> StatelessWidget {
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> RaisedButton(
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">//打开页面
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">onPressed:</span> ()<span style="color:#ff79c6">=&gt;</span> Navigator.push(context, MaterialPageRoute(<span style="color:#8be9fd;font-style:italic">builder:</span> (context) <span style="color:#ff79c6">=&gt;</span> SecondScreen()));
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">SecondPage</span> <span style="color:#8be9fd;font-style:italic">extends</span> StatelessWidget {
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> RaisedButton(
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">// 回退页面
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">onPressed:</span> ()<span style="color:#ff79c6">=&gt;</span> Navigator.pop(context)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="932-命名路由">9.3.2 命名路由<a hidden class="anchor" aria-hidden="true" href="#932-命名路由">#</a></h5>
<p>维护一个路由表，配置别名和页面的映射：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>MaterialApp(
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 注册路由
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">routes:</span>{
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;second_page&#34;</span><span style="color:#ff79c6">:</span>(context)<span style="color:#ff79c6">=&gt;</span>SecondPage(),
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//错误路由处理，统一返回UnknownPage 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">onUnknownRoute:</span> (RouteSettings setting) <span style="color:#ff79c6">=&gt;</span> MaterialPageRoute(<span style="color:#8be9fd;font-style:italic">builder:</span> (context) <span style="color:#ff79c6">=&gt;</span> UnknownPage()),
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 使用名字打开页面
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Navigator.pushNamed(context,<span style="color:#f1fa8c">&#34;second_page&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面的onUnknownRoute用来处理不存在的路由标识的报错。</p>
<h5 id="933-路由参数">9.3.3 路由参数<a hidden class="anchor" aria-hidden="true" href="#933-路由参数">#</a></h5>
<p>当需要打开路由传递参数时，使用RouteSettings获取：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#6272a4">// 打开页面时传递字符串参数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Navigator.of(context).pushNamed(<span style="color:#f1fa8c">&#34;second_page&#34;</span>, <span style="color:#8be9fd;font-style:italic">arguments:</span> <span style="color:#f1fa8c">&#34;Hey&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">SecondPage</span> <span style="color:#8be9fd;font-style:italic">extends</span> StatelessWidget {
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 取出路由参数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd">String</span> msg <span style="color:#ff79c6">=</span> ModalRoute.of(context).settings.arguments <span style="color:#ff79c6">as</span> <span style="color:#8be9fd">String</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Text(msg);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>有时关闭页面也需要传递参数到上一个页面，比如打开某一个页面需要登录，上一个页面需要登录成功或者关闭作出处理：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">SecondPage</span> <span style="color:#8be9fd;font-style:italic">extends</span> StatelessWidget {
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Scaffold(
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">body:</span> Column(
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>          Text(<span style="color:#f1fa8c">&#39;Message from first screen: </span><span style="color:#f1fa8c">$</span>msg<span style="color:#f1fa8c">&#39;</span>),
</span></span><span style="display:flex;"><span>          RaisedButton(
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">child:</span> Text(<span style="color:#f1fa8c">&#39;back&#39;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//页面关闭时传递参数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#8be9fd;font-style:italic">onPressed:</span> ()<span style="color:#ff79c6">=&gt;</span> Navigator.pop(context,<span style="color:#f1fa8c">&#34;Hi&#34;</span>)
</span></span><span style="display:flex;"><span>          )
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      ));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_FirstPageState</span> <span style="color:#8be9fd;font-style:italic">extends</span> State<span style="color:#ff79c6">&lt;</span>FirstPage<span style="color:#ff79c6">&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">String</span> _msg<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>  @override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> Scaffold(
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">body:</span> Column(<span style="color:#8be9fd;font-style:italic">children:</span> <span style="color:#ff79c6">&lt;</span>Widget<span style="color:#ff79c6">&gt;</span>[
</span></span><span style="display:flex;"><span>        RaisedButton(
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">child:</span> Text(<span style="color:#f1fa8c">&#39;命名路由（参数&amp;回调）&#39;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//打开页面，并监听页面关闭时传递的参数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#8be9fd;font-style:italic">onPressed:</span> ()<span style="color:#ff79c6">=&gt;</span> Navigator.pushNamed(context, <span style="color:#f1fa8c">&#34;third_page&#34;</span>,<span style="color:#8be9fd;font-style:italic">arguments:</span> <span style="color:#f1fa8c">&#34;Hey&#34;</span>).then((msg)<span style="color:#ff79c6">=&gt;</span>setState(()<span style="color:#ff79c6">=&gt;</span>_msg<span style="color:#ff79c6">=</span>msg)),
</span></span><span style="display:flex;"><span>        ),
</span></span><span style="display:flex;"><span>        Text(<span style="color:#f1fa8c">&#39;Message from Second screen: </span><span style="color:#f1fa8c">$</span>_msg<span style="color:#f1fa8c">&#39;</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      ],),
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/flutter/">Flutter</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E5%BA%93/es/3.%E5%85%A5%E9%97%A8/">
    <span class="title">« Prev</span>
    <br>
    <span>3.es-入门</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/nio/netty/3.%E5%A4%84%E7%90%86%E6%B6%88%E6%81%AF%E6%BA%90%E7%A0%81/">
    <span class="title">Next »</span>
    <br>
    <span>3.netty-处理消息源码</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 3.Flutter基础 on x"
            href="https://x.com/intent/tweet/?text=3.Flutter%e5%9f%ba%e7%a1%80&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fflutter%2f3.flutter%25E5%259F%25BA%25E7%25A1%2580%2f&amp;hashtags=flutter">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 3.Flutter基础 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fflutter%2f3.flutter%25E5%259F%25BA%25E7%25A1%2580%2f&amp;title=3.Flutter%e5%9f%ba%e7%a1%80&amp;summary=3.Flutter%e5%9f%ba%e7%a1%80&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fflutter%2f3.flutter%25E5%259F%25BA%25E7%25A1%2580%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 3.Flutter基础 on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fflutter%2f3.flutter%25E5%259F%25BA%25E7%25A1%2580%2f&title=3.Flutter%e5%9f%ba%e7%a1%80">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 3.Flutter基础 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fflutter%2f3.flutter%25E5%259F%25BA%25E7%25A1%2580%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 3.Flutter基础 on whatsapp"
            href="https://api.whatsapp.com/send?text=3.Flutter%e5%9f%ba%e7%a1%80%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fflutter%2f3.flutter%25E5%259F%25BA%25E7%25A1%2580%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 3.Flutter基础 on telegram"
            href="https://telegram.me/share/url?text=3.Flutter%e5%9f%ba%e7%a1%80&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fflutter%2f3.flutter%25E5%259F%25BA%25E7%25A1%2580%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 3.Flutter基础 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=3.Flutter%e5%9f%ba%e7%a1%80&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fflutter%2f3.flutter%25E5%259F%25BA%25E7%25A1%2580%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">王小红的笔记</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
