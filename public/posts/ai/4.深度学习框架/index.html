<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>4.tensorFlow | 王小红的笔记</title>
<meta name="keywords" content="深度学习">
<meta name="description" content="PyTorch和TensorFlow是深度学习框架，但它们也具备科学计算库的特性。
Tensorflow
TensorFlow是谷歌的深度学习框架，可以用在计算机视觉、音频处理、推荐系统、自然语言处理等场景。向下支持做的很烂，现在用的少。
一、安装
mac(m1/m2)安装：


1
2
3
4
5
6


# 如果提示Could not find a version that satisfies the requirement tensorflow-macos (from versions: none)升级pip
python3 -m pip install --upgrade pip

pip3 install tensorflow-macos
# 苹果为支持 M1/M2 芯片上的图形加速，提供的插件
pip3 install tensorflow-metal


其他版本安装：


1
2
3
4


# CPU版本
pip3 install tensorflow
# GPU版本
pip3 install tensorflow-gpu


验证安装结果：">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/ai/4.%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css" integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/ai/4.%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="/katex/katex.min.css">
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false},
        {left: "\\(", right: "\\)", display: false},
        {left: "\\[", right: "\\]", display: true}
      ]
    });
  });
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="王小红的笔记 (Alt + H)">王小红的笔记</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="笔记">
                    <span>笔记</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      4.tensorFlow
    </h1>
    <div class="post-meta">10 min

</div>
  </header> 
  <div class="post-content"><p>PyTorch和TensorFlow是深度学习框架，但它们也具备科学计算库的特性。</p>
<h4 id="tensorflow">Tensorflow<a hidden class="anchor" aria-hidden="true" href="#tensorflow">#</a></h4>
<p>TensorFlow是谷歌的深度学习框架，可以用在计算机视觉、音频处理、推荐系统、自然语言处理等场景。向下支持做的很烂，<strong>现在用的少。</strong></p>
<h5 id="一安装">一、安装<a hidden class="anchor" aria-hidden="true" href="#一安装">#</a></h5>
<p>mac(m1/m2)安装：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#6272a4"># 如果提示Could not find a version that satisfies the requirement tensorflow-macos (from versions: none)升级pip</span>
</span></span><span style="display:flex;"><span>python3 -m pip install --upgrade pip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pip3 install tensorflow-macos
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 苹果为支持 M1/M2 芯片上的图形加速，提供的插件</span>
</span></span><span style="display:flex;"><span>pip3 install tensorflow-metal
</span></span></code></pre></td></tr></table>
</div>
</div><p>其他版本安装：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#6272a4"># CPU版本</span>
</span></span><span style="display:flex;"><span>pip3 install tensorflow
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># GPU版本</span>
</span></span><span style="display:flex;"><span>pip3 install tensorflow-gpu
</span></span></code></pre></td></tr></table>
</div>
</div><p>验证安装结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> tensorflow <span style="color:#ff79c6">as</span> tf
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(tf<span style="color:#ff79c6">.</span>__version__)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="二基础">二、基础<a hidden class="anchor" aria-hidden="true" href="#二基础">#</a></h5>
<h6 id="1-张量tensor">1. 张量（Tensor）<a hidden class="anchor" aria-hidden="true" href="#1-张量tensor">#</a></h6>
<p>张量就是多维数组，他和numpy可以相互转换:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> tensorflow <span style="color:#ff79c6">as</span> tf
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 创建int32类型的0维张量，就是被封装到tensor对象里的常量</span>
</span></span><span style="display:flex;"><span>rank_0_tensor <span style="color:#ff79c6">=</span> tf<span style="color:#ff79c6">.</span>constant(<span style="color:#bd93f9">4</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(rank_0_tensor)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 创建1维张量</span>
</span></span><span style="display:flex;"><span>rank_1_tensor <span style="color:#ff79c6">=</span> tf<span style="color:#ff79c6">.</span>constant([<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">4</span>])
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(rank_1_tensor)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 转换成numpy数组</span>
</span></span><span style="display:flex;"><span>np1 <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>array(rank_1_tensor)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(np1)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 转换成numpy数组</span>
</span></span><span style="display:flex;"><span>np2 <span style="color:#ff79c6">=</span> rank_1_tensor<span style="color:#ff79c6">.</span>numpy()
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(np2)
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="2-常用函数">2. 常用函数<a hidden class="anchor" aria-hidden="true" href="#2-常用函数">#</a></h6>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> tensorflow <span style="color:#ff79c6">as</span> tf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#ff79c6">=</span> tf<span style="color:#ff79c6">.</span>constant([[<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>], [<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">4</span>]])
</span></span><span style="display:flex;"><span>b <span style="color:#ff79c6">=</span> tf<span style="color:#ff79c6">.</span>constant([[<span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">6</span>], [<span style="color:#bd93f9">7</span>, <span style="color:#bd93f9">8</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#张量加法</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(tf<span style="color:#ff79c6">.</span>add(a, b))
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 张量乘法</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(tf<span style="color:#ff79c6">.</span>multiply(a, b))
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 矩阵相乘</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(tf<span style="color:#ff79c6">.</span>matmul(a, b))
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 求和</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(tf<span style="color:#ff79c6">.</span>reduce_sum(a))
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 平均值</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(tf<span style="color:#ff79c6">.</span>reduce_mean(a))
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 最大值</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(tf<span style="color:#ff79c6">.</span>reduce_max(a))
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 最大索引</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(tf<span style="color:#ff79c6">.</span>argmax(a))
</span></span></code></pre></td></tr></table>
</div>
</div><p>维度和长度不可变的张量叫变量，声明方式不同：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>tf<span style="color:#ff79c6">.</span>Variable([[<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>], [<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">4</span>]])
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="3-常见激活函数">3. 常见激活函数<a hidden class="anchor" aria-hidden="true" href="#3-常见激活函数">#</a></h6>
<ul>
<li>Sigmoid/logistics：输入小于0时值趋近于0，输入大于0时值趋近于1，当输入很大或者很小的时候由于很熟的斜率非常小，会出现<strong>梯度消失</strong>现象(5个隐藏层内就会出现)，所以使用不多，一般用于二分类。</li>
<li>tanh(双曲正切曲线)：他和Sigmoid不同的是中心点，Sigmoid输入0时输出0.5，tanh输入0时输出0。所以他也会有<strong>梯度消失</strong>现象。</li>
<li>RELU：他的表达式就是max(0, x)，它的优点就是速度快，没有<strong>梯度消失</strong>现象。他是部分线性函数。</li>
<li>LeakRelu：relu函数有神经元死亡的问题，LeakRelu的表达式是max(0.1x, x)，这样输出0的数量会小很多，减少神经元死亡次数。</li>
<li>SoftMax：用在多分类过程中的输出层，输出每种分类的概率。</li>
</ul>
<p>参数</p>
<p>参数分两个，权重和偏置。偏置的初始化可以设置成0，权重的初始化：</p>
<ul>
<li>随机初始化：从正态分布中随机取值；</li>
<li>标准初始化：从均匀分布中随机取值，$\dfrac {-1}{\sqrt d}到\dfrac {1}{\sqrt d}$中随机取，d是输入参数的数量；</li>
<li>Xavier/Glorot初始化：思想是激活值和状态值梯度的方差在传播过程中保持一致。也是从正态分布或者均匀分布中随机取样，只不过标准差由输入和输出神经元个数决定；</li>
<li>He初始化：何恺明提出的。他和Xavier的区别是正向传播时激活值的方差保持不变，反向传播时状态值的梯度方差保持不变。</li>
</ul>
<h6 id="4-模型构建方式">4. 模型构建方式<a hidden class="anchor" aria-hidden="true" href="#4-模型构建方式">#</a></h6>
<p>Sequential：可以构建简单的序列模型：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> tensorflow.keras <span style="color:#ff79c6">import</span> Sequential
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> tensorflow.keras.layers <span style="color:#ff79c6">import</span> Dense, Input
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model <span style="color:#ff79c6">=</span> Sequential([
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 定义输入形状，旧版本是Dense的input_shape属性</span>
</span></span><span style="display:flex;"><span>    Input(shape<span style="color:#ff79c6">=</span>(<span style="color:#bd93f9">4</span>,)),
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 隐藏层1</span>
</span></span><span style="display:flex;"><span>    Dense(<span style="color:#bd93f9">10</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;relu&#34;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 隐藏层2</span>
</span></span><span style="display:flex;"><span>    Dense(<span style="color:#bd93f9">10</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;relu&#34;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 输出层</span>
</span></span><span style="display:flex;"><span>    Dense(<span style="color:#bd93f9">3</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;softmax&#34;</span>)
</span></span><span style="display:flex;"><span>])
</span></span></code></pre></td></tr></table>
</div>
</div><p>function API构建：将层作为可调用对象并返回张量，可以构建复杂的序列模型</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> tensorflow.keras <span style="color:#ff79c6">import</span> Model
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> tensorflow.keras.layers <span style="color:#ff79c6">import</span> Dense, Input
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inputs <span style="color:#ff79c6">=</span> Input(shape<span style="color:#ff79c6">=</span>(<span style="color:#bd93f9">4</span>,), name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;input&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 隐藏层1</span>
</span></span><span style="display:flex;"><span>x <span style="color:#ff79c6">=</span> Dense(<span style="color:#bd93f9">10</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;relu&#34;</span>, name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;layer1&#34;</span>)(inputs)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 隐藏层2</span>
</span></span><span style="display:flex;"><span>x <span style="color:#ff79c6">=</span> Dense(<span style="color:#bd93f9">10</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;relu&#34;</span>, name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;layer2&#34;</span>)(x)
</span></span><span style="display:flex;"><span>outputs <span style="color:#ff79c6">=</span> Dense(<span style="color:#bd93f9">3</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;softmax&#34;</span>, name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;output&#34;</span>)(x)
</span></span><span style="display:flex;"><span>model <span style="color:#ff79c6">=</span> Model(inputs<span style="color:#ff79c6">=</span>inputs, outputs<span style="color:#ff79c6">=</span>outputs, name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;functional_model&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Model子类方式：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> tensorflow.keras <span style="color:#ff79c6">import</span> Model
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> tensorflow.keras.layers <span style="color:#ff79c6">import</span> Dense
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">MyModel</span>(Model):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">__init__</span>(<span style="font-style:italic">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">super</span>(MyModel, <span style="font-style:italic">self</span>)<span style="color:#ff79c6">.</span><span style="color:#50fa7b">__init__</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 隐藏层1</span>
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>layer1 <span style="color:#ff79c6">=</span> Dense(<span style="color:#bd93f9">10</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;relu&#34;</span>, name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;layer1&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 隐藏层2</span>
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>layer2 <span style="color:#ff79c6">=</span> Dense(<span style="color:#bd93f9">10</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;relu&#34;</span>, name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;layer2&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 输出层</span>
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>layer3 <span style="color:#ff79c6">=</span> Dense(<span style="color:#bd93f9">3</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;softmax&#34;</span>, name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;output&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">call</span>(<span style="font-style:italic">self</span>, inputs):
</span></span><span style="display:flex;"><span>        x <span style="color:#ff79c6">=</span> <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>layer1(inputs)
</span></span><span style="display:flex;"><span>        x <span style="color:#ff79c6">=</span> <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>layer2(x)
</span></span><span style="display:flex;"><span>        output <span style="color:#ff79c6">=</span> <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>layer3(x)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>model <span style="color:#ff79c6">=</span> MyModel()
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="5-keras">5. keras<a hidden class="anchor" aria-hidden="true" href="#5-keras">#</a></h6>
<p>用来训练、测试和生成模型。包含模块：</p>
<table>
  <thead>
      <tr>
          <th>名称</th>
          <th>功能</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>activation</td>
          <td>激活函数，没有激活函数神经网络只能处理线性问题</td>
      </tr>
      <tr>
          <td>application</td>
          <td>包含许多预训练模型，可以用来做基础网络或者特征提取</td>
      </tr>
      <tr>
          <td>callbacks</td>
          <td>训练过程中执行特定任务的回调</td>
      </tr>
      <tr>
          <td>datasets</td>
          <td>提供了几个常用的数据集，供机器学习和深度学习实验使用(大设备或者夸设备训练使用)</td>
      </tr>
      <tr>
          <td>layers</td>
          <td>定义和创建神经网络层</td>
      </tr>
      <tr>
          <td>losses</td>
          <td>提供损失函数</td>
      </tr>
      <tr>
          <td>metrics</td>
          <td>评估模型性能</td>
      </tr>
      <tr>
          <td>models</td>
          <td>创建和训练神经网络模型的类</td>
      </tr>
      <tr>
          <td>optimizers</td>
          <td>优化器，提供优化算法，比如梯度下降</td>
      </tr>
      <tr>
          <td>preprocessing</td>
          <td>数据加载、预处理和增强</td>
      </tr>
      <tr>
          <td>reguarizers</td>
          <td>提供正则化方法，防止过拟合</td>
      </tr>
      <tr>
          <td>utils</td>
          <td>一些数据处理、可视化的工具</td>
      </tr>
  </tbody>
</table>
<h6 id="6-demo">6. demo<a hidden class="anchor" aria-hidden="true" href="#6-demo">#</a></h6>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> seaborn <span style="color:#ff79c6">as</span> sns
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.model_selection <span style="color:#ff79c6">import</span> train_test_split
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.preprocessing <span style="color:#ff79c6">import</span> LabelEncoder
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> tensorflow.keras <span style="color:#ff79c6">import</span> Sequential
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> tensorflow.keras.layers <span style="color:#ff79c6">import</span> Dense, Input
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> tensorflow.keras <span style="color:#ff79c6">import</span> utils
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> ssl
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 如果报SSL验证错误加上下面的代码跳过SSL验证</span>
</span></span><span style="display:flex;"><span>ssl<span style="color:#ff79c6">.</span>_create_default_https_context <span style="color:#ff79c6">=</span> ssl<span style="color:#ff79c6">.</span>_create_unverified_context
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 加载数据</span>
</span></span><span style="display:flex;"><span>iris <span style="color:#ff79c6">=</span> sns<span style="color:#ff79c6">.</span>load_dataset(<span style="color:#f1fa8c">&#34;iris&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 提取特征值和目标值</span>
</span></span><span style="display:flex;"><span>x <span style="color:#ff79c6">=</span> iris<span style="color:#ff79c6">.</span>values[:, :<span style="color:#bd93f9">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 目标值转数字</span>
</span></span><span style="display:flex;"><span>y <span style="color:#ff79c6">=</span> LabelEncoder()<span style="color:#ff79c6">.</span>fit_transform(iris<span style="color:#ff79c6">.</span>values[:, <span style="color:#bd93f9">4</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 数据处理-训练集和测试集划分</span>
</span></span><span style="display:flex;"><span>x_train, x_test, y_train, y_test <span style="color:#ff79c6">=</span> train_test_split(x, y, test_size<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.2</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 数据处理-特征值类型转换</span>
</span></span><span style="display:flex;"><span>x_train <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>array(x_train, dtype<span style="color:#ff79c6">=</span>np<span style="color:#ff79c6">.</span>float32)
</span></span><span style="display:flex;"><span>x_test <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>array(x_test, dtype<span style="color:#ff79c6">=</span>np<span style="color:#ff79c6">.</span>float32)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 数据处理-目标值热编码</span>
</span></span><span style="display:flex;"><span>y_train_ohe <span style="color:#ff79c6">=</span> utils<span style="color:#ff79c6">.</span>to_categorical(y_train, num_classes<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>)
</span></span><span style="display:flex;"><span>y_test_ohe <span style="color:#ff79c6">=</span> utils<span style="color:#ff79c6">.</span>to_categorical(y_test, num_classes<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 构建模型</span>
</span></span><span style="display:flex;"><span>model <span style="color:#ff79c6">=</span> Sequential([
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 定义输入形状，旧版本是Dense的input_shape属性</span>
</span></span><span style="display:flex;"><span>    Input(shape<span style="color:#ff79c6">=</span>(<span style="color:#bd93f9">4</span>,)),
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 隐藏层1</span>
</span></span><span style="display:flex;"><span>    Dense(<span style="color:#bd93f9">10</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;relu&#34;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 隐藏层2</span>
</span></span><span style="display:flex;"><span>    Dense(<span style="color:#bd93f9">10</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;relu&#34;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 输出层</span>
</span></span><span style="display:flex;"><span>    Dense(<span style="color:#bd93f9">3</span>, activation<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;softmax&#34;</span>)
</span></span><span style="display:flex;"><span>])
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 可视化模型</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># utils.plot_model(model, show_shapes=True)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 模型编译</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 优化器:adam;损失函数:categorical_crossentropy(交叉熵);评价指标:accuracy</span>
</span></span><span style="display:flex;"><span>model<span style="color:#ff79c6">.</span>compile(optimizer<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;adam&#34;</span>, loss<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;categorical_crossentropy&#34;</span>, metrics<span style="color:#ff79c6">=</span>[<span style="color:#f1fa8c">&#34;accuracy&#34;</span>])
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 模型训练</span>
</span></span><span style="display:flex;"><span>model<span style="color:#ff79c6">.</span>fit(x_train, y_train_ohe, epochs<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span>, batch_size<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>, verbose<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 模型评估</span>
</span></span><span style="display:flex;"><span>loss, accuracy <span style="color:#ff79c6">=</span> model<span style="color:#ff79c6">.</span>evaluate(x_test, y_test_ohe, verbose<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;准确率是:</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, accuracy)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="pytorch">PyTorch<a hidden class="anchor" aria-hidden="true" href="#pytorch">#</a></h4>
<p>PyTorch的Tensor和NumPy的ndarray在功能和接口上非常相似，但PyTorch并不是基于NumPy实现的。PyTorch对于tensorflow的优势在于调试和复杂网络结构，目前主流的做法是使用PyTorch实现原型，使用Tensorflow进行分布式训练和部署，不过PyTorch的部署上也越来越完善了。20年之后没啥人用tensorflow，除了Google自己的项目。</p>
<p>CPU版本安装：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pip3 install torch torchvision
</span></span></code></pre></td></tr></table>
</div>
</div><p>验证安装结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(torch<span style="color:#ff79c6">.</span>__version__)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 查看GPU是否支持</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(torch<span style="color:#ff79c6">.</span>cuda<span style="color:#ff79c6">.</span>is_available())
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="一基础">一、基础<a hidden class="anchor" aria-hidden="true" href="#一基础">#</a></h5>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 创建一个类型是long的5行3列的全0张量</span>
</span></span><span style="display:flex;"><span>torch<span style="color:#ff79c6">.</span>zeros(<span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">3</span>, dtype<span style="color:#ff79c6">=</span>torch<span style="color:#ff79c6">.</span>long)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 通过数据直接创建张量</span>
</span></span><span style="display:flex;"><span>x <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>tensor([<span style="color:#bd93f9">1.1</span>, <span style="color:#bd93f9">3.5</span>])
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 批量将数组转成张量</span>
</span></span><span style="display:flex;"><span>x_train_test, y_train_test, x_valid_test, y_valid_test <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">map</span>(torch<span style="color:#ff79c6">.</span>tensor, (x_train, y_train, x_valid, y_valid))
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 通过已有张量，创建新张量</span>
</span></span><span style="display:flex;"><span>x <span style="color:#ff79c6">=</span> x<span style="color:#ff79c6">.</span>new_ones(<span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">3</span>, dtype<span style="color:#ff79c6">=</span>torch<span style="color:#ff79c6">.</span>float)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 张量加法</span>
</span></span><span style="display:flex;"><span>res <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>add(x, y)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 张量加法,结果存到y中</span>
</span></span><span style="display:flex;"><span>y<span style="color:#ff79c6">.</span>add_(x)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 改变张量的形状，将5行3列改成3行5列</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 改变形状要保证元素个数一致</span>
</span></span><span style="display:flex;"><span>y <span style="color:#ff79c6">=</span> x<span style="color:#ff79c6">.</span>view(<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">5</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 将张量转成numpy数组</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 转换之后n和x指向同一个内存地址，操作n，x的值也会改变</span>
</span></span><span style="display:flex;"><span>n <span style="color:#ff79c6">=</span> x<span style="color:#ff79c6">.</span>numpy()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 将numpy数组转成torch张量</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 转换之后a和b指向同一个内存地址</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np
</span></span><span style="display:flex;"><span>a <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>ones(<span style="color:#bd93f9">5</span>)
</span></span><span style="display:flex;"><span>b <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>from_numpy(a)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 定义一个GPU设备</span>
</span></span><span style="display:flex;"><span>device <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>device(<span style="color:#f1fa8c">&#39;cuda&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 在GPU上创建一个张量</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 之前的张量默认在CPU上，和g1没法互通</span>
</span></span><span style="display:flex;"><span>g1 <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>ones(<span style="color:#bd93f9">5</span>, device<span style="color:#ff79c6">=</span>device)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 将x转到GPU上</span>
</span></span><span style="display:flex;"><span>x <span style="color:#ff79c6">=</span> x<span style="color:#ff79c6">.</span>to(device)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 将g1转到CPU上</span>
</span></span><span style="display:flex;"><span>g2 <span style="color:#ff79c6">=</span> g1<span style="color:#ff79c6">.</span>to(<span style="color:#f1fa8c">&#39;cpu&#39;</span>, torch<span style="color:#ff79c6">.</span>double)
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="1-autograd">1 autograd<a hidden class="anchor" aria-hidden="true" href="#1-autograd">#</a></h6>
<p>Autograd是PyTorch的自动微分引擎，通过动态计算图，根据链式法则自动追踪和计算每个张量的梯度。因为梯度就是损失函数对每个参数的导数，也就是微分，所以Autograd叫自动微分引擎。核心概念：</p>
<ol>
<li>Tensor： Autograd 追踪计算的核心数据结构，如果一个 Tensor的<code>requires_grad=True</code>，PyTorch将<strong>追踪该张量的所有运算</strong>，以便后续进行梯度计算。</li>
<li>计算图：前向传播时发生张量之间的计算会构建计算图，在调用<code>.backward()</code>时，Autograd 将沿着计算图自动进行梯度计算。</li>
<li>backward()：触发反向传播的核心函数，从目标张量开始，<strong>反向计算所有相关张量的梯度</strong>。</li>
<li>grad_fn属性：每个Tensor都有grad_fn属性，表示当前Tensor是如何得到的，如果Tensor是手动创建的比如<code>torch.rand(5, 3, requires_grad=True)</code>，grad_fn为None，如果Tensor是通过计算得到的，grad_fn将记录计算的操作。</li>
<li>requires_grad_()：动态设置Tensor的requires_grad属性。</li>
</ol>
<h6 id="2-回归任务demo">2 回归任务demo<a hidden class="anchor" aria-hidden="true" href="#2-回归任务demo">#</a></h6>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> pandas <span style="color:#ff79c6">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn <span style="color:#ff79c6">import</span> preprocessing
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 过滤警告</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> warnings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>warnings<span style="color:#ff79c6">.</span>filterwarnings(<span style="color:#f1fa8c">&#34;ignore&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>featrues <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>read_csv(<span style="color:#f1fa8c">&#39;temps.csv&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 将星期几转成独热编码</span>
</span></span><span style="display:flex;"><span>featrues <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>get_dummies(featrues)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 标签</span>
</span></span><span style="display:flex;"><span>labels <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>array(featrues[<span style="color:#f1fa8c">&#39;actual&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 删除特征中的标签</span>
</span></span><span style="display:flex;"><span>featrues <span style="color:#ff79c6">=</span> featrues<span style="color:#ff79c6">.</span>drop(<span style="color:#f1fa8c">&#39;actual&#39;</span>, axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span>featrues_list <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">list</span>(featrues<span style="color:#ff79c6">.</span>columns)
</span></span><span style="display:flex;"><span>featrues <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>array(featrues)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 标准化处理，因为样本数据中有的列数很大(年份)有的列数很小(温度),防止模型在学习的时候把年份当做重要特征需要对数据进行标准化</span>
</span></span><span style="display:flex;"><span>input_featrues <span style="color:#ff79c6">=</span> preprocessing<span style="color:#ff79c6">.</span>StandardScaler()<span style="color:#ff79c6">.</span>fit_transform(featrues)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>input_size <span style="color:#ff79c6">=</span> input_featrues<span style="color:#ff79c6">.</span>shape[<span style="color:#bd93f9">1</span>]
</span></span><span style="display:flex;"><span>hidden_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">128</span>
</span></span><span style="display:flex;"><span>output_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>batch_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">16</span>
</span></span><span style="display:flex;"><span>my_nn <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>nn<span style="color:#ff79c6">.</span>Sequential(
</span></span><span style="display:flex;"><span>    torch<span style="color:#ff79c6">.</span>nn<span style="color:#ff79c6">.</span>Linear(input_size, hidden_size),
</span></span><span style="display:flex;"><span>    torch<span style="color:#ff79c6">.</span>nn<span style="color:#ff79c6">.</span>Sigmoid(),
</span></span><span style="display:flex;"><span>    torch<span style="color:#ff79c6">.</span>nn<span style="color:#ff79c6">.</span>Linear(hidden_size, output_size),
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>cost <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>nn<span style="color:#ff79c6">.</span>MSELoss(reduction<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;mean&#39;</span>)
</span></span><span style="display:flex;"><span>optimizer <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>optim<span style="color:#ff79c6">.</span>Adam(my_nn<span style="color:#ff79c6">.</span>parameters(), lr<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.001</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 损失值</span>
</span></span><span style="display:flex;"><span>losses <span style="color:#ff79c6">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">1000</span>):
</span></span><span style="display:flex;"><span>    batch_loss <span style="color:#ff79c6">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># MINI-Batch方法来进行训练</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> start <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">len</span>(input_featrues), batch_size):
</span></span><span style="display:flex;"><span>        end <span style="color:#ff79c6">=</span> start <span style="color:#ff79c6">+</span> batch_size <span style="color:#ff79c6">if</span> start <span style="color:#ff79c6">+</span> batch_size <span style="color:#ff79c6">&lt;</span> <span style="color:#8be9fd;font-style:italic">len</span>(input_featrues) <span style="color:#ff79c6">else</span> <span style="color:#8be9fd;font-style:italic">len</span>(input_featrues)
</span></span><span style="display:flex;"><span>        x <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>tensor(input_featrues[start:end], dtype<span style="color:#ff79c6">=</span>torch<span style="color:#ff79c6">.</span>float, requires_grad<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span><span style="display:flex;"><span>        y <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>tensor(labels[start:end], dtype<span style="color:#ff79c6">=</span>torch<span style="color:#ff79c6">.</span>float, requires_grad<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span><span style="display:flex;"><span>        prediction <span style="color:#ff79c6">=</span> my_nn(x)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 计算损失</span>
</span></span><span style="display:flex;"><span>        loss <span style="color:#ff79c6">=</span> cost(prediction, y)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 反向传播更新权重</span>
</span></span><span style="display:flex;"><span>        optimizer<span style="color:#ff79c6">.</span>zero_grad()
</span></span><span style="display:flex;"><span>        loss<span style="color:#ff79c6">.</span>backward(retain_graph<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span><span style="display:flex;"><span>        optimizer<span style="color:#ff79c6">.</span>step()
</span></span><span style="display:flex;"><span>        batch_loss<span style="color:#ff79c6">.</span>append(loss<span style="color:#ff79c6">.</span>data<span style="color:#ff79c6">.</span>numpy())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 打印损失</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> i <span style="color:#ff79c6">%</span> <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>:
</span></span><span style="display:flex;"><span>        losses<span style="color:#ff79c6">.</span>append(np<span style="color:#ff79c6">.</span>mean(batch_loss))
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">print</span>(i, np<span style="color:#ff79c6">.</span>mean(batch_loss))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 测试</span>
</span></span><span style="display:flex;"><span>xx <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>tensor(input_featrues, dtype<span style="color:#ff79c6">=</span>torch<span style="color:#ff79c6">.</span>float)
</span></span><span style="display:flex;"><span>predict <span style="color:#ff79c6">=</span> my_nn(xx)<span style="color:#ff79c6">.</span>data<span style="color:#ff79c6">.</span>numpy()
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="3-图像分类demo">3 图像分类demo<a hidden class="anchor" aria-hidden="true" href="#3-图像分类demo">#</a></h6>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch.nn <span style="color:#ff79c6">as</span> nn
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch.optim <span style="color:#ff79c6">as</span> optim
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># transforms数据量少的时候做增强</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># models现成的模型，比如resnet</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># datasets读取数据</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> torchvision <span style="color:#ff79c6">import</span> datasets, transforms, models
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> copy
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> warnings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>warnings<span style="color:#ff79c6">.</span>filterwarnings(<span style="color:#f1fa8c">&#34;ignore&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data_dir <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;./flower_data/&#39;</span>
</span></span><span style="display:flex;"><span>train_dir <span style="color:#ff79c6">=</span> data_dir <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;train&#39;</span>
</span></span><span style="display:flex;"><span>valid_dir <span style="color:#ff79c6">=</span> data_dir <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;valid&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 定义图像预处理操作</span>
</span></span><span style="display:flex;"><span>data_transforms <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;train&#39;</span>: transforms<span style="color:#ff79c6">.</span>Compose([
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 统一图片的尺寸</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>Resize([<span style="color:#bd93f9">128</span>, <span style="color:#bd93f9">128</span>]),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据增强-随机在145到45度间旋转</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>RandomRotation(<span style="color:#bd93f9">45</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据增强-数据增强-随机选择64 * 64的区域裁剪</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>CenterCrop(<span style="color:#bd93f9">64</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据增强-50%概率水平翻转</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>RandomHorizontalFlip(p<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.5</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据增强-50%概率垂直翻转</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>RandomVerticalFlip(p<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.5</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 亮度、对比度、饱和度啥的，不重要</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>ColorJitter(brightness<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.2</span>, contrast<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.1</span>, saturation<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.1</span>, hue<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.1</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 将图片转成标量</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>ToTensor(),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据集比较小的时候均值和标准差不太准，直接大数据集的来用，3个数值对应通道数R-G-B</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>Normalize([<span style="color:#bd93f9">0.485</span>, <span style="color:#bd93f9">0.456</span>, <span style="color:#bd93f9">0.406</span>], [<span style="color:#bd93f9">0.229</span>, <span style="color:#bd93f9">0.224</span>, <span style="color:#bd93f9">0.225</span>])
</span></span><span style="display:flex;"><span>    ]),
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;valid&#39;</span>: transforms<span style="color:#ff79c6">.</span>Compose([
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>Resize([<span style="color:#bd93f9">64</span>, <span style="color:#bd93f9">64</span>]),
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>ToTensor(),
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>Normalize([<span style="color:#bd93f9">0.485</span>, <span style="color:#bd93f9">0.456</span>, <span style="color:#bd93f9">0.406</span>], [<span style="color:#bd93f9">0.229</span>, <span style="color:#bd93f9">0.224</span>, <span style="color:#bd93f9">0.225</span>])
</span></span><span style="display:flex;"><span>    ])
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>batch_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">32</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 指定数据集所在文件夹和与处理操作</span>
</span></span><span style="display:flex;"><span>image_datasets <span style="color:#ff79c6">=</span> {x: datasets<span style="color:#ff79c6">.</span>ImageFolder(os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(data_dir, x), data_transforms[x]) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> [<span style="color:#f1fa8c">&#39;train&#39;</span>, <span style="color:#f1fa8c">&#39;valid&#39;</span>]}
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 指定读取数据操作</span>
</span></span><span style="display:flex;"><span>dataloaders <span style="color:#ff79c6">=</span> {x: torch<span style="color:#ff79c6">.</span>utils<span style="color:#ff79c6">.</span>data<span style="color:#ff79c6">.</span>DataLoader(image_datasets[x], batch_size<span style="color:#ff79c6">=</span>batch_size, shuffle<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span>
</span></span><span style="display:flex;"><span>               [<span style="color:#f1fa8c">&#39;train&#39;</span>, <span style="color:#f1fa8c">&#39;valid&#39;</span>]}
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 下面2个计算准确率使用</span>
</span></span><span style="display:flex;"><span>dataset_sizes <span style="color:#ff79c6">=</span> {x: <span style="color:#8be9fd;font-style:italic">len</span>(image_datasets[x]) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> [<span style="color:#f1fa8c">&#39;train&#39;</span>, <span style="color:#f1fa8c">&#39;valid&#39;</span>]}
</span></span><span style="display:flex;"><span>class_names <span style="color:#ff79c6">=</span> image_datasets[<span style="color:#f1fa8c">&#39;train&#39;</span>]<span style="color:#ff79c6">.</span>classes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 使用resnet训练好的特征</span>
</span></span><span style="display:flex;"><span>featrue_extract <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 是否使用GPU</span>
</span></span><span style="display:flex;"><span>train_on_gpu <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>cuda<span style="color:#ff79c6">.</span>is_available()
</span></span><span style="display:flex;"><span>device <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>device(<span style="color:#f1fa8c">&#34;cuda:0&#34;</span> <span style="color:#ff79c6">if</span> train_on_gpu <span style="color:#ff79c6">else</span> <span style="color:#f1fa8c">&#34;cpu&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 迁移学习-冻结权重参数，一般数据集小的时候会全部冻结</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">set_param_requires_grad</span>(model, featrue_extracting):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> featrue_extracting:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> param <span style="color:#ff79c6">in</span> model<span style="color:#ff79c6">.</span>parameters():
</span></span><span style="display:flex;"><span>            param<span style="color:#ff79c6">.</span>requires_grad <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">initialize_model</span>(num_classes, use_pretrained<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 使用resnet模型,18是层数,条件好的可以选大点的层数</span>
</span></span><span style="display:flex;"><span>    model_ft <span style="color:#ff79c6">=</span> models<span style="color:#ff79c6">.</span>resnet18(pretrained<span style="color:#ff79c6">=</span>use_pretrained)
</span></span><span style="display:flex;"><span>    set_param_requires_grad(model_ft, featrue_extract)
</span></span><span style="display:flex;"><span>    num_ftrs <span style="color:#ff79c6">=</span> model_ft<span style="color:#ff79c6">.</span>fc<span style="color:#ff79c6">.</span>in_featrues
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 输出层的类别数根据自己数据定义</span>
</span></span><span style="display:flex;"><span>    model_ft<span style="color:#ff79c6">.</span>fc <span style="color:#ff79c6">=</span> nn<span style="color:#ff79c6">.</span>Linear(num_ftrs, num_classes)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> model_ft, <span style="color:#bd93f9">128</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model_ft, input_size <span style="color:#ff79c6">=</span> initialize_model(<span style="color:#bd93f9">102</span>, use_pretrained<span style="color:#ff79c6">=</span>featrue_extract)
</span></span><span style="display:flex;"><span>model_ft <span style="color:#ff79c6">=</span> model_ft<span style="color:#ff79c6">.</span>to(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 要跟新权重的名称</span>
</span></span><span style="display:flex;"><span>params_to_update <span style="color:#ff79c6">=</span> model_ft<span style="color:#ff79c6">.</span>parameters()
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> featrue_extract:
</span></span><span style="display:flex;"><span>    params_to_update <span style="color:#ff79c6">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> name, param <span style="color:#ff79c6">in</span> model_ft<span style="color:#ff79c6">.</span>named_parameters():
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> param<span style="color:#ff79c6">.</span>requires_grad:
</span></span><span style="display:flex;"><span>            params_to_update<span style="color:#ff79c6">.</span>append(param)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 优化器</span>
</span></span><span style="display:flex;"><span>optim_ft <span style="color:#ff79c6">=</span> optim<span style="color:#ff79c6">.</span>Adam(params_to_update, lr<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1e-2</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 学习率衰减，每10个epoch衰减为原来的1/10</span>
</span></span><span style="display:flex;"><span>scheduler <span style="color:#ff79c6">=</span> optim<span style="color:#ff79c6">.</span>lr_scheduler<span style="color:#ff79c6">.</span>StepLR(optim_ft, step_size<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span>, gamma<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.1</span>)
</span></span><span style="display:flex;"><span>criterion <span style="color:#ff79c6">=</span> nn<span style="color:#ff79c6">.</span>CrossEntropyLoss()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">train_model</span>(model, dataloaders, criterion, optimizer, num_epochs<span style="color:#ff79c6">=</span><span style="color:#bd93f9">25</span>, filename<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;best.pt&#39;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    模型训练函数
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    :param model: 模型
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    :param dataloaders: 数据读取操作
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    :param criterion: 损失函数
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    :param optimizer: 优化器
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    :param num_epochs: 迭代次数
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    :param filename: 模型名
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    since <span style="color:#ff79c6">=</span> time<span style="color:#ff79c6">.</span>time()
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 标记效果最好的1次</span>
</span></span><span style="display:flex;"><span>    best_acc <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#ff79c6">.</span>to(device)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 训练过程中打印的一些指标</span>
</span></span><span style="display:flex;"><span>    val_acc_history <span style="color:#ff79c6">=</span> []
</span></span><span style="display:flex;"><span>    train_acc_history <span style="color:#ff79c6">=</span> []
</span></span><span style="display:flex;"><span>    train_losses <span style="color:#ff79c6">=</span> []
</span></span><span style="display:flex;"><span>    val_losses <span style="color:#ff79c6">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 学习率</span>
</span></span><span style="display:flex;"><span>    LRs <span style="color:#ff79c6">=</span> [optimizer<span style="color:#ff79c6">.</span>param_groups[<span style="color:#bd93f9">0</span>][<span style="color:#f1fa8c">&#39;lr&#39;</span>]]
</span></span><span style="display:flex;"><span>    best_model_wts <span style="color:#ff79c6">=</span> copy<span style="color:#ff79c6">.</span>deepcopy(model<span style="color:#ff79c6">.</span>state_dict())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> epoch <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(num_epochs):
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;Epoch </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">/</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#39;</span><span style="color:#ff79c6">.</span>format(epoch, num_epochs <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;-&#39;</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> phase <span style="color:#ff79c6">in</span> [<span style="color:#f1fa8c">&#39;train&#39;</span>, <span style="color:#f1fa8c">&#39;valid&#39;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> phase <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;train&#39;</span>:
</span></span><span style="display:flex;"><span>                model<span style="color:#ff79c6">.</span>train()
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span>:
</span></span><span style="display:flex;"><span>                model<span style="color:#ff79c6">.</span>eval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            running_loss <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0.0</span>
</span></span><span style="display:flex;"><span>            running_corrects <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span> inputs, labels <span style="color:#ff79c6">in</span> dataloaders[phase]:
</span></span><span style="display:flex;"><span>                inputs <span style="color:#ff79c6">=</span> inputs<span style="color:#ff79c6">.</span>to(device)
</span></span><span style="display:flex;"><span>                labels <span style="color:#ff79c6">=</span> labels<span style="color:#ff79c6">.</span>to(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                optimizer<span style="color:#ff79c6">.</span>zero_grad()
</span></span><span style="display:flex;"><span>                outputs <span style="color:#ff79c6">=</span> model(inputs)
</span></span><span style="display:flex;"><span>                loss <span style="color:#ff79c6">=</span> criterion(outputs, labels)
</span></span><span style="display:flex;"><span>                _, preds <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>max(outputs, <span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4"># 训练集更新权重</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> phase <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;train&#39;</span>:
</span></span><span style="display:flex;"><span>                    loss<span style="color:#ff79c6">.</span>backward()
</span></span><span style="display:flex;"><span>                    optimizer<span style="color:#ff79c6">.</span>step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4"># 计算损失</span>
</span></span><span style="display:flex;"><span>                running_loss <span style="color:#ff79c6">+=</span> loss<span style="color:#ff79c6">.</span>item() <span style="color:#ff79c6">*</span> inputs<span style="color:#ff79c6">.</span>size(<span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>                running_corrects <span style="color:#ff79c6">+=</span> torch<span style="color:#ff79c6">.</span>sum(preds <span style="color:#ff79c6">==</span> labels<span style="color:#ff79c6">.</span>data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            epoch_loss <span style="color:#ff79c6">=</span> running_loss <span style="color:#ff79c6">/</span> <span style="color:#8be9fd;font-style:italic">len</span>(dataloaders[phase]<span style="color:#ff79c6">.</span>dataset)
</span></span><span style="display:flex;"><span>            epoch_acc <span style="color:#ff79c6">=</span> running_corrects<span style="color:#ff79c6">.</span>double() <span style="color:#ff79c6">/</span> <span style="color:#8be9fd;font-style:italic">len</span>(dataloaders[phase]<span style="color:#ff79c6">.</span>dataset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            time_elapsed <span style="color:#ff79c6">=</span> time<span style="color:#ff79c6">.</span>time() <span style="color:#ff79c6">-</span> since
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;time elapsed </span><span style="color:#f1fa8c">{:.0f}</span><span style="color:#f1fa8c">m </span><span style="color:#f1fa8c">{:.0f}</span><span style="color:#f1fa8c">s}&#39;</span><span style="color:#ff79c6">.</span>format(time_elapsed <span style="color:#ff79c6">//</span> <span style="color:#bd93f9">60</span>, time_elapsed <span style="color:#ff79c6">%</span> <span style="color:#bd93f9">60</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c"> Loss: </span><span style="color:#f1fa8c">{:.4f}</span><span style="color:#f1fa8c"> Acc: </span><span style="color:#f1fa8c">{:.4f}</span><span style="color:#f1fa8c">&#39;</span><span style="color:#ff79c6">.</span>format(phase, epoch_loss, epoch_acc))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># 如果当前模型比最好的强就替换</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> phase <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;valid&#39;</span> <span style="color:#ff79c6">and</span> epoch_acc <span style="color:#ff79c6">&gt;</span> best_acc:
</span></span><span style="display:flex;"><span>                best_acc <span style="color:#ff79c6">=</span> epoch_acc
</span></span><span style="display:flex;"><span>                best_model_wts <span style="color:#ff79c6">=</span> copy<span style="color:#ff79c6">.</span>deepcopy(model<span style="color:#ff79c6">.</span>state_dict())
</span></span><span style="display:flex;"><span>                state <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#f1fa8c">&#39;state_dict&#39;</span>: model<span style="color:#ff79c6">.</span>state_dict(),
</span></span><span style="display:flex;"><span>                    <span style="color:#f1fa8c">&#39;best_acc&#39;</span>: best_acc,
</span></span><span style="display:flex;"><span>                    <span style="color:#f1fa8c">&#39;optimizer&#39;</span>: optimizer<span style="color:#ff79c6">.</span>state_dict(),
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                torch<span style="color:#ff79c6">.</span>save(state, filename)
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> phase <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;valid&#39;</span>:
</span></span><span style="display:flex;"><span>                val_acc_history<span style="color:#ff79c6">.</span>append(epoch_acc)
</span></span><span style="display:flex;"><span>                val_losses<span style="color:#ff79c6">.</span>append(epoch_loss)
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> phase <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;train&#39;</span>:
</span></span><span style="display:flex;"><span>                train_acc_history<span style="color:#ff79c6">.</span>append(epoch_acc)
</span></span><span style="display:flex;"><span>                train_losses<span style="color:#ff79c6">.</span>append(epoch_loss)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;Optimization learning rate: </span><span style="color:#f1fa8c">{:.7f}</span><span style="color:#f1fa8c">&#39;</span><span style="color:#ff79c6">.</span>format(optimizer<span style="color:#ff79c6">.</span>param_groups[<span style="color:#bd93f9">0</span>][<span style="color:#f1fa8c">&#39;lr&#39;</span>]))
</span></span><span style="display:flex;"><span>            LRs<span style="color:#ff79c6">.</span>append(optimizer<span style="color:#ff79c6">.</span>param_groups[<span style="color:#bd93f9">0</span>][<span style="color:#f1fa8c">&#39;lr&#39;</span>])
</span></span><span style="display:flex;"><span>            scheduler<span style="color:#ff79c6">.</span>step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        time_elapsed <span style="color:#ff79c6">=</span> time<span style="color:#ff79c6">.</span>time() <span style="color:#ff79c6">-</span> since
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;Training complete in </span><span style="color:#f1fa8c">{:.0f}</span><span style="color:#f1fa8c">m </span><span style="color:#f1fa8c">{:.0f}</span><span style="color:#f1fa8c">s&#39;</span><span style="color:#ff79c6">.</span>format(time_elapsed <span style="color:#ff79c6">//</span> <span style="color:#bd93f9">60</span>, time_elapsed <span style="color:#ff79c6">%</span> <span style="color:#bd93f9">60</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;Best val Acc: </span><span style="color:#f1fa8c">{:4f}</span><span style="color:#f1fa8c">&#39;</span><span style="color:#ff79c6">.</span>format(best_acc))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 训练完之后用最好的一次当模型的最终结果</span>
</span></span><span style="display:flex;"><span>        model<span style="color:#ff79c6">.</span>load_state_dict(best_model_wts)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> model, val_acc_history, train_losses, train_acc_history, val_losses, LRs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 训练模型</span>
</span></span><span style="display:flex;"><span>model, val_acc_history, train_losses, train_acc_history, val_losses, LRs <span style="color:#ff79c6">=</span> train_model(model_ft, dataloaders, criterion, optim_ft)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 如果训练的时候断了，加载训练好的模型</span>
</span></span><span style="display:flex;"><span>model_ft, input_size <span style="color:#ff79c6">=</span> initialize_model(<span style="color:#bd93f9">102</span>, use_pretrained<span style="color:#ff79c6">=</span>featrue_extract)
</span></span><span style="display:flex;"><span>model_ft <span style="color:#ff79c6">=</span> model_ft<span style="color:#ff79c6">.</span>to(device)
</span></span><span style="display:flex;"><span>checkpoint <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>load(<span style="color:#f1fa8c">&#39;best.pt&#39;</span>)
</span></span><span style="display:flex;"><span>best_acc <span style="color:#ff79c6">=</span> checkpoint[<span style="color:#f1fa8c">&#39;best_acc&#39;</span>]
</span></span><span style="display:flex;"><span>model_ft<span style="color:#ff79c6">.</span>load_state_dict(checkpoint[<span style="color:#f1fa8c">&#39;state_dict&#39;</span>])
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="4-自定义dataloader">4 自定义dataloader<a hidden class="anchor" aria-hidden="true" href="#4-自定义dataloader">#</a></h6>
<p>图像分类demo里每个分类单独放到了一个文件夹里，很多时候拿到的数据不是分好类的，所有数据都存在一个文件夹里，但是会有一个文件名和类别的对照表，对照表可能是txt格式，excel或者json等等。</p>
<p>比如对照表是txt文件，每行是文件名 + &quot; &quot; + 类别的读取：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> torch.utils.data <span style="color:#ff79c6">import</span> Dataset, DataLoader
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> torchvision <span style="color:#ff79c6">import</span> transforms
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> warnings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>warnings<span style="color:#ff79c6">.</span>filterwarnings(<span style="color:#f1fa8c">&#34;ignore&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">FlowersDataset</span>(Dataset):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">__init__</span>(<span style="font-style:italic">self</span>, root_dir, ann_file, transform<span style="color:#ff79c6">=</span><span style="color:#ff79c6">None</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :param transform: 自定义预处理操作
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>ann_file <span style="color:#ff79c6">=</span> ann_file
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>root_dir <span style="color:#ff79c6">=</span> root_dir
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>img_label <span style="color:#ff79c6">=</span> <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>load_annotations()
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>img <span style="color:#ff79c6">=</span> [os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(<span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>root_dir, img) <span style="color:#ff79c6">for</span> img <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">list</span>(<span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>img_label<span style="color:#ff79c6">.</span>keys())]
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>label <span style="color:#ff79c6">=</span> [label <span style="color:#ff79c6">for</span> label <span style="color:#ff79c6">in</span> <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>img_label<span style="color:#ff79c6">.</span>values()]
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>transform <span style="color:#ff79c6">=</span> transform
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">__len__</span>(<span style="font-style:italic">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">len</span>(<span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">__getitem__</span>(<span style="font-style:italic">self</span>, idx):
</span></span><span style="display:flex;"><span>        image <span style="color:#ff79c6">=</span> Image<span style="color:#ff79c6">.</span>open(<span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>img[idx])
</span></span><span style="display:flex;"><span>        label <span style="color:#ff79c6">=</span> <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>label[idx]
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>transform:
</span></span><span style="display:flex;"><span>            image <span style="color:#ff79c6">=</span> <span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>transform(image)
</span></span><span style="display:flex;"><span>        label <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>from_numpy(np<span style="color:#ff79c6">.</span>array(label))
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> image, label
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">load_annotations</span>(<span style="font-style:italic">self</span>):
</span></span><span style="display:flex;"><span>        data_infos <span style="color:#ff79c6">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">with</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="font-style:italic">self</span><span style="color:#ff79c6">.</span>ann_file) <span style="color:#ff79c6">as</span> f:
</span></span><span style="display:flex;"><span>            samples <span style="color:#ff79c6">=</span> [x<span style="color:#ff79c6">.</span>strip()<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; &#39;</span>) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> f<span style="color:#ff79c6">.</span>readlines()]
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> filename, gt_label <span style="color:#ff79c6">in</span> samples:
</span></span><span style="display:flex;"><span>            data_infos[filename] <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>array(gt_label, dtype<span style="color:#ff79c6">=</span>np<span style="color:#ff79c6">.</span>int32)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> data_infos
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 定义图像预处理操作</span>
</span></span><span style="display:flex;"><span>data_transforms <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;train&#39;</span>: transforms<span style="color:#ff79c6">.</span>Compose([
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 统一图片的尺寸</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>Resize([<span style="color:#bd93f9">128</span>, <span style="color:#bd93f9">128</span>]),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据增强-随机在145到45度间旋转</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>RandomRotation(<span style="color:#bd93f9">45</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据增强-数据增强-随机选择64 * 64的区域裁剪</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>CenterCrop(<span style="color:#bd93f9">64</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据增强-50%概率水平翻转</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>RandomHorizontalFlip(p<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.5</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据增强-50%概率垂直翻转</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>RandomVerticalFlip(p<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.5</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 亮度、对比度、饱和度啥的，不重要</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>ColorJitter(brightness<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.2</span>, contrast<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.1</span>, saturation<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.1</span>, hue<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.1</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 将图片转成标量</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>ToTensor(),
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 数据集比较小的时候均值和标准差不太准，直接大数据集的来用，3个数值对应通道数R-G-B</span>
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>Normalize([<span style="color:#bd93f9">0.485</span>, <span style="color:#bd93f9">0.456</span>, <span style="color:#bd93f9">0.406</span>], [<span style="color:#bd93f9">0.229</span>, <span style="color:#bd93f9">0.224</span>, <span style="color:#bd93f9">0.225</span>])
</span></span><span style="display:flex;"><span>    ]),
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;valid&#39;</span>: transforms<span style="color:#ff79c6">.</span>Compose([
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>Resize([<span style="color:#bd93f9">64</span>, <span style="color:#bd93f9">64</span>]),
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>ToTensor(),
</span></span><span style="display:flex;"><span>        transforms<span style="color:#ff79c6">.</span>Normalize([<span style="color:#bd93f9">0.485</span>, <span style="color:#bd93f9">0.456</span>, <span style="color:#bd93f9">0.406</span>], [<span style="color:#bd93f9">0.229</span>, <span style="color:#bd93f9">0.224</span>, <span style="color:#bd93f9">0.225</span>])
</span></span><span style="display:flex;"><span>    ])
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>train_dataset <span style="color:#ff79c6">=</span> FlowersDataset(root_dir<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;./flower_data/train&#39;</span>, ann_file<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;./flower_data/train.txt&#39;</span>, transform<span style="color:#ff79c6">=</span>data_transforms[<span style="color:#f1fa8c">&#39;train&#39;</span>])
</span></span><span style="display:flex;"><span>val_dataset <span style="color:#ff79c6">=</span> FlowersDataset(root_dir<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;./flower_data/valid&#39;</span>, ann_file<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;./flower_data/valid.txt&#39;</span>, transform<span style="color:#ff79c6">=</span>data_transforms[<span style="color:#f1fa8c">&#39;valid&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>train_loader <span style="color:#ff79c6">=</span> DataLoader(train_dataset, batch_size<span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span>, shuffle<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, num_workers<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span>)
</span></span><span style="display:flex;"><span>val_loader <span style="color:#ff79c6">=</span> DataLoader(val_dataset, batch_size<span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span>, shuffle<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/shiro/4.%E6%9D%83%E9%99%90%E6%B5%81%E7%A8%8B/">
    <span class="title">« Prev</span>
    <br>
    <span>4.shiro-权限流程</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/%E5%9F%BA%E7%A1%80/%E7%AE%97%E6%B3%95/leecode/4.%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/">
    <span class="title">Next »</span>
    <br>
    <span>4.合并两个有序数组</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 4.tensorFlow on x"
            href="https://x.com/intent/tweet/?text=4.tensorFlow&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fai%2f4.%25E6%25B7%25B1%25E5%25BA%25A6%25E5%25AD%25A6%25E4%25B9%25A0%25E6%25A1%2586%25E6%259E%25B6%2f&amp;hashtags=%e6%b7%b1%e5%ba%a6%e5%ad%a6%e4%b9%a0">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 4.tensorFlow on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fai%2f4.%25E6%25B7%25B1%25E5%25BA%25A6%25E5%25AD%25A6%25E4%25B9%25A0%25E6%25A1%2586%25E6%259E%25B6%2f&amp;title=4.tensorFlow&amp;summary=4.tensorFlow&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fai%2f4.%25E6%25B7%25B1%25E5%25BA%25A6%25E5%25AD%25A6%25E4%25B9%25A0%25E6%25A1%2586%25E6%259E%25B6%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 4.tensorFlow on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fai%2f4.%25E6%25B7%25B1%25E5%25BA%25A6%25E5%25AD%25A6%25E4%25B9%25A0%25E6%25A1%2586%25E6%259E%25B6%2f&title=4.tensorFlow">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 4.tensorFlow on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fai%2f4.%25E6%25B7%25B1%25E5%25BA%25A6%25E5%25AD%25A6%25E4%25B9%25A0%25E6%25A1%2586%25E6%259E%25B6%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 4.tensorFlow on whatsapp"
            href="https://api.whatsapp.com/send?text=4.tensorFlow%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fai%2f4.%25E6%25B7%25B1%25E5%25BA%25A6%25E5%25AD%25A6%25E4%25B9%25A0%25E6%25A1%2586%25E6%259E%25B6%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 4.tensorFlow on telegram"
            href="https://telegram.me/share/url?text=4.tensorFlow&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fai%2f4.%25E6%25B7%25B1%25E5%25BA%25A6%25E5%25AD%25A6%25E4%25B9%25A0%25E6%25A1%2586%25E6%259E%25B6%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 4.tensorFlow on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=4.tensorFlow&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fai%2f4.%25E6%25B7%25B1%25E5%25BA%25A6%25E5%25AD%25A6%25E4%25B9%25A0%25E6%25A1%2586%25E6%259E%25B6%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">王小红的笔记</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
